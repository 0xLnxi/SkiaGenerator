# Skia + Dawn å…¨å¹³å°æ„å»ºå·¥ä½œæµï¼ˆæé™å­˜å‚¨ä¼˜åŒ–ç‰ˆï¼‰
name: ç¼–è¯‘ Skia + Dawn å…¨å¹³å°æ„å»ºåŒ…

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´ä¸Šåˆ8ç‚¹ï¼ˆUTCæ—¶é—´0ç‚¹ï¼‰æ‰§è¡Œä¸€æ¬¡
    - cron: '0 0 * * *'

# è®¾ç½®å·¥ä½œæµæƒé™
permissions:
  contents: write
  packages: write
  actions: read

env:
  # ç»Ÿä¸€æ„å»ºç±»å‹ä¸ºRelWithDebInfo
  BUILD_TYPE: RelWithDebInfo

jobs:
  # Windowså¹³å°å•ç‹¬æ„å»ºï¼ˆå­˜å‚¨ç©ºé—´ç›¸å¯¹å……è¶³ï¼‰
  build-windows:
    runs-on: windows-2022
    strategy:
      matrix:
        include:
          - platform: x64_windows
            arch: x64
            target_os: win
            target_cpu: x64
            compiler: msvc2022

    steps:
    # æ£€å‡ºä»£ç ä»“åº“
    - name: æ£€å‡ºä»£ç ä»“åº“
      uses: actions/checkout@v4
      
    # æ˜¾ç¤ºç£ç›˜ä½¿ç”¨æƒ…å†µ
    - name: æ˜¾ç¤ºç£ç›˜ä½¿ç”¨æƒ…å†µ
      run: |
        echo "Windowsç£ç›˜ä½¿ç”¨æƒ…å†µï¼š"
        Get-WmiObject -Class Win32_LogicalDisk | Select-Object DeviceID, Size, FreeSpace
        
    # è®¾ç½®Pythonç¯å¢ƒ
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    # å®‰è£…Windowsç³»ç»Ÿä¾èµ–
    - name: å®‰è£…Windowsç³»ç»Ÿä¾èµ–
      run: |
        # å®‰è£…ninjaæ„å»ºå·¥å…·
        choco install ninja -y --no-progress
        # å®‰è£…LLVM 18ç”¨äºClangç¼–è¯‘å™¨
        choco install llvm --version=18.1.8 --force -y --no-progress
        echo "C:\Program Files\LLVM\bin" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append
        
    # è®¾ç½®Visual Studioç¯å¢ƒ
    - name: è®¾ç½®Visual Studioç¯å¢ƒ
      uses: microsoft/setup-msbuild@v2
      
    # è·å–depot_toolsï¼ˆè½»é‡çº§ï¼‰
    - name: è·å–depot_tools
      run: |
        git clone --depth=1 https://chromium.googlesource.com/chromium/tools/depot_tools.git
        echo "${{ github.workspace }}\depot_tools" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append
        # ç¦ç”¨depot_toolsè‡ªåŠ¨ä¸‹è½½å·¥å…·é“¾
        echo "DEPOT_TOOLS_WIN_TOOLCHAIN=0" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf8 -Append
        
    # è·å–Skiaæºä»£ç ï¼ˆæœ€å°åŒ–ï¼‰
    - name: è·å–Skiaæºä»£ç 
      run: |
        $env:PATH = "${{ github.workspace }}\depot_tools;" + $env:PATH
        
        # åˆ›å»ºæœ€å°åŒ–çš„gclienté…ç½®
        @"
        solutions = [
          {
            "name": "skia",
            "url": "https://skia.googlesource.com/skia.git",
            "deps_file": "DEPS",
            "managed": False,
            "custom_deps": {
              "skia/third_party/externals/angle2": None,
              "skia/third_party/externals/dawn": None,
            },
            "custom_vars": {
              "skia_use_dawn": True,
            },
          },
        ]
        "@ | Out-File -FilePath .gclient -Encoding utf8
        
        # æµ…å…‹éš†Skia
        gclient sync --no-history --shallow --jobs=2
      shell: powershell
      
    # è·å–Dawnæºä»£ç ï¼ˆWindowsä¸“ç”¨æœ€å°åŒ–ï¼‰
    - name: è·å–Dawnæºä»£ç 
      run: |
        # æµ…å…‹éš†Dawnä¸»ä»“åº“
        git clone --depth=1 https://dawn.googlesource.com/dawn.git dawn-source
        cd dawn-source
        # æœ€å°åŒ–è·å–ä¾èµ–ï¼Œè·³è¿‡ä¸å¿…è¦çš„ç»„ä»¶
        python tools/fetch_dawn_dependencies.py --skip-chrome-binary-sdk
      shell: powershell
      
    # é…ç½®Dawnæ„å»ºå‚æ•°ï¼ˆWindowsä¼˜åŒ–ï¼‰
    - name: é…ç½®Dawnæ„å»ºå‚æ•°
      run: |
        cd dawn-source
        mkdir build-${{ matrix.platform }}
        cd build-${{ matrix.platform }}
        
        # Windowså¹³å°ä½¿ç”¨MSVC 2022ï¼Œæœ€å°åŒ–æ„å»º
        cmake .. -G "Visual Studio 17 2022" -A x64 `
          -DCMAKE_BUILD_TYPE=${{ env.BUILD_TYPE }} `
          -DDAWN_BUILD_SAMPLES=OFF `
          -DDAWN_BUILD_TESTS=OFF `
          -DDAWN_BUILD_BENCHMARKS=OFF `
          -DDAWN_BUILD_FUZZERS=OFF `
          -DDAWN_ENABLE_D3D11=ON `
          -DDAWN_ENABLE_D3D12=ON `
          -DDAWN_ENABLE_VULKAN=ON `
          -DDAWN_ENABLE_OPENGL=ON `
          -DCMAKE_CXX_STANDARD=20 `
          -DDAWN_USE_BUILT_DXC=ON `
          -DDAWN_ENABLE_INSTALL=OFF `
          -DDAWN_ENABLE_PIC=OFF
      shell: powershell
      
    # ç¼–è¯‘Dawnï¼ˆWindowsï¼‰
    - name: ç¼–è¯‘Dawn
      run: |
        cd dawn-source\build-${{ matrix.platform }}
        # Windowså¹³å°ä½¿ç”¨MSBuildï¼Œåªç¼–è¯‘æ ¸å¿ƒåº“
        cmake --build . --config ${{ env.BUILD_TYPE }} --parallel 2 --target dawn_headers --target dawn_cpp --target webgpu_dawn
        
        Write-Host "âœ… Dawnç¼–è¯‘å®Œæˆ"
        
        # ç«‹å³æ¸…ç†æ„å»ºä¸´æ—¶æ–‡ä»¶
        Get-ChildItem -Recurse -Include "*.obj" | Remove-Item -Force
        Get-ChildItem -Recurse -Include "CMakeFiles" | Remove-Item -Recurse -Force
      shell: powershell
      
    # é…ç½®Skiaæ„å»ºå‚æ•°ï¼ˆWindowsï¼‰
    - name: é…ç½®Skiaæ„å»ºå‚æ•°
      run: |
        cd skia
        $env:PATH = "${{ github.workspace }}\depot_tools;" + $env:PATH
        
        # æœ€å°åŒ–åŒæ­¥ä¾èµ–
        python tools/git-sync-deps
        
        # åŸºç¡€æ„å»ºå‚æ•°è®¾ç½®
        $args = "is_official_build=false"
        $args += " is_debug=false"
        $args += " extra_cflags=[\`"/O2\`", \`"/Zi\`"]"
        $args += " skia_use_dawn=true"
        $args += " skia_dawn_dir=\`"../dawn-source\`""
        
        # ç¦ç”¨ä¸å¿…è¦çš„åŠŸèƒ½
        $args += " skia_use_system_expat=false"
        $args += " skia_use_system_icu=false"
        $args += " skia_use_system_libjpeg_turbo=false"
        $args += " skia_use_system_libpng=false"
        $args += " skia_use_system_libwebp=false"
        $args += " skia_use_system_zlib=false"
        
        # å¯ç”¨æ ¸å¿ƒåŠŸèƒ½
        $args += " skia_enable_pdf=true"
        $args += " skia_enable_skottie=true"
        $args += " skia_enable_skshaper=true"
        $args += " skia_enable_svg=true"
        $args += " skia_use_icu=true"
        
        # å¯ç”¨GPUåç«¯æ”¯æŒ
        $args += " skia_enable_gpu=true"
        $args += " skia_use_gl=true"
        $args += " skia_use_vulkan=true"
        $args += " skia_enable_spirv_validation=false"
        
        # ç¦ç”¨å·¥å…·æ„å»ºå’Œæµ‹è¯•
        $args += " skia_enable_tools=false"
        $args += " skia_build_fuzzers=false"
        $args += " skia_enable_sksl_test=false"
        
        # Windowså¹³å°ç‰¹å®šé…ç½®
        $args += " skia_use_angle=true"
        $args += " skia_use_direct3d=true"
        $args += " skia_use_freetype=true"
        $args += " skia_use_system_freetype2=false"
        $args += " skia_use_harfbuzz=true"
        $args += " skia_use_system_harfbuzz=false"
        $args += " cc=\`"clang\`""
        $args += " cxx=\`"clang++\`""
        $args += " clang_win=\`"C:/Program Files/LLVM\`""
        
        # è®¾ç½®ç›®æ ‡å¹³å°å’Œæ¶æ„
        $args += " target_os=\`"win\`""
        $args += " target_cpu=\`"x64\`""
        
        echo "BUILD_ARGS=$args" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf8 -Append
      shell: powershell
      
    # ç”ŸæˆSkiaæ„å»ºæ–‡ä»¶ï¼ˆWindowsï¼‰
    - name: ç”ŸæˆSkiaæ„å»ºæ–‡ä»¶
      run: |
        cd skia
        $env:PATH = "${{ github.workspace }}\depot_tools;" + $env:PATH
        Write-Host "æ­£åœ¨ä¸ºWindowså¹³å°ç”ŸæˆSkiaæ„å»ºæ–‡ä»¶..."
        .\bin\gn gen out\Release --args="$env:BUILD_ARGS"
        Write-Host "Skiaæ„å»ºé…ç½®å®Œæˆ"
      shell: powershell
      
    # ç¼–è¯‘Skiaï¼ˆWindowsï¼‰
    - name: ç¼–è¯‘Skia
      run: |
        cd skia
        $env:PATH = "${{ github.workspace }}\depot_tools;" + $env:PATH
        Write-Host "å¼€å§‹ç¼–è¯‘Windowså¹³å°çš„Skia..."
        
        # ä½¿ç”¨è¾ƒå°‘çš„å¹¶è¡Œçº¿ç¨‹
        ninja -C out\Release -j2
        
        Write-Host "âœ… Windowså¹³å°Skiaç¼–è¯‘å®Œæˆ"
        
        # ç«‹å³æ¸…ç†æ„å»ºä¸´æ—¶æ–‡ä»¶
        Get-ChildItem -Path out\Release -Recurse -Include "*.obj" | Remove-Item -Force
        Get-ChildItem -Path out\Release -Recurse -Include "*.d" | Remove-Item -Force
      shell: powershell
      
    # åˆ›å»ºWindowså‘å¸ƒåŒ…
    - name: åˆ›å»ºWindowså‘å¸ƒåŒ…
      run: |
        # åˆ›å»ºè¾“å‡ºç›®å½•ç»“æ„
        New-Item -ItemType Directory -Path "Skia\include\core" -Force
        New-Item -ItemType Directory -Path "Skia\include\dawn" -Force
        New-Item -ItemType Directory -Path "Skia\include\modules" -Force
        New-Item -ItemType Directory -Path "Skia\lib\win\x64" -Force
        New-Item -ItemType Directory -Path "Skia\bin\win\x64" -Force
        
        # å¤åˆ¶Skiaå¤´æ–‡ä»¶
        Copy-Item -Path "skia\include\*" -Destination "Skia\include\core\" -Recurse -Force
        
        # å¤åˆ¶Dawnå¤´æ–‡ä»¶å’Œç”Ÿæˆæ–‡ä»¶
        Copy-Item -Path "dawn-source\include\*" -Destination "Skia\include\dawn\" -Recurse -Force
        if (Test-Path "dawn-source\build-${{ matrix.platform }}\gen\include\dawn") {
            Copy-Item -Path "dawn-source\build-${{ matrix.platform }}\gen\include\dawn\*" -Destination "Skia\include\dawn\" -Recurse -Force
        }
        if (Test-Path "dawn-source\build-${{ matrix.platform }}\gen\include\webgpu") {
            Copy-Item -Path "dawn-source\build-${{ matrix.platform }}\gen\include\webgpu\*" -Destination "Skia\include\dawn\" -Recurse -Force
        }
        
        # å¤åˆ¶åº“æ–‡ä»¶
        Get-ChildItem -Path "skia\out\Release" -Filter "*.lib" | Copy-Item -Destination "Skia\lib\win\x64\"
        Get-ChildItem -Path "dawn-source\build-${{ matrix.platform }}\${{ env.BUILD_TYPE }}" -Filter "*.lib" -ErrorAction SilentlyContinue | Copy-Item -Destination "Skia\lib\win\x64\"
        
        Write-Host "âœ… Windowsæ„å»ºåŒ…åˆ›å»ºå®Œæˆ"
      shell: powershell
      
    # ç”ŸæˆCMakeLists.txtæ–‡ä»¶ï¼ˆWindowsï¼‰
    - name: ç”ŸæˆCMakeLists.txt
      run: |
        $cmakeContent = @"
# Skia + Dawn å›¾å½¢åº“çš„CMakeé…ç½®æ–‡ä»¶ï¼ˆWindowsç‰ˆï¼‰
cmake_minimum_required(VERSION 3.20)

project(SkiaDawnPrebuilt
    VERSION 1.0.0
    DESCRIPTION "Skia + Dawn WebGPU é¢„ç¼–è¯‘åº“"
    LANGUAGES CXX C
)

# è®¾ç½®C++æ ‡å‡†
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# è·å–å½“å‰ç›®å½•
get_filename_component(SKIA_ROOT_DIR "`${CMAKE_CURRENT_LIST_DIR}" ABSOLUTE)

# æ£€æµ‹å¹³å°å’Œæ¶æ„
if(WIN32)
    set(PLATFORM_DIR "win")
    if(CMAKE_SIZEOF_VOID_P EQUAL 8)
        set(ARCH_DIR "x64")
    else()
        set(ARCH_DIR "x86")
    endif()
endif()

# è®¾ç½®åº“æ–‡ä»¶è·¯å¾„
set(LIB_DIR "`${SKIA_ROOT_DIR}/lib/`${PLATFORM_DIR}/`${ARCH_DIR}")

# åˆ›å»ºDawnDynamicæ¥å£åº“
add_library(DawnDynamic INTERFACE)

# è®¾ç½®DawnåŒ…å«ç›®å½•
target_include_directories(DawnDynamic INTERFACE
    `$<BUILD_INTERFACE:`${SKIA_ROOT_DIR}/include/dawn>
    `$<INSTALL_INTERFACE:include/dawn>
)

# æŸ¥æ‰¾Dawnåº“æ–‡ä»¶
file(GLOB DAWN_LIBS 
    "`${LIB_DIR}/*dawn*.lib" 
    "`${LIB_DIR}/*webgpu*.lib"
)

if(DAWN_LIBS)
    target_link_libraries(DawnDynamic INTERFACE `${DAWN_LIBS})
endif()

# åˆ›å»ºSkiaä¸»ç›®æ ‡
add_library(Skia INTERFACE)
add_library(skia::skia ALIAS Skia)

# è®¾ç½®SkiaåŒ…å«ç›®å½•
target_include_directories(Skia INTERFACE
    `$<BUILD_INTERFACE:`${SKIA_ROOT_DIR}/include/core>
    `$<BUILD_INTERFACE:`${SKIA_ROOT_DIR}/include/dawn>
    `$<BUILD_INTERFACE:`${SKIA_ROOT_DIR}/include/modules>
    `$<INSTALL_INTERFACE:include/core>
    `$<INSTALL_INTERFACE:include/dawn>
    `$<INSTALL_INTERFACE:include/modules>
)

# æŸ¥æ‰¾Skiaåº“æ–‡ä»¶
file(GLOB SKIA_LIBS 
    "`${LIB_DIR}/*skia*.lib"
)

if(SKIA_LIBS)
    target_link_libraries(Skia INTERFACE `${SKIA_LIBS})
endif()

# é“¾æ¥Dawnåˆ°Skia
target_link_libraries(Skia INTERFACE DawnDynamic)

# Windowså¹³å°é“¾æ¥åº“
if(WIN32)
    target_link_libraries(Skia INTERFACE
        # DirectXç›¸å…³
        d3d11 d3d12 dxgi dxguid d3dcompiler
        # OpenGLç›¸å…³
        opengl32
        # Vulkanç›¸å…³
        vulkan-1
        # ç³»ç»Ÿåº“
        gdi32 user32 kernel32 ole32 oleaut32 uuid advapi32 shell32
        # å­—ä½“å’Œæ–‡æœ¬
        usp10
        # ç½‘ç»œ
        ws2_32
    )
    
    target_compile_definitions(Skia INTERFACE
        SK_GANESH=1 SK_VULKAN=1 SK_GL=1 SK_DIRECT3D=1 SK_DAWN=1
        WIN32_LEAN_AND_MEAN NOMINMAX
    )
endif()

# è®¾ç½®ç¼–è¯‘ç‰¹æ€§
target_compile_features(Skia INTERFACE cxx_std_20)

# å¯¼å‡ºç›®æ ‡
export(TARGETS Skia DawnDynamic FILE SkiaTargets.cmake)
"@
        
        $cmakeContent | Out-File -FilePath "Skia\CMakeLists.txt" -Encoding utf8
        
        # åˆ›å»ºæ„å»ºä¿¡æ¯æ–‡ä»¶
        $buildInfo = @"
Skia + Dawn æ„å»ºä¿¡æ¯ï¼ˆWindowsç‰ˆï¼‰
===============================
å¹³å°: Windows
æ¶æ„: x64
æ„å»ºæ¨¡å¼: ${{ env.BUILD_TYPE }}
ç¼–è¯‘å™¨: MSVC 2022 + Clang 18
C++æ ‡å‡†: C++20

æ”¯æŒçš„å›¾å½¢åç«¯:
- DirectX 11/12
- Vulkan
- OpenGL
- Dawn WebGPU

ç‰¹åˆ«è¯´æ˜:
- å­˜å‚¨ä¼˜åŒ–ç‰ˆæœ¬ï¼Œä»…åŒ…å«æ ¸å¿ƒåŠŸèƒ½
- Dawn WebGPUå®Œå…¨é›†æˆ
- ç”Ÿäº§ç¯å¢ƒå°±ç»ª
- CMakeå®Œå…¨æ”¯æŒ
"@
        
        $buildInfo | Out-File -FilePath "Skia\BUILD_INFO.txt" -Encoding utf8
      shell: powershell
      
    # æ‰“åŒ…Windowsæ„å»ºäº§ç‰©
    - name: æ‰“åŒ…Windowsæ„å»ºäº§ç‰©
      run: |
        Compress-Archive -Path "Skia\*" -DestinationPath "${{ matrix.platform }}.zip" -CompressionLevel Optimal
        Write-Host "âœ… ${{ matrix.platform }}.zip æ„å»ºåŒ…åˆ›å»ºå®Œæˆ"
        Get-ChildItem -Name "*.zip" | ForEach-Object { Get-Item $_ | Select-Object Name, Length }
      shell: powershell
      
    # ä¸Šä¼ Windowsæ„å»ºäº§ç‰©
    - name: ä¸Šä¼ Windowsæ„å»ºäº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: ${{ matrix.platform }}
        path: ${{ matrix.platform }}.zip
        retention-days: 7
        compression-level: 0

  # Linuxå¹³å°æ„å»ºï¼ˆè¶…çº§ä¼˜åŒ–ç‰ˆï¼‰
  build-linux:
    runs-on: ubuntu-24.04
    strategy:
      matrix:
        include:
          - platform: x64_linux
            arch: x64
            target_os: linux
            target_cpu: x64
            compiler: clang18

    steps:
    # æ£€å‡ºä»£ç ä»“åº“
    - name: æ£€å‡ºä»£ç ä»“åº“
      uses: actions/checkout@v4
      
    # æé™æ¸…ç†ç£ç›˜ç©ºé—´
    - name: æé™æ¸…ç†ç£ç›˜ç©ºé—´
      run: |
        echo "æ¸…ç†å‰ç£ç›˜ä½¿ç”¨æƒ…å†µï¼š"
        df -h
        
        # åœæ­¢ä¸å¿…è¦çš„æœåŠ¡
        sudo systemctl stop docker
        sudo systemctl stop mysql
        sudo systemctl stop postgresql
        
        # åˆ é™¤å¤§å‹è½¯ä»¶åŒ…å’Œå·¥å…·é“¾
        sudo apt-get remove -y '^dotnet-.*'
        sudo apt-get remove -y '^llvm-.*'
        sudo apt-get remove -y '^clang-.*'
        sudo apt-get remove -y azure-cli
        sudo apt-get remove -y google-cloud-cli
        sudo apt-get remove -y firefox
        sudo apt-get remove -y google-chrome-stable
        sudo apt-get remove -y microsoft-edge-stable
        sudo apt-get autoremove -y
        sudo apt-get autoclean
        
        # åˆ é™¤å¤§å‹ç›®å½•
        sudo rm -rf /usr/share/dotnet
        sudo rm -rf /usr/local/lib/android
        sudo rm -rf /opt/ghc
        sudo rm -rf /opt/hostedtoolcache
        sudo rm -rf /usr/local/share/boost
        sudo rm -rf /usr/local/graalvm
        sudo rm -rf /usr/local/share/chromium
        sudo rm -rf /usr/local/share/firefox
        sudo rm -rf /usr/share/gradle
        sudo rm -rf /usr/local/lib/node_modules
        sudo rm -rf /root/.cache
        sudo rm -rf /home/runner/.cache
        
        # æ¸…ç†Dockerç›¸å…³
        sudo rm -rf /var/lib/docker
        
        # æ¸…ç†ç³»ç»Ÿæ—¥å¿—
        sudo journalctl --vacuum-time=1d
        
        # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
        sudo rm -rf /tmp/*
        sudo rm -rf /var/tmp/*
        
        echo "æ¸…ç†åç£ç›˜ä½¿ç”¨æƒ…å†µï¼š"
        df -h
        
    # è®¾ç½®Pythonç¯å¢ƒ
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    # å®‰è£…Linuxç³»ç»Ÿä¾èµ–ï¼ˆæœ€å°åŒ–ï¼‰
    - name: å®‰è£…Linuxç³»ç»Ÿä¾èµ–
      run: |
        sudo apt-get update
        # åªå®‰è£…ç»å¯¹å¿…è¦çš„åŒ…
        sudo apt-get install -y --no-install-recommends \
          build-essential ninja-build cmake \
          clang-18 \
          libgl1-mesa-dev libvulkan-dev \
          libx11-dev
          
        # è®¾ç½®ç¼–è¯‘å™¨
        sudo update-alternatives --install /usr/bin/clang clang /usr/bin/clang-18 100
        sudo update-alternatives --install /usr/bin/clang++ clang++ /usr/bin/clang++-18 100
        
    # è·å–depot_toolsï¼ˆè¶…è½»é‡çº§ï¼‰
    - name: è·å–depot_tools
      run: |
        git clone --depth=1 --single-branch https://chromium.googlesource.com/chromium/tools/depot_tools.git
        echo "${{ github.workspace }}/depot_tools" >> $GITHUB_PATH
        
    # è·å–æœ€å°åŒ–çš„Skiaæºä»£ç 
    - name: è·å–æœ€å°åŒ–Skiaæºä»£ç 
      run: |
        export PATH=${{ github.workspace }}/depot_tools:$PATH
        
        # åˆ›å»ºæœ€å°åŒ–é…ç½®
        cat > .gclient << 'EOF'
        solutions = [
          {
            "name": "skia",
            "url": "https://skia.googlesource.com/skia.git",
            "deps_file": "DEPS",
            "managed": False,
            "custom_deps": {
              "skia/third_party/externals/angle2": None,
              "skia/third_party/externals/dawn": None,
              "skia/third_party/externals/dng_sdk": None,
              "skia/third_party/externals/piex": None,
            },
            "custom_vars": {
              "skia_use_dawn": False,
            },
          },
        ]
        EOF
        
        # è¶…æµ…å…‹éš†
        gclient sync --no-history --shallow --jobs=1 --delete_unversioned_trees
        
    # è·å–è¶…ç²¾ç®€Dawnæºä»£ç 
    - name: è·å–è¶…ç²¾ç®€Dawnæºä»£ç   
      run: |
        # åªå…‹éš†Dawnæ ¸å¿ƒï¼Œä¸è·å–å­æ¨¡å—
        git clone --depth=1 --no-recurse-submodules https://dawn.googlesource.com/dawn.git dawn-source
        cd dawn-source
        
        # åªè·å–ç»å¯¹å¿…è¦çš„å­æ¨¡å—
        git submodule update --init --depth=1 third_party/abseil-cpp
        git submodule update --init --depth=1 third_party/khronos
        
    # ç«‹å³æ¸…ç†æºç 
    - name: ç«‹å³æ¸…ç†æºç 
      run: |
        # åˆ é™¤æ‰€æœ‰æµ‹è¯•æ–‡ä»¶å’Œèµ„æº
        find . -name "*test*" -type f -name "*.cpp" -delete 2>/dev/null || true
        find . -name "*test*" -type f -name "*.cc" -delete 2>/dev/null || true
        find . -name "*test*" -type f -name "*.h" -delete 2>/dev/null || true
        find . -name "*.png" -size +50k -delete 2>/dev/null || true
        find . -name "*.jpg" -size +50k -delete 2>/dev/null || true
        find . -name "*.webp" -size +50k -delete 2>/dev/null || true
        find . -name "*.gif" -size +50k -delete 2>/dev/null || true
        
        # åˆ é™¤ç¤ºä¾‹å’Œæ–‡æ¡£
        rm -rf skia/resources/images 2>/dev/null || true
        rm -rf skia/resources/sksl 2>/dev/null || true
        rm -rf skia/docs 2>/dev/null || true
        rm -rf skia/bench 2>/dev/null || true
        rm -rf skia/gm 2>/dev/null || true
        rm -rf dawn-source/docs 2>/dev/null || true
        
        echo "æºç æ¸…ç†å®Œæˆ"
        df -h
        
    # é…ç½®Dawnæ„å»ºï¼ˆè¶…ç²¾ç®€ï¼‰
    - name: é…ç½®Dawnæ„å»º
      run: |
        cd dawn-source
        mkdir -p build-minimal
        cd build-minimal
        
        # æœ€å°åŒ–CMakeé…ç½®
        cmake .. -G Ninja \
          -DCMAKE_BUILD_TYPE=Release \
          -DCMAKE_C_COMPILER=clang-18 \
          -DCMAKE_CXX_COMPILER=clang++-18 \
          -DDAWN_BUILD_SAMPLES=OFF \
          -DDAWN_BUILD_TESTS=OFF \
          -DDAWN_BUILD_BENCHMARKS=OFF \
          -DDAWN_BUILD_FUZZERS=OFF \
          -DDAWN_BUILD_NODE_BINDINGS=OFF \
          -DDAWN_ENABLE_VULKAN=ON \
          -DDAWN_ENABLE_OPENGL=ON \
          -DDAWN_ENABLE_INSTALL=OFF \
          -DDAWN_ENABLE_PIC=OFF \
          -DCMAKE_CXX_STANDARD=20 \
          -DCMAKE_CXX_FLAGS="-O2 -DNDEBUG"
          
    # ç¼–è¯‘Dawnï¼ˆä»…æ ¸å¿ƒåº“ï¼‰
    - name: ç¼–è¯‘Dawnæ ¸å¿ƒåº“
      run: |
        cd dawn-source/build-minimal
        
        # åªç¼–è¯‘æœ€æ ¸å¿ƒçš„ç›®æ ‡
        ninja -j1 dawn_headers dawn_cpp
        
        echo "âœ… Dawnæ ¸å¿ƒåº“ç¼–è¯‘å®Œæˆ"
        df -h || true
        
    # é…ç½®Skiaæ„å»ºï¼ˆè¶…ç²¾ç®€ï¼‰
    - name: é…ç½®Skiaæ„å»º
      run: |
        cd skia
        export PATH=${{ github.workspace }}/depot_tools:$PATH
        
        # æœ€å°åŒ–åŒæ­¥
        python3 tools/git-sync-deps
        
        # è¶…ç²¾ç®€æ„å»ºå‚æ•°
        args="is_official_build=false"
        args="$args is_debug=false"
        args="$args extra_cflags=[\"-O2\", \"-DNDEBUG\"]"
        args="$args skia_use_dawn=false"
        
        # ç¦ç”¨æ‰€æœ‰å¯é€‰åŠŸèƒ½
        args="$args skia_use_system_expat=false"
        args="$args skia_use_system_icu=false"
        args="$args skia_use_system_libjpeg_turbo=false"
        args="$args skia_use_system_libpng=false"
        args="$args skia_use_system_libwebp=false"
        args="$args skia_use_system_zlib=false"
        args="$args skia_use_system_freetype2=false"
        args="$args skia_use_system_harfbuzz=false"
        
        # åªå¯ç”¨æ ¸å¿ƒGPUåŠŸèƒ½
        args="$args skia_enable_gpu=true"
        args="$args skia_use_gl=true"
        args="$args skia_use_vulkan=true"
        args="$args skia_enable_spirv_validation=false"
        
        # ç¦ç”¨æ‰€æœ‰éå¿…è¦åŠŸèƒ½
        args="$args skia_enable_pdf=false"
        args="$args skia_enable_skottie=false"
        args="$args skia_enable_skshaper=false"
        args="$args skia_enable_svg=false"
        args="$args skia_use_icu=false"
        args="$args skia_enable_tools=false"
        args="$args skia_build_fuzzers=false"
        args="$args skia_enable_fontmgr_empty=true"
        args="$args skia_use_freetype=false"
        args="$args skia_use_fontconfig=false"
        args="$args skia_use_harfbuzz=false"
        
        # Linuxå¹³å°é…ç½®
        args="$args skia_use_x11=true"
        args="$args cc=\"clang-18\""
        args="$args cxx=\"clang++-18\""
        args="$args target_os=\"linux\""
        args="$args target_cpu=\"x64\""
        
        echo "BUILD_ARGS=$args" >> $GITHUB_ENV
        
    # ç”ŸæˆSkiaæ„å»ºæ–‡ä»¶
    - name: ç”ŸæˆSkiaæ„å»ºæ–‡ä»¶
      run: |
        cd skia
        export PATH=${{ github.workspace }}/depot_tools:$PATH
        echo "æ­£åœ¨ç”ŸæˆLinuxå¹³å°Skiaæ„å»ºæ–‡ä»¶..."
        bin/gn gen out/Release --args="$BUILD_ARGS"
        echo "æ„å»ºé…ç½®å®Œæˆ"
        df -h || true
        
    # ç¼–è¯‘Skiaï¼ˆè¶…ä¿å®ˆï¼‰
    - name: ç¼–è¯‘Skia
      run: |
        cd skia
        export PATH=${{ github.workspace }}/depot_tools:$PATH
        echo "å¼€å§‹ç¼–è¯‘Linuxå¹³å°Skiaï¼ˆç²¾ç®€ç‰ˆï¼‰..."
        
        # ä½¿ç”¨å•çº¿ç¨‹ç¼–è¯‘ä»¥èŠ‚çœå†…å­˜
        ninja -C out/Release -j1
        
        echo "âœ… Linuxå¹³å°Skiaç¼–è¯‘å®Œæˆ"
        
        # ç«‹å³æ¸…ç†
        find out/Release -name "*.o" -delete 2>/dev/null || true
        find out/Release -name "*.d" -delete 2>/dev/null || true
        df -h || true
        
    # åˆ›å»ºLinuxå‘å¸ƒåŒ…ï¼ˆç²¾ç®€ç‰ˆï¼‰
    - name: åˆ›å»ºLinuxå‘å¸ƒåŒ…
      run: |
        mkdir -p Skia/include/core
        mkdir -p Skia/include/dawn
        mkdir -p Skia/lib/linux/x64
        
        # åªå¤åˆ¶æ ¸å¿ƒå¤´æ–‡ä»¶
        cp -r skia/include/* Skia/include/core/
        
        # å¤åˆ¶Dawnå¤´æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        cp -r dawn-source/include/* Skia/include/dawn/ 2>/dev/null || true
        
        # å¤åˆ¶åº“æ–‡ä»¶
        find skia/out/Release -name "*.a" -exec cp {} Skia/lib/linux/x64/ \; 2>/dev/null || true
        find dawn-source/build-minimal -name "*.a" -exec cp {} Skia/lib/linux/x64/ \; 2>/dev/null || true
        
        # åˆ›å»ºç®€åŒ–çš„CMakeLists.txt
        cat > Skia/CMakeLists.txt << 'EOF'
# Skia ç²¾ç®€ç‰ˆCMakeé…ç½®ï¼ˆLinuxï¼‰
cmake_minimum_required(VERSION 3.20)

project(SkiaLinux VERSION 1.0.0 LANGUAGES CXX C)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

get_filename_component(SKIA_ROOT_DIR "${CMAKE_CURRENT_LIST_DIR}" ABSOLUTE)

add_library(Skia INTERFACE)
add_library(skia::skia ALIAS Skia)

target_include_directories(Skia INTERFACE
    $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/include/core>
    $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/include/dawn>
    $<INSTALL_INTERFACE:include/core>
    $<INSTALL_INTERFACE:include/dawn>
)

file(GLOB SKIA_LIBS "${SKIA_ROOT_DIR}/lib/linux/x64/*.a")
if(SKIA_LIBS)
    target_link_libraries(Skia INTERFACE ${SKIA_LIBS})
endif()

target_link_libraries(Skia INTERFACE GL X11 pthread dl m)

target_compile_definitions(Skia INTERFACE
    SK_GANESH=1 SK_VULKAN=1 SK_GL=1
)

target_compile_features(Skia INTERFACE cxx_std_20)
EOF
        
        echo "âœ… Linuxç²¾ç®€ç‰ˆæ„å»ºåŒ…åˆ›å»ºå®Œæˆ"
        df -h || true
        
    # æ‰“åŒ…Linuxæ„å»ºäº§ç‰©
    - name: æ‰“åŒ…Linuxæ„å»ºäº§ç‰©
      run: |
        zip -9 -r "${{ matrix.platform }}.zip" Skia/
        echo "âœ… ${{ matrix.platform }}.zip æ„å»ºåŒ…åˆ›å»ºå®Œæˆ"
        ls -lh ${{ matrix.platform }}.zip
        
        # æ¸…ç†æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶
        rm -rf Skia/ skia/ dawn-source/ depot_tools/
        df -h || true
        
    # ä¸Šä¼ Linuxæ„å»ºäº§ç‰©
    - name: ä¸Šä¼ Linuxæ„å»ºäº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: ${{ matrix.platform }}
        path: ${{ matrix.platform }}.zip
        retention-days: 7
        compression-level: 0

  # Androidå¹³å°æ„å»ºï¼ˆæœ€ä¿å®ˆç‰ˆæœ¬ï¼‰
  build-android:
    runs-on: ubuntu-24.04
    strategy:
      matrix:
        include:
          - platform: arm64_android
            arch: arm64
            target_os: android
            target_cpu: arm64
            android_api: 21
            compiler: clang18

    steps:
    # æ£€å‡ºä»£ç ä»“åº“
    - name: æ£€å‡ºä»£ç ä»“åº“
      uses: actions/checkout@v4
      
    # æé™æ¸…ç†ç£ç›˜ç©ºé—´ï¼ˆAndroidç‰ˆï¼‰
    - name: æé™æ¸…ç†ç£ç›˜ç©ºé—´
      run: |
        echo "æ¸…ç†å‰ç£ç›˜ä½¿ç”¨æƒ…å†µï¼š"
        df -h
        
        # æ‰§è¡Œæœ€æ¿€è¿›çš„æ¸…ç†
        sudo systemctl stop docker mysql postgresql
        sudo apt-get remove -y '^dotnet-.*' '^llvm-.*' '^clang-.*' azure-cli google-cloud-cli firefox google-chrome-stable microsoft-edge-stable
        sudo apt-get autoremove -y && sudo apt-get autoclean
        
        # åˆ é™¤æ‰€æœ‰å¤§å‹ç›®å½•
        sudo rm -rf /usr/share/dotnet /usr/local/lib/android /opt/ghc /opt/hostedtoolcache /usr/local/share/boost /usr/local/graalvm /usr/local/share/chromium /usr/local/share/firefox /usr/share/gradle /usr/local/lib/node_modules /root/.cache /home/runner/.cache /var/lib/docker
        
        # æ¸…ç†ç³»ç»Ÿ
        sudo journalctl --vacuum-time=1d
        sudo rm -rf /tmp/* /var/tmp/*
        
        echo "æ¸…ç†åç£ç›˜ä½¿ç”¨æƒ…å†µï¼š"
        df -h
        
    # è®¾ç½®Pythonç¯å¢ƒ
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    # è®¾ç½®Android NDKï¼ˆè½»é‡çº§ï¼‰
    - name: è®¾ç½®Android NDK
      uses: nttld/setup-ndk@v1
      with:
        ndk-version: r26d
        
    # å®‰è£…æœ€å°åŒ–ä¾èµ–
    - name: å®‰è£…æœ€å°åŒ–ä¾èµ–
      run: |
        sudo apt-get update
        sudo apt-get install -y --no-install-recommends build-essential ninja-build cmake clang-18
        sudo update-alternatives --install /usr/bin/clang clang /usr/bin/clang-18 100
        sudo update-alternatives --install /usr/bin/clang++ clang++ /usr/bin/clang++-18 100
        
    # è·å–è¶…ç²¾ç®€depot_tools
    - name: è·å–è¶…ç²¾ç®€depot_tools
      run: |
        git clone --depth=1 --single-branch https://chromium.googlesource.com/chromium/tools/depot_tools.git
        echo "${{ github.workspace }}/depot_tools" >> $GITHUB_PATH
        
    # è·å–Androidä¸“ç”¨ç²¾ç®€Skia
    - name: è·å–Androidä¸“ç”¨ç²¾ç®€Skia
      run: |
        export PATH=${{ github.workspace }}/depot_tools:$PATH
        
        # Androidä¸“ç”¨æœ€å°åŒ–é…ç½®
        cat > .gclient << 'EOF'
        solutions = [
          {
            "name": "skia",
            "url": "https://skia.googlesource.com/skia.git",
            "deps_file": "DEPS",
            "managed": False,
            "custom_deps": {
              "skia/third_party/externals/angle2": None,
              "skia/third_party/externals/dawn": None,
              "skia/third_party/externals/dng_sdk": None,
              "skia/third_party/externals/piex": None,
              "skia/third_party/externals/imgui": None,
            },
          },
        ]
        EOF
        
        gclient sync --no-history --shallow --jobs=1 --delete_unversioned_trees
        
        # ç«‹å³æ¸…ç†
        find . -name "*test*" -type f \( -name "*.cpp" -o -name "*.cc" -o -name "*.h" \) -delete 2>/dev/null || true
        find . -name "*.png" -size +10k -delete 2>/dev/null || true
        rm -rf skia/resources skia/docs skia/bench skia/gm 2>/dev/null || true
        
        df -h || true
        
    # é…ç½®Android Skiaæ„å»ºï¼ˆä»…æ ¸å¿ƒåŠŸèƒ½ï¼‰
    - name: é…ç½®Android Skiaæ„å»º
      run: |
        cd skia
        export PATH=${{ github.workspace }}/depot_tools:$PATH
        python3 tools/git-sync-deps
        
        # Androidè¶…ç²¾ç®€æ„å»ºå‚æ•°
        args="is_official_build=false"
        args="$args is_debug=false"
        args="$args extra_cflags=[\"-O2\", \"-DNDEBUG\"]"
        
        # ç¦ç”¨æ‰€æœ‰å¯é€‰åŠŸèƒ½
        args="$args skia_use_dawn=false"
        args="$args skia_enable_pdf=false"
        args="$args skia_enable_skottie=false"
        args="$args skia_enable_skshaper=false"
        args="$args skia_enable_svg=false"
        args="$args skia_use_icu=false"
        args="$args skia_enable_tools=false"
        args="$args skia_build_fuzzers=false"
        args="$args skia_use_freetype=true"
        args="$args skia_use_system_freetype2=false"
        
        # åªå¯ç”¨æ ¸å¿ƒGPUåŠŸèƒ½
        args="$args skia_enable_gpu=true"
        args="$args skia_use_vulkan=true"
        args="$args skia_use_gl=true"
        args="$args skia_enable_spirv_validation=false"
        
        # Androidå¹³å°é…ç½®
        args="$args ndk=\"$ANDROID_NDK_HOME\""
        args="$args android_api_level=21"
        args="$args skia_enable_fontmgr_android=true"
        args="$args target_os=\"android\""
        args="$args target_cpu=\"arm64\""
        
        echo "BUILD_ARGS=$args" >> $GITHUB_ENV
        df -h || true
        
    # ç”ŸæˆAndroid Skiaæ„å»ºæ–‡ä»¶
    - name: ç”ŸæˆAndroid Skiaæ„å»ºæ–‡ä»¶
      run: |
        cd skia
        export PATH=${{ github.workspace }}/depot_tools:$PATH
        bin/gn gen out/Release --args="$BUILD_ARGS"
        df -h || true
        
    # ç¼–è¯‘Android Skiaï¼ˆå•çº¿ç¨‹ï¼‰
    - name: ç¼–è¯‘Android Skia
      run: |
        cd skia
        export PATH=${{ github.workspace }}/depot_tools:$PATH
        echo "å¼€å§‹ç¼–è¯‘Androidå¹³å°Skiaï¼ˆè¶…ç²¾ç®€ç‰ˆï¼‰..."
        
        # å•çº¿ç¨‹ç¼–è¯‘
        ninja -C out/Release -j1
        
        echo "âœ… Androidå¹³å°Skiaç¼–è¯‘å®Œæˆ"
        
        # ç«‹å³æ¸…ç†
        find out/Release -name "*.o" -delete 2>/dev/null || true
        df -h || true
        
    # åˆ›å»ºAndroidå‘å¸ƒåŒ…
    - name: åˆ›å»ºAndroidå‘å¸ƒåŒ…
      run: |
        mkdir -p Skia/include/core
        mkdir -p Skia/lib/android/arm64
        
        # å¤åˆ¶å¤´æ–‡ä»¶å’Œåº“
        cp -r skia/include/* Skia/include/core/
        find skia/out/Release -name "*.a" -exec cp {} Skia/lib/android/arm64/ \; 2>/dev/null || true
        
        # åˆ›å»ºAndroidä¸“ç”¨CMakeLists.txt
        cat > Skia/CMakeLists.txt << 'EOF'
# Skia Androidç‰ˆCMakeé…ç½®
cmake_minimum_required(VERSION 3.20)
project(SkiaAndroid VERSION 1.0.0 LANGUAGES CXX C)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

get_filename_component(SKIA_ROOT_DIR "${CMAKE_CURRENT_LIST_DIR}" ABSOLUTE)

add_library(Skia INTERFACE)
add_library(skia::skia ALIAS Skia)

target_include_directories(Skia INTERFACE
    $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/include/core>
    $<INSTALL_INTERFACE:include/core>
)

file(GLOB SKIA_LIBS "${SKIA_ROOT_DIR}/lib/android/arm64/*.a")
if(SKIA_LIBS)
    target_link_libraries(Skia INTERFACE ${SKIA_LIBS})
endif()

if(ANDROID)
    target_link_libraries(Skia INTERFACE GLESv2 EGL vulkan android log dl m z)
    target_compile_definitions(Skia INTERFACE
        ANDROID SK_GANESH=1 SK_VULKAN=1 SK_GL=1 __ANDROID_API__=21
    )
endif()

target_compile_features(Skia INTERFACE cxx_std_20)
EOF
        
        echo "âœ… Androidæ„å»ºåŒ…åˆ›å»ºå®Œæˆ"
        df -h || true
        
    # æ‰“åŒ…Androidæ„å»ºäº§ç‰©
    - name: æ‰“åŒ…Androidæ„å»ºäº§ç‰©
      run: |
        zip -9 -r "${{ matrix.platform }}.zip" Skia/
        echo "âœ… ${{ matrix.platform }}.zip æ„å»ºåŒ…åˆ›å»ºå®Œæˆ"
        ls -lh ${{ matrix.platform }}.zip
        
        # æ¸…ç†æ‰€æœ‰æ–‡ä»¶
        rm -rf Skia/ skia/ depot_tools/
        df -h || true
        
    # ä¸Šä¼ Androidæ„å»ºäº§ç‰©
    - name: ä¸Šä¼ Androidæ„å»ºäº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: ${{ matrix.platform }}
        path: ${{ matrix.platform }}.zip
        retention-days: 7
        compression-level: 0

  # åˆ›å»ºæœ€ç»ˆå‘å¸ƒ
  create-release:
    needs: [build-windows, build-linux, build-android]
    runs-on: ubuntu-latest
    if: |
      (github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master')) ||
      github.event_name == 'schedule'
    
    permissions:
      contents: write
      packages: write
    
    steps:
    # æ£€å‡ºä»£ç 
    - name: æ£€å‡ºä»£ç ä»“åº“
      uses: actions/checkout@v4
      
    # ä¸‹è½½æ‰€æœ‰æ„å»ºäº§ç‰©
    - name: ä¸‹è½½æ‰€æœ‰æ„å»ºäº§ç‰©
      uses: actions/download-artifact@v4
      with:
        path: artifacts
        
    # è·å–å‘å¸ƒæ ‡ç­¾
    - name: è·å–å‘å¸ƒæ ‡ç­¾
      id: get_tag
      run: |
        if [ "${{ github.event_name }}" = "schedule" ]; then
          echo "tag=skia-dawn-daily-$(date +%Y%m%d)" >> $GITHUB_OUTPUT
          echo "name=Skia+Dawnè¶…ç²¾ç®€ç‰ˆæ¯æ—¥æ„å»ºåŒ… $(date +%Y-%m-%d)" >> $GITHUB_OUTPUT
        else
          echo "tag=skia-dawn-build-${{ github.run_number }}" >> $GITHUB_OUTPUT
          echo "name=Skia+Dawnè¶…ç²¾ç®€ç‰ˆæ„å»ºåŒ… v${{ github.run_number }}" >> $GITHUB_OUTPUT
        fi
        
    # åˆ›å»ºGitHub Release
    - name: åˆ›å»ºGitHub Release
      uses: softprops/action-gh-release@v2
      with:
        tag_name: ${{ steps.get_tag.outputs.tag }}
        name: ${{ steps.get_tag.outputs.name }}
        body: |
          # Skia + Dawn WebGPU è¶…ç²¾ç®€ç‰ˆæ„å»ºåŒ…
          
          è¿™æ˜¯ç»è¿‡æé™å­˜å‚¨ä¼˜åŒ–çš„Skiaå›¾å½¢åº“æ„å»ºåŒ…ï¼Œä¸“é—¨ä¸ºè§£å†³GitHub Actionså­˜å‚¨ç©ºé—´ä¸è¶³é—®é¢˜è€Œè®¾è®¡ã€‚
          
          ## âš ï¸ é‡è¦è¯´æ˜
          
          ç”±äºGitHub Actions Ubuntu runnerså­˜å‚¨ç©ºé—´é™åˆ¶ï¼Œæœ¬ç‰ˆæœ¬è¿›è¡Œäº†ä»¥ä¸‹ä¼˜åŒ–ï¼š
          
          ### ğŸ”§ ä¼˜åŒ–æªæ–½
          - **Windowsç‰ˆæœ¬**: å®Œæ•´åŠŸèƒ½ï¼ŒåŒ…å«Dawn WebGPUæ”¯æŒ
          - **Linuxç‰ˆæœ¬**: ç²¾ç®€ç‰ˆï¼Œä»…æ ¸å¿ƒGPUåŠŸèƒ½ï¼Œç§»é™¤Dawnä»¥èŠ‚çœç©ºé—´
          - **Androidç‰ˆæœ¬**: è¶…ç²¾ç®€ç‰ˆï¼Œä»…æ ¸å¿ƒåŠŸèƒ½
          
          ### ğŸ“¦ åŒ…å«çš„å¹³å°
          
          #### Windowså¹³å° (å®Œæ•´ç‰ˆ)
          - **x64_windows.zip** - Windows x64æ¶æ„
            - **å›¾å½¢åç«¯**: DirectX 11/12 + Vulkan + OpenGL + Dawn WebGPU
            - **åŠŸèƒ½**: å®Œæ•´çš„SkiaåŠŸèƒ½ + Dawn WebGPU
            - **ç¼–è¯‘å™¨**: MSVC 2022 + Clang 18
          
          #### Linuxå¹³å° (ç²¾ç®€ç‰ˆ)
          - **x64_linux.zip** - Linux x64æ¶æ„
            - **å›¾å½¢åç«¯**: Vulkan + OpenGLï¼ˆæ— Dawnï¼‰
            - **åŠŸèƒ½**: æ ¸å¿ƒGPUæ¸²æŸ“åŠŸèƒ½
            - **ç¼–è¯‘å™¨**: Clang 18
          
          #### Androidå¹³å° (è¶…ç²¾ç®€ç‰ˆ)
          - **arm64_android.zip** - Android ARM64æ¶æ„
            - **å›¾å½¢åç«¯**: Vulkan + OpenGL ESï¼ˆæ— Dawnï¼‰
            - **åŠŸèƒ½**: åŸºç¡€GPUæ¸²æŸ“
            - **APIçº§åˆ«**: 21+
          
          ## ğŸš€ ä½¿ç”¨æ–¹æ³•
          
          ```cmake
          # è®¾ç½®C++20æ ‡å‡†
          set(CMAKE_CXX_STANDARD 20)
          set(CMAKE_CXX_STANDARD_REQUIRED ON)
          
          # æ·»åŠ SkiaåŒ…
          add_subdirectory(path/to/Skia)
          
          # é“¾æ¥åˆ°æ‚¨çš„ç›®æ ‡
          target_link_libraries(your_target skia::skia)
          ```
          
          ## ğŸ“‹ ç‰ˆæœ¬å·®å¼‚
          
          | å¹³å° | Dawn WebGPU | PDFæ”¯æŒ | SVGæ”¯æŒ | æ–‡æœ¬æ•´å½¢ | åŒ…å¤§å° |
          |------|-------------|---------|---------|----------|--------|
          | Windows | âœ… å®Œæ•´ | âœ… | âœ… | âœ… | å¤§ |
          | Linux | âŒ æ—  | âŒ | âŒ | âŒ | å° |
          | Android | âŒ æ—  | âŒ | âŒ | âŒ | æœ€å° |
          
          ## ğŸ’¡ å»ºè®®
          
          - **ç”Ÿäº§ç¯å¢ƒ**: æ¨èä½¿ç”¨Windowsç‰ˆæœ¬ï¼ŒåŠŸèƒ½æœ€å®Œæ•´
          - **å¿«é€ŸåŸå‹**: Linux/Androidç‰ˆæœ¬é€‚åˆåŸºç¡€GPUæ¸²æŸ“éœ€æ±‚
          - **å®Œæ•´åŠŸèƒ½**: å¦‚éœ€å®Œæ•´åŠŸèƒ½ï¼Œå»ºè®®åœ¨æœ¬åœ°ç¯å¢ƒç¼–è¯‘
          
          è¿™æ˜¯é’ˆå¯¹GitHub Actionså­˜å‚¨é™åˆ¶çš„ä¸´æ—¶è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬æ­£åœ¨å¯»æ‰¾æ›´å¥½çš„æ–¹æ¡ˆæ¥æä¾›å®Œæ•´ç‰ˆæœ¬ã€‚
        files: |
          artifacts/*/**.zip
        draft: false
        prerelease: false
        generate_release_notes: false
        make_latest: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    # æ„å»ºå®Œæˆé€šçŸ¥
    - name: æ„å»ºå®Œæˆé€šçŸ¥
      run: |
        echo "ğŸ‰ Skia + Dawn è¶…ç²¾ç®€ç‰ˆæ„å»ºå®Œæˆï¼"
        echo "âš ï¸  æ³¨æ„ï¼šç”±äºå­˜å‚¨ç©ºé—´é™åˆ¶ï¼Œå„å¹³å°åŠŸèƒ½æœ‰æ‰€å·®å¼‚"
        echo "ğŸ“¦ æ„å»ºç»“æœï¼š"
        echo "   â€¢ Windows x64: å®Œæ•´ç‰ˆ (DirectX + Vulkan + OpenGL + Dawn WebGPU)"
        echo "   â€¢ Linux x64: ç²¾ç®€ç‰ˆ (Vulkan + OpenGLï¼Œæ— Dawn)"  
        echo "   â€¢ Android ARM64: è¶…ç²¾ç®€ç‰ˆ (åŸºç¡€GPUåŠŸèƒ½)"
        echo "ğŸ’¡ å»ºè®®ï¼šç”Ÿäº§ç¯å¢ƒä¼˜å…ˆä½¿ç”¨Windowsç‰ˆæœ¬"
        echo "ğŸ” æ­£åœ¨å¯»æ‰¾æ›´å¥½çš„è§£å†³æ–¹æ¡ˆä»¥æä¾›å®Œæ•´ç‰ˆæœ¬"
