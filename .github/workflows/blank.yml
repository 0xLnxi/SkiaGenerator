# Skia Dawn WebGPU å…¨å¹³å°ç»Ÿä¸€æ„å»ºå·¥ä½œæµ - ä¿®æ­£C++20å…¼å®¹æ€§é—®é¢˜
name: ç¼–è¯‘ Skia Dawn WebGPU å…¨å¹³å°æ„å»ºåŒ…

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´ä¸Šåˆ8ç‚¹ï¼ˆUTCæ—¶é—´0ç‚¹ï¼‰æ‰§è¡Œä¸€æ¬¡
    - cron: '0 0 * * *'

# è®¾ç½®å·¥ä½œæµæƒé™
permissions:
  contents: write
  packages: write
  actions: read

jobs:
  build-skia-dawn-all:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        include:
          # Windows x64æ¶æ„ - Dawnæ”¯æŒ
          - os: windows-latest
            platform: x64_windows_dawn
            arch: x64
            target_os: win
            target_cpu: x64
            
          # macOS x64æ¶æ„ - Dawnæ”¯æŒï¼Œä½¿ç”¨æœ€æ–°macOSä»¥è·å¾—æ›´å¥½çš„C++20æ”¯æŒ
          - os: macos-14
            platform: x64_macos_dawn
            arch: x64
            target_os: mac
            target_cpu: x64
            
          # macOS ARM64æ¶æ„ - Dawnæ”¯æŒï¼Œä½¿ç”¨æœ€æ–°macOSä»¥è·å¾—æ›´å¥½çš„C++20æ”¯æŒ
          - os: macos-14
            platform: arm64_macos_dawn
            arch: arm64
            target_os: mac
            target_cpu: arm64
            
          # Linux x64æ¶æ„ - Dawnæ”¯æŒ
          - os: ubuntu-latest
            platform: x64_linux_dawn
            arch: x64
            target_os: linux
            target_cpu: x64
            
          # Android x64æ¶æ„ - Dawnæ”¯æŒ
          - os: ubuntu-latest
            platform: x64_android_dawn
            arch: x64
            target_os: android
            target_cpu: x64
            android_api: 21
            
          # Android ARM64æ¶æ„ - Dawnæ”¯æŒ
          - os: ubuntu-latest
            platform: arm64_android_dawn
            arch: arm64
            target_os: android
            target_cpu: arm64
            android_api: 21

    steps:
    # æ£€å‡ºä»£ç ä»“åº“
    - name: æ£€å‡ºä»£ç ä»“åº“
      uses: actions/checkout@v4
      
    # è®¾ç½®Pythonè¿è¡Œç¯å¢ƒ
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
        
    # å®‰è£…Linuxç³»ç»Ÿä¾èµ–åŒ…ï¼ˆLinuxå’ŒAndroidæ„å»ºéœ€è¦ï¼‰
    - name: å®‰è£…Linuxç³»ç»Ÿä¾èµ–
      if: runner.os == 'Linux'
      run: |
        sudo apt-get update
        # å®‰è£…åŸºç¡€æ„å»ºå·¥å…· - ç¡®ä¿ä½¿ç”¨æ”¯æŒC++20çš„ç¼–è¯‘å™¨
        sudo apt-get install -y build-essential ninja-build
        # å®‰è£…æ›´æ–°çš„GCCå’ŒG++ä»¥æ”¯æŒC++20
        sudo apt-get install -y gcc-12 g++-12
        # è®¾ç½®é»˜è®¤ç¼–è¯‘å™¨ä¸ºæ”¯æŒC++20çš„ç‰ˆæœ¬
        sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-12 100
        sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-12 100
        # éªŒè¯ç¼–è¯‘å™¨ç‰ˆæœ¬
        gcc --version
        g++ --version
        # å®‰è£…å›¾å½¢å’Œå­—ä½“ç›¸å…³ä¾èµ–
        sudo apt-get install -y libfontconfig1-dev libfreetype6-dev libgl1-mesa-dev
        # å®‰è£…Vulkanå¼€å‘åº“
        sudo apt-get install -y libvulkan-dev vulkan-tools
        # å®‰è£…Dawn WebGPUæ‰€éœ€çš„é¢å¤–åº“
        sudo apt-get install -y libxrandr-dev libxinerama-dev libxcursor-dev libxi-dev
        sudo apt-get install -y libwayland-dev libwayland-egl-backend-dev
        sudo apt-get install -y libegl1-mesa-dev libgles2-mesa-dev
        # å®‰è£…ICUå’ŒHarfBuzz
        sudo apt-get install -y libicu-dev libharfbuzz-dev
        # å®‰è£…Javaå¼€å‘ç¯å¢ƒï¼ˆAndroidæ„å»ºéœ€è¦ï¼‰
        sudo apt-get install -y openjdk-11-jdk
        
    # å®‰è£…macOSç³»ç»Ÿä¾èµ–å¹¶å‡çº§Xcodeå·¥å…·é“¾
    - name: å®‰è£…macOSç³»ç»Ÿä¾èµ–å¹¶å‡çº§å·¥å…·é“¾
      if: runner.os == 'macOS'
      run: |
        # å®‰è£…Xcodeå‘½ä»¤è¡Œå·¥å…·
        xcode-select --install 2>/dev/null || true
        # å®‰è£…ninjaæ„å»ºå·¥å…·
        brew install ninja || true
        # éªŒè¯Xcodeç‰ˆæœ¬æ”¯æŒC++20
        xcodebuild -version
        # æ£€æŸ¥clangç‰ˆæœ¬ä»¥ç¡®ä¿æ”¯æŒC++20
        clang --version
        # ç¡®ä¿æˆ‘ä»¬æœ‰è¶³å¤Ÿæ–°çš„Xcodeç‰ˆæœ¬æ”¯æŒC++20çš„concepts
        if xcodebuild -version | grep -q "Xcode 1[5-9]"; then
          echo "âœ… Xcodeç‰ˆæœ¬è¶³å¤Ÿæ–°ï¼Œæ”¯æŒC++20"
        else
          echo "âš ï¸  Xcodeç‰ˆæœ¬å¯èƒ½è¾ƒæ—§ï¼Œä½†ä¼šå°è¯•ç»§ç»­æ„å»º"
        fi
        
    # å®‰è£…Windowsç³»ç»Ÿä¾èµ–
    - name: å®‰è£…Windowsç³»ç»Ÿä¾èµ–
      if: runner.os == 'Windows'
      run: |
        # å®‰è£…ninjaæ„å»ºå·¥å…·
        choco install ninja -y
        # Windowsçš„MSVCé»˜è®¤æ”¯æŒC++20
        
    # è®¾ç½®Android NDKç¯å¢ƒï¼ˆä»…é™Androidå¹³å°ï¼‰
    - name: è®¾ç½®Android NDK
      if: matrix.target_os == 'android'
      uses: nttld/setup-ndk@v1
      with:
        ndk-version: r25c
        
    # è·å–Googleçš„depot_toolså·¥å…·é›†
    - name: è·å–depot_tools
      run: |
        git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git
        echo "${{ github.workspace }}/depot_tools" >> $GITHUB_PATH
      shell: bash
      
    # è®¾ç½®Windowsç³»ç»Ÿçš„depot_toolsç¯å¢ƒå˜é‡
    - name: è®¾ç½®depot_toolsç¯å¢ƒå˜é‡
      if: runner.os == 'Windows'
      run: |
        echo "${{ github.workspace }}\depot_tools" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append
        # ç¦ç”¨depot_toolsè‡ªåŠ¨ä¸‹è½½å·¥å…·é“¾
        echo "DEPOT_TOOLS_WIN_TOOLCHAIN=0" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf8 -Append
        
    # è·å–Skiaæºä»£ç å¹¶åŒæ­¥ä¾èµ–ï¼ˆåŒ…æ‹¬Dawnï¼‰
    - name: è·å–Skiaæºä»£ç å’ŒDawnä¾èµ–
      run: |
        git clone https://skia.googlesource.com/skia.git
        cd skia
        python tools/git-sync-deps
      shell: bash
      
    # é…ç½®å¯ç”¨Dawnå’ŒGraphiteåç«¯çš„æ„å»ºå‚æ•°ï¼Œæ ¹æ®å¹³å°å¯ç”¨å¯¹åº”åç«¯
    - name: é…ç½®Dawn WebGPUå’ŒGraphiteæ„å»ºå‚æ•°
      run: |
        cd skia
        
        # åŸºç¡€æ„å»ºå‚æ•°è®¾ç½® - å¯ç”¨å…¨é‡åŠŸèƒ½
        args="is_official_build=true"
        args="$args skia_use_system_expat=false"
        args="$args skia_use_system_icu=false"
        args="$args skia_use_system_libjpeg_turbo=false"
        args="$args skia_use_system_libpng=false"
        args="$args skia_use_system_libwebp=false"
        args="$args skia_use_system_zlib=false"
        
        # å¯ç”¨å…¨é‡åŠŸèƒ½æ”¯æŒï¼Œä½†ä½¿ç”¨å†…ç½®ä¾èµ–åº“
        args="$args skia_enable_pdf=true"
        args="$args skia_enable_skottie=true"
        args="$args skia_enable_skshaper=true"
        args="$args skia_enable_svg=true"
        args="$args skia_use_icu=true"
        
        # å¯ç”¨GPUåç«¯æ”¯æŒ - åŒ…å«Dawn WebGPUå’ŒGraphite
        args="$args skia_enable_gpu=true"
        args="$args skia_enable_graphite=true"
        args="$args skia_use_gl=true"
        args="$args skia_use_vulkan=true"
        args="$args skia_use_dawn=true"
        args="$args skia_enable_spirv_validation=false"
        
        # ç¦ç”¨å·¥å…·æ„å»ºä»¥é¿å…æµ‹è¯•å·¥å…·APIé—®é¢˜
        args="$args skia_enable_tools=false"
        
        # è®¾ç½®ç›®æ ‡å¹³å°å’Œæ¶æ„
        args="$args target_os=\"${{ matrix.target_os }}\""
        args="$args target_cpu=\"${{ matrix.target_cpu }}\""
        
        # æ ¹æ®ä¸åŒå¹³å°è®¾ç½®ç‰¹å®šå‚æ•°å’ŒDawnåç«¯ï¼ŒåŒ…æ‹¬C++20æ”¯æŒ
        case "${{ matrix.target_os }}" in
          "win")
            # Windowså¹³å°ç‰¹å®šé…ç½® - ä½¿ç”¨/MDè¿è¡Œæ—¶ï¼Œå¯ç”¨Dawn D3D12åç«¯ï¼ŒC++20æ”¯æŒ
            args="$args skia_use_angle=true"
            args="$args skia_use_direct3d=true"
            args="$args skia_use_freetype=true"
            args="$args skia_use_system_freetype2=false"
            args="$args skia_use_harfbuzz=true"
            args="$args skia_use_system_harfbuzz=false"
            args="$args skia_use_dng_sdk=false"
            args="$args skia_use_piex=false"
            # è®¾ç½®Windowsä½¿ç”¨/MDè¿è¡Œæ—¶ï¼ˆå¤šçº¿ç¨‹DLLï¼‰å’ŒC++20
            args="$args extra_cflags=[\"/MD\", \"/std:c++20\"]"
            args="$args extra_cflags_c=[\"/MD\"]"
            args="$args extra_cflags_cc=[\"/MD\", \"/std:c++20\"]"
            # Dawn Windowsç‰¹å®šè®¾ç½® - åªå¯ç”¨Windowsåç«¯
            args="$args dawn_enable_d3d12=true"
            args="$args dawn_enable_d3d11=true"
            args="$args dawn_enable_vulkan=true"
            args="$args dawn_enable_opengles=false"
            args="$args dawn_enable_desktop_gl=false"
            args="$args dawn_enable_metal=false"
            args="$args dawn_enable_null=false"
            ;;
          "mac")
            # macOSå¹³å°ç‰¹å®šé…ç½® - ä½¿ç”¨å†…ç½®åº“é¿å…ç³»ç»Ÿåº“å†²çªï¼Œå¯ç”¨Dawn Metalåç«¯ï¼ŒC++20æ”¯æŒ
            args="$args skia_use_metal=true"
            args="$args skia_enable_skottie=true"
            args="$args skia_use_freetype=true"
            args="$args skia_use_system_freetype2=false"
            args="$args skia_use_fontconfig=false"
            args="$args skia_use_harfbuzz=true"
            args="$args skia_use_system_harfbuzz=false"
            args="$args skia_pdf_subset_harfbuzz=true"
            args="$args skia_use_dng_sdk=true"
            args="$args skia_use_piex=true"
            # è®¾ç½®C++20æ”¯æŒï¼Œå¹¶å¼ºåˆ¶ä½¿ç”¨æ›´ç°ä»£çš„è¯­è¨€ç‰¹æ€§
            args="$args extra_cflags_cc=[\"-std=c++20\", \"-Wno-unknown-warning-option\", \"-Wno-c++20-compat\"]"
            # ç¡®ä¿ä½¿ç”¨libc++ï¼ˆç°ä»£C++æ ‡å‡†åº“ï¼‰
            args="$args extra_cflags_cc=[\"-std=c++20\", \"-stdlib=libc++\", \"-Wno-unknown-warning-option\"]"
            args="$args extra_ldflags=[\"-stdlib=libc++\"]"
            # Dawn macOSç‰¹å®šè®¾ç½® - åªå¯ç”¨macOSåç«¯
            args="$args dawn_enable_metal=true"
            args="$args dawn_enable_vulkan=false"
            args="$args dawn_enable_opengles=false"
            args="$args dawn_enable_desktop_gl=false"
            args="$args dawn_enable_d3d12=false"
            args="$args dawn_enable_d3d11=false"
            args="$args dawn_enable_null=false"
            if [ "${{ matrix.target_cpu }}" = "arm64" ]; then
              args="$args target_cpu=\"arm64\""
            fi
            ;;
          "linux")
            # Linuxå¹³å°ç‰¹å®šé…ç½® - å¯ç”¨Dawn Vulkanåç«¯ï¼ŒC++20æ”¯æŒ
            args="$args skia_use_x11=true"
            args="$args skia_use_freetype=true"
            args="$args skia_use_fontconfig=true"
            args="$args skia_use_harfbuzz=true"
            args="$args skia_use_dng_sdk=true"
            args="$args skia_use_piex=true"
            # è®¾ç½®C++20æ”¯æŒ
            args="$args extra_cflags_cc=[\"-std=c++20\"]"
            # Dawn Linuxç‰¹å®šè®¾ç½® - åªå¯ç”¨Linuxåç«¯
            args="$args dawn_enable_vulkan=true"
            args="$args dawn_enable_opengles=true"
            args="$args dawn_enable_desktop_gl=true"
            args="$args dawn_use_x11=true"
            args="$args dawn_enable_metal=false"
            args="$args dawn_enable_d3d12=false"
            args="$args dawn_enable_d3d11=false"
            args="$args dawn_enable_null=false"
            args="$args cc=\"gcc-12\""
            args="$args cxx=\"g++-12\""
            args="$args skia_use_system_freetype2=true"
            args="$args skia_use_system_harfbuzz=true"
            ;;
          "android")
            # Androidå¹³å°ç‰¹å®šé…ç½® - å¯ç”¨Dawn Vulkanå’ŒOpenGL ESåç«¯ï¼ŒC++20æ”¯æŒ
            args="$args ndk=\"$ANDROID_NDK_ROOT\""
            args="$args android_api_level=${{ matrix.android_api }}"
            args="$args skia_use_system_freetype2=false"
            args="$args skia_use_freetype=true"
            args="$args skia_enable_fontmgr_android=true"
            args="$args skia_use_vulkan=true"
            args="$args skia_use_harfbuzz=true"
            args="$args skia_use_system_harfbuzz=false"
            args="$args skia_use_dng_sdk=true"
            args="$args skia_use_piex=true"
            # è®¾ç½®C++20æ”¯æŒ
            args="$args extra_cflags_cc=[\"-std=c++20\"]"
            # Dawn Androidç‰¹å®šè®¾ç½® - åªå¯ç”¨Androidåç«¯
            args="$args dawn_enable_vulkan=true"
            args="$args dawn_enable_opengles=true"
            args="$args dawn_enable_desktop_gl=false"
            args="$args dawn_enable_metal=false"
            args="$args dawn_enable_d3d12=false"
            args="$args dawn_enable_d3d11=false"
            args="$args dawn_enable_null=false"
            ;;
        esac
        
        echo "BUILD_ARGS=$args" >> $GITHUB_ENV
      shell: bash
      
    # ä½¿ç”¨GNç”Ÿæˆæ„å»ºæ–‡ä»¶
    - name: ç”ŸæˆDawn WebGPUå’ŒGraphiteæ„å»ºæ–‡ä»¶
      run: |
        cd skia
        echo "æ­£åœ¨ä¸º ${{ matrix.target_os }} å¹³å°ç”Ÿæˆæ„å»ºæ–‡ä»¶..."
        bin/gn gen out/Release --args="$BUILD_ARGS"
        echo "æ„å»ºé…ç½®å®Œæˆï¼ŒéªŒè¯Dawnåç«¯é…ç½®..."
        case "${{ matrix.target_os }}" in
          "win")
            echo "Windowså¹³å°å·²å¯ç”¨: Direct3D 12/11 + Vulkan"
            ;;
          "mac")
            echo "macOSå¹³å°å·²å¯ç”¨: Metal"
            ;;
          "linux")
            echo "Linuxå¹³å°å·²å¯ç”¨: Vulkan + OpenGL"
            ;;
          "android")
            echo "Androidå¹³å°å·²å¯ç”¨: Vulkan + OpenGL ES"
            ;;
        esac
      shell: bash
      
    # ä½¿ç”¨Ninjaç¼–è¯‘Skiaï¼Œæ ¹æ®å¹³å°è°ƒæ•´çº¿ç¨‹æ•°
    - name: ç¼–è¯‘Skia Dawn WebGPUå’ŒGraphiteç‰ˆæœ¬
      run: |
        cd skia
        echo "å¼€å§‹ç¼–è¯‘ ${{ matrix.target_os }} å¹³å°çš„Skia Dawn WebGPUç‰ˆæœ¬..."
        # æ ¹æ®å¹³å°è®¾ç½®å¹¶è¡Œç¼–è¯‘çº¿ç¨‹æ•°
        if [ "${{ matrix.target_os }}" = "android" ]; then
          # Androidæ„å»ºä½¿ç”¨8çº¿ç¨‹
          ninja -C out/Release -j8
        elif [ "${{ matrix.target_os }}" = "mac" ]; then
          # macOSæ„å»ºä½¿ç”¨4çº¿ç¨‹ä»¥é¿å…ç¼–è¯‘å™¨è¿‡è½½
          ninja -C out/Release -j4
        else
          # å…¶ä»–å¹³å°ä½¿ç”¨6çº¿ç¨‹
          ninja -C out/Release -j6
        fi
        echo "âœ… ${{ matrix.target_os }} å¹³å°Skia Dawn WebGPUç‰ˆæœ¬ç¼–è¯‘å®Œæˆ"
      shell: bash
      
    # åˆ›å»ºå‘å¸ƒåŒ…å¹¶æ•´ç†æ–‡ä»¶
    - name: åˆ›å»ºDawn WebGPUå’ŒGraphiteå‘å¸ƒåŒ…
      run: |
        cd skia
        
        # åˆ›å»ºè¾“å‡ºç›®å½•ç»“æ„
        mkdir -p package/include
        mkdir -p package/lib
        mkdir -p package/bin
        mkdir -p package/docs
        mkdir -p package/examples
        mkdir -p package/modules
        mkdir -p package/dawn
        mkdir -p package/graphite
        
        # å¦‚æœæ˜¯Androidå¹³å°ï¼Œåˆ›å»ºAndroidç‰¹å®šç›®å½•
        if [ "${{ matrix.target_os }}" = "android" ]; then
          mkdir -p package/android
        fi
        
        # å¤åˆ¶å¤´æ–‡ä»¶åˆ°åŒ…ç›®å½•
        cp -r include/* package/include/
        
        # å¤åˆ¶modulesç›®å½•åˆ°åŒ…æ ¹ç›®å½•ä»¥æ”¯æŒ "modules/skcms/skcms.h" å¼•ç”¨
        if [ -d "modules" ]; then
          cp -r modules/* package/modules/ 2>/dev/null || true
        fi
        
        # å¤åˆ¶Dawnç›¸å…³å¤´æ–‡ä»¶
        if [ -d "third_party/externals/dawn/include" ]; then
          cp -r third_party/externals/dawn/include/* package/dawn/ 2>/dev/null || true
        fi
        
        # å¤åˆ¶Graphiteç›¸å…³å¤´æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ç‹¬ç«‹çš„graphiteå¤´æ–‡ä»¶ç›®å½•ï¼‰
        if [ -d "include/gpu/graphite" ]; then
          mkdir -p package/graphite/gpu/graphite
          cp -r include/gpu/graphite/* package/graphite/gpu/graphite/ 2>/dev/null || true
        fi
        
        # å¤åˆ¶Androidç‰¹å®šçš„å¤´æ–‡ä»¶
        if [ "${{ matrix.target_os }}" = "android" ] && [ -d "include/android" ]; then
          cp -r include/android/* package/android/ 2>/dev/null || true
        fi
        
        # å¤åˆ¶third_partyä¸­çš„modulesç›¸å…³æ–‡ä»¶
        if [ -d "third_party" ]; then
          mkdir -p package/third_party
          # å¤åˆ¶skcmsæ¨¡å—
          if [ -d "third_party/skcms" ]; then
            cp -r third_party/skcms package/third_party/ 2>/dev/null || true
          fi
          # å¤åˆ¶Dawnç›¸å…³third_partyæ–‡ä»¶
          if [ -d "third_party/externals/dawn" ]; then
            mkdir -p package/third_party/dawn
            find third_party/externals/dawn -name "*.h" -o -name "*.hpp" | while read file; do
              relative_path=${file#third_party/externals/dawn/}
              target_dir="package/third_party/dawn/$(dirname "$relative_path")"
              mkdir -p "$target_dir"
              cp "$file" "$target_dir/" 2>/dev/null || true
            done
          fi
          # å¤åˆ¶å…¶ä»–å¯èƒ½éœ€è¦çš„third_partyæ¨¡å—
          find third_party -name "*.h" -o -name "*.hpp" | while read file; do
            dir=$(dirname "$file")
            mkdir -p "package/$dir"
            cp "$file" "package/$file" 2>/dev/null || true
          done
        fi
        
        # æ ¹æ®ä¸åŒå¹³å°å¤åˆ¶ç›¸åº”çš„åº“æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶
        case "${{ matrix.target_os }}" in
          "win")
            # Windowså¹³å°æ–‡ä»¶å¤åˆ¶
            find out/Release -name "*.lib" -exec cp {} package/lib/ \; 2>/dev/null || true
            find out/Release -name "*.dll" -exec cp {} package/bin/ \; 2>/dev/null || true
            find out/Release -name "*.exe" -exec cp {} package/bin/ \; 2>/dev/null || true
            ;;
          "mac")
            # macOSå¹³å°æ–‡ä»¶å¤åˆ¶
            find out/Release -name "*.a" -exec cp {} package/lib/ \; 2>/dev/null || true
            find out/Release -name "*.dylib" -exec cp {} package/lib/ \; 2>/dev/null || true
            find out/Release -type f -perm +111 -name "*" -not -name "*.so" -not -name "*.dylib" -exec cp {} package/bin/ \; 2>/dev/null || true
            ;;
          "linux"|"android")
            # Linuxå’ŒAndroidå¹³å°æ–‡ä»¶å¤åˆ¶
            find out/Release -name "*.a" -exec cp {} package/lib/ \; 2>/dev/null || true
            find out/Release -name "*.so" -exec cp {} package/lib/ \; 2>/dev/null || true
            find out/Release -type f -perm +111 -name "*" -not -name "*.so" -exec cp {} package/bin/ \; 2>/dev/null || true
            ;;
        esac
        
        # å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶
        if [ -d "resources" ]; then
          cp -r resources/* package/examples/ 2>/dev/null || true
        fi
        
        # åˆ›å»ºæ„å»ºä¿¡æ¯æ–‡ä»¶
        cat > package/BUILD_INFO.txt << EOF
        Skia Dawn WebGPU + Graphite å®Œæ•´æ„å»ºä¿¡æ¯
        ========================================
        å¹³å°: ${{ matrix.target_os }}
        æ¶æ„: ${{ matrix.target_cpu }}
        åŒ…å: ${{ matrix.platform }}
        æ„å»ºæ¨¡å¼: Release (å®˜æ–¹å®Œæ•´æ„å»º + Dawn WebGPU + Graphite)
        C++æ ‡å‡†: C++20 (æ”¯æŒDawn WebGPUçš„Conceptsç‰¹æ€§)
        ç¼–è¯‘ä¼˜åŒ–: ä½¿ç”¨å¹¶è¡Œç¼–è¯‘åŠ é€ŸDawnå’ŒGraphiteæ„å»º
        
        æ”¯æŒçš„åŠŸèƒ½:
        - GPUæ¸²æŸ“ (OpenGL + Vulkan + Dawn WebGPU)
        - Graphite ç°ä»£æ¸²æŸ“æ¶æ„
        - Dawn WebGPU ç°ä»£è·¨å¹³å°GPU API
        - PDFå¯¼å‡º (å†…ç½®HarfBuzz)
        - SVGæ”¯æŒ
        - SkottieåŠ¨ç”»
        - æ–‡æœ¬æ•´å½¢ (å†…ç½®HarfBuzz)
        - å­—ä½“ç®¡ç† (å†…ç½®FreeType)
        - å›¾åƒç¼–è§£ç 
        - é¢œè‰²ç®¡ç† (skcmsæ¨¡å—)
        EOF
        
        # æ ¹æ®å¹³å°æ·»åŠ ç‰¹å®šä¿¡æ¯
        case "${{ matrix.target_os }}" in
          "win")
            cat >> package/BUILD_INFO.txt << EOF
        
        Windowsç‰¹å®šä¿¡æ¯:
        - è¿è¡Œæ—¶: ä½¿ç”¨/MDè¿è¡Œæ—¶ (å¤šçº¿ç¨‹DLL)
        - Dawnåç«¯: Direct3D 12 + Direct3D 11 + Vulkan
        - ç¼–è¯‘å™¨è¦æ±‚: MSVC 2019 16.11+ æˆ– MSVC 2022
        - ç‰¹æ®Šè¯´æ˜: å·²ç¦ç”¨DNG SDKä»¥ä¿è¯C++17å…¼å®¹æ€§
        EOF
            ;;
          "mac")
            cat >> package/BUILD_INFO.txt << EOF
        
        macOSç‰¹å®šä¿¡æ¯:
        - Dawnåç«¯: Metal (åŸç”ŸmacOS)
        - ç¼–è¯‘å™¨è¦æ±‚: Xcode 15+ (Clang 15+)ï¼Œä½¿ç”¨libc++æ ‡å‡†åº“
        - DNG RAWå›¾åƒ: å®Œæ•´æ”¯æŒ
        - ç‰¹æ®Šè¯´æ˜: ä½¿ç”¨å†…ç½®åº“é¿å…ç³»ç»Ÿä¾èµ–å†²çªï¼Œå¼ºåˆ¶ä½¿ç”¨ç°ä»£C++20ç‰¹æ€§
        - å…¼å®¹æ€§: é’ˆå¯¹macOS C++20æ”¯æŒè¿›è¡Œäº†ä¼˜åŒ–
        EOF
            ;;
          "linux")
            cat >> package/BUILD_INFO.txt << EOF
        
        Linuxç‰¹å®šä¿¡æ¯:
        - Dawnåç«¯: Vulkan + OpenGL + OpenGL ES
        - ç¼–è¯‘å™¨è¦æ±‚: GCC 12+ æˆ– Clang 15+
        - DNG RAWå›¾åƒ: å®Œæ•´æ”¯æŒ
        - X11æ”¯æŒ: å®Œæ•´
        EOF
            ;;
          "android")
            cat >> package/BUILD_INFO.txt << EOF
        
        Androidç‰¹å®šä¿¡æ¯:
        - Android APIçº§åˆ«: ${{ matrix.android_api }}+
        - NDKç‰ˆæœ¬: r25c
        - Dawnåç«¯: Vulkan + OpenGL ES
        - Androidå­—ä½“ç®¡ç†å™¨: å®Œæ•´æ”¯æŒ
        - JNIæ¥å£: æ”¯æŒ
        - DNG RAWå›¾åƒ: å®Œæ•´æ”¯æŒ
        EOF
            ;;
        esac
        
        cat >> package/BUILD_INFO.txt << EOF
        
        ç‰¹æ®Šè¯´æ˜:
        - ä½¿ç”¨C++20æ ‡å‡†ä»¥æ”¯æŒDawn WebGPUçš„Conceptsç‰¹æ€§
        - æ ¹æ®å¹³å°å¯ç”¨å¯¹åº”çš„Dawnåç«¯ï¼Œé¿å…è·¨å¹³å°ç¼–è¯‘é”™è¯¯
        - ä½¿ç”¨å†…ç½®FreeTypeå’ŒHarfBuzzåº“ä»¥é¿å…ç³»ç»Ÿä¾èµ–å†²çª
        - æ‰€æœ‰ä¾èµ–éƒ½å·²é™æ€é“¾æ¥
        - Dawn WebGPUé€šè¿‡Graphiteæ¸²æŸ“å™¨æä¾›ç°ä»£è·¨å¹³å°GPUæŠ½è±¡
        - Graphiteæ¸²æŸ“å™¨ä¸ºæ–°ä¸€ä»£GPUæ¶æ„è®¾è®¡
        - ä¸ºä¿è¯æ„å»ºç¨³å®šæ€§å·²ç¦ç”¨è°ƒè¯•å·¥å…·æ„å»º
        - å¤´æ–‡ä»¶è·¯å¾„å·²é…ç½®æ”¯æŒæºç includeæ ¼å¼å’Œæ¨¡å—å¼•ç”¨
        - åŒ…å«å®Œæ•´çš„modulesã€third_partyã€Dawnå’ŒGraphiteä¾èµ–
        - ä½¿ç”¨å¹¶è¡Œç¼–è¯‘åŠ é€Ÿæ„å»ºè¿‡ç¨‹
        - Dawn WebGPUä¸ºè·¨å¹³å°GPUåº”ç”¨æä¾›ç»Ÿä¸€æ¥å£
        - Graphiteæ¸²æŸ“å™¨æä¾›æ›´ç°ä»£çš„GPUèµ„æºç®¡ç†
        - macOSå¹³å°å·²ä¼˜åŒ–C++20å…¼å®¹æ€§é—®é¢˜
        EOF
        
      shell: bash
      
    # ç”Ÿæˆé€šç”¨çš„CMakeLists.txtæ–‡ä»¶ï¼ˆæ”¯æŒæ‰€æœ‰å¹³å°å’ŒC++20ï¼‰
    - name: ç”ŸæˆDawn WebGPUå’ŒGraphite CMakeLists.txt
      run: |
        cd skia/package
        
        # ç”ŸæˆCMakeLists.txtæ–‡ä»¶ï¼Œæ”¯æŒæ‰€æœ‰å¹³å°å’ŒC++20
        cat > CMakeLists.txt << 'EOF'
        # Skia Dawn WebGPU + Graphite å›¾å½¢åº“çš„CMakeé…ç½®æ–‡ä»¶ï¼ˆå…¨å¹³å°æ”¯æŒï¼ŒC++20ï¼‰
        cmake_minimum_required(VERSION 3.15)
        
        # è®¾ç½®é¡¹ç›®ä¿¡æ¯
        project(SkiaDawnGraphitePrebuilt
            VERSION 1.0.0
            DESCRIPTION "å®Œæ•´é¢„ç¼–è¯‘çš„Skiaå›¾å½¢åº“ with Dawn WebGPU + Graphiteåç«¯ (å…¨å¹³å°C++20æ”¯æŒ)"
            LANGUAGES CXX C
        )
        
        # è®¾ç½®C++æ ‡å‡†ï¼ˆDawnéœ€è¦C++20æ”¯æŒConceptsç‰¹æ€§ï¼‰
        set(CMAKE_CXX_STANDARD 20)
        set(CMAKE_CXX_STANDARD_REQUIRED ON)
        
        # è·å–å½“å‰ç›®å½•
        get_filename_component(SKIA_ROOT_DIR "${CMAKE_CURRENT_LIST_DIR}" ABSOLUTE)
        
        # åˆ›å»ºskia::skiaæ¥å£åº“
        add_library(skia INTERFACE)
        add_library(skia::skia ALIAS skia)
        
        # è®¾ç½®åŒ…å«ç›®å½• - åŒ…å«Dawn WebGPUã€Graphiteå’Œå¹³å°ç‰¹å®šå¤´æ–‡ä»¶è·¯å¾„
        target_include_directories(skia INTERFACE
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/modules>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/third_party>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/dawn>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/graphite>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/android>
            $<INSTALL_INTERFACE:.>
            $<INSTALL_INTERFACE:modules>
            $<INSTALL_INTERFACE:third_party>
            $<INSTALL_INTERFACE:dawn>
            $<INSTALL_INTERFACE:graphite>
            $<INSTALL_INTERFACE:android>
        )
        
        # æŸ¥æ‰¾æ‰€æœ‰çš„åº“æ–‡ä»¶
        file(GLOB SKIA_LIBRARIES "${SKIA_ROOT_DIR}/lib/*")
        
        # æ ¹æ®å¹³å°è®¾ç½®ç‰¹å®šçš„é“¾æ¥åº“å’Œç¼–è¯‘é€‰é¡¹
        if(WIN32)
            # Windowså¹³å°é…ç½® - ä½¿ç”¨/MDè¿è¡Œæ—¶ï¼Œå¯ç”¨Dawn WebGPUå’ŒGraphiteï¼ŒC++20æ”¯æŒ
            target_compile_definitions(skia INTERFACE
                SK_GANESH=1
                SK_GRAPHITE=1
                SK_VULKAN=1
                SK_GL=1
                SK_DAWN=1
                SK_BUILD_FOR_WIN=1
                SK_ENABLE_SKOTTIE=1
                SK_ENABLE_SVG=1
                UNICODE
                _UNICODE
            )
            
            # è®¾ç½®Windowsè¿è¡Œæ—¶ä¸º/MDï¼ˆå¤šçº¿ç¨‹DLLï¼‰å’ŒC++20æ”¯æŒ
            target_compile_options(skia INTERFACE
                $<$<CONFIG:Debug>:/MDd>
                $<$<CONFIG:Release>:/MD>
                $<$<CONFIG:RelWithDebInfo>:/MD>
                $<$<CONFIG:MinSizeRel>:/MD>
                /std:c++20
            )
            
            # æ·»åŠ Windowsç³»ç»Ÿåº“ - åŒ…å«Dawn WebGPUæ‰€éœ€çš„åº“
            target_link_libraries(skia INTERFACE
                ${SKIA_LIBRARIES}
                # OpenGLç›¸å…³
                OpenGL32
                # DirectXç›¸å…³ï¼ˆDawn WebGPU Windowsåç«¯éœ€è¦ï¼‰
                d3d11
                d3d12
                dxgi
                d3dcompiler
                dxguid
                # ç³»ç»Ÿåº“
                Gdi32
                User32
                Kernel32
                Ole32
                OleAut32
                Uuid
                Advapi32
                Shell32
                # å­—ä½“å’Œæ–‡æœ¬
                Usp10
                # ç½‘ç»œ
                Ws2_32
            )
            
        elseif(APPLE)
            # macOSå¹³å°é…ç½® - å¯ç”¨Dawn WebGPU Metalåç«¯å’ŒGraphiteï¼ŒC++20æ”¯æŒ
            target_compile_definitions(skia INTERFACE
                SK_GANESH=1
                SK_GRAPHITE=1
                SK_METAL=1
                SK_GL=1
                SK_VULKAN=1
                SK_DAWN=1
                SK_BUILD_FOR_MAC=1
                SK_ENABLE_SKOTTIE=1
                SK_ENABLE_SVG=1
            )
            
            # è®¾ç½®C++20æ”¯æŒï¼Œé’ˆå¯¹macOSçš„ç‰¹æ®Šé…ç½®
            target_compile_options(skia INTERFACE
                -std=c++20
                -stdlib=libc++
                -Wno-unknown-warning-option
                -Wno-c++20-compat
            )
            
            # è®¾ç½®é“¾æ¥é€‰é¡¹ä½¿ç”¨libc++
            target_link_options(skia INTERFACE
                -stdlib=libc++
            )
            
            # æŸ¥æ‰¾macOSç³»ç»Ÿæ¡†æ¶
            find_library(FOUNDATION_FRAMEWORK Foundation)
            find_library(COREGRAPHICS_FRAMEWORK CoreGraphics)
            find_library(CORETEXT_FRAMEWORK CoreText)
            find_library(COREFOUNDATION_FRAMEWORK CoreFoundation)
            find_library(COCOA_FRAMEWORK Cocoa)
            find_library(METAL_FRAMEWORK Metal)
            find_library(METALKIT_FRAMEWORK MetalKit)
            find_library(OPENGL_FRAMEWORK OpenGL)
            find_library(QUARTZCORE_FRAMEWORK QuartzCore)
            find_library(IOSURFACE_FRAMEWORK IOSurface)
            
            target_link_libraries(skia INTERFACE
                ${SKIA_LIBRARIES}
                ${FOUNDATION_FRAMEWORK}
                ${COREGRAPHICS_FRAMEWORK}
                ${CORETEXT_FRAMEWORK}
                ${COREFOUNDATION_FRAMEWORK}
                ${COCOA_FRAMEWORK}
                ${METAL_FRAMEWORK}
                ${METALKIT_FRAMEWORK}
                ${OPENGL_FRAMEWORK}
                ${QUARTZCORE_FRAMEWORK}
                ${IOSURFACE_FRAMEWORK}
            )
            
        elseif(ANDROID)
            # Androidå¹³å°é…ç½® - å¯ç”¨Dawn WebGPU Vulkanå’ŒOpenGL ESåç«¯ä»¥åŠGraphiteï¼ŒC++20æ”¯æŒ
            target_compile_definitions(skia INTERFACE
                ANDROID
                SK_GANESH=1
                SK_GRAPHITE=1
                SK_VULKAN=1
                SK_GL=1
                SK_DAWN=1
                SK_BUILD_FOR_ANDROID=1
                SK_ENABLE_SKOTTIE=1
                SK_ENABLE_SVG=1
                __ANDROID_API__=21
            )
            
            # è®¾ç½®C++20æ”¯æŒ
            target_compile_options(skia INTERFACE
                -std=c++20
                -fPIC
                -fno-rtti
                -fno-exceptions
            )
            
            target_link_libraries(skia INTERFACE
                ${SKIA_LIBRARIES}
                # OpenGL ESç›¸å…³
                GLESv2
                EGL
                # Vulkanç›¸å…³
                vulkan
                # Androidç³»ç»Ÿåº“
                android
                log
                jnigraphics
                # åª’ä½“ç›¸å…³
                mediandk
                # ç³»ç»Ÿåº“
                dl
                m
                z
            )
            
            # Androidç‰¹å®šçš„é“¾æ¥é€‰é¡¹
            target_link_options(skia INTERFACE
                -Wl,--gc-sections
                -Wl,--as-needed
            )
            
        else()
            # Linuxå¹³å°é…ç½® - å¯ç”¨Dawn WebGPU Vulkanåç«¯å’ŒGraphiteï¼ŒC++20æ”¯æŒ
            target_compile_definitions(skia INTERFACE
                SK_GANESH=1
                SK_GRAPHITE=1
                SK_VULKAN=1
                SK_GL=1
                SK_DAWN=1
                SK_BUILD_FOR_UNIX=1
                SK_ENABLE_SKOTTIE=1
                SK_ENABLE_SVG=1
            )
            
            # è®¾ç½®C++20æ”¯æŒ
            target_compile_options(skia INTERFACE
                -std=c++20
            )
            
            # æŸ¥æ‰¾å¿…è¦çš„ç³»ç»Ÿåº“
            find_package(PkgConfig QUIET)
            if(PKG_CONFIG_FOUND)
                pkg_check_modules(FONTCONFIG QUIET fontconfig)
                pkg_check_modules(HARFBUZZ QUIET harfbuzz)
            endif()
            
            # æŸ¥æ‰¾Vulkanï¼ˆDawn WebGPUéœ€è¦ï¼‰
            find_package(Vulkan QUIET)
            
            # æŸ¥æ‰¾X11ç›¸å…³åº“
            find_package(X11 QUIET)
            
            target_link_libraries(skia INTERFACE
                ${SKIA_LIBRARIES}
                # OpenGL
                GL
                # ç³»ç»Ÿåº“
                pthread
                dl
                m
            )
            
            # FontConfigæ”¯æŒ
            if(FONTCONFIG_FOUND)
                target_link_libraries(skia INTERFACE ${FONTCONFIG_LIBRARIES})
                target_include_directories(skia INTERFACE ${FONTCONFIG_INCLUDE_DIRS})
            endif()
            
            # HarfBuzzæ”¯æŒ
            if(HARFBUZZ_FOUND)
                target_link_libraries(skia INTERFACE ${HARFBUZZ_LIBRARIES})
                target_include_directories(skia INTERFACE ${HARFBUZZ_INCLUDE_DIRS})
            endif()
            
            # æ·»åŠ Vulkanæ”¯æŒï¼ˆDawn WebGPUéœ€è¦ï¼‰
            if(Vulkan_FOUND)
                target_link_libraries(skia INTERFACE ${Vulkan_LIBRARIES})
                target_include_directories(skia INTERFACE ${Vulkan_INCLUDE_DIRS})
            endif()
            
            # æ·»åŠ X11æ”¯æŒ
            if(X11_FOUND)
                target_link_libraries(skia INTERFACE
                    ${X11_LIBRARIES}
                    ${X11_Xrandr_LIB}
                    ${X11_Xinerama_LIB}
                    ${X11_Xcursor_LIB}
                    ${X11_Xi_LIB}
                )
                target_include_directories(skia INTERFACE ${X11_INCLUDE_DIR})
            endif()
        endif()
        
        # è®¾ç½®ç¼–è¯‘é€‰é¡¹ - ç¡®ä¿C++20æ”¯æŒ
        target_compile_features(skia INTERFACE cxx_std_20)
        
        # ä¼˜åŒ–è®¾ç½®
        target_compile_options(skia INTERFACE
            $<$<CONFIG:Debug>:-g -O0>
            $<$<CONFIG:Release>:-O3 -DNDEBUG>
            $<$<CONFIG:RelWithDebInfo>:-O2 -g -DNDEBUG>
        )
        
        # è®¾ç½®é¢„å¤„ç†å™¨å®šä¹‰
        target_compile_definitions(skia INTERFACE
            $<$<CONFIG:Debug>:SK_DEBUG>
            $<$<CONFIG:Release>:SK_RELEASE>
        )
        EOF
        
      shell: bash
      
    # æ‰“åŒ…æ„å»ºäº§ç‰©ä¸ºZIPæ–‡ä»¶
    - name: æ‰“åŒ…Dawn WebGPUå’ŒGraphiteæ„å»ºäº§ç‰©
      run: |
        cd skia/package
        
        # æ ¹æ®è¿è¡Œå¹³å°é€‰æ‹©åˆé€‚çš„æ‰“åŒ…æ–¹å¼
        if [ "${{ runner.os }}" = "Windows" ]; then
          # Windowsç³»ç»Ÿä½¿ç”¨PowerShellçš„Compress-Archive
          powershell "Compress-Archive -Path * -DestinationPath ../${{ matrix.platform }}.zip"
        else
          # Unixç³»ç»Ÿä½¿ç”¨zipå‘½ä»¤æ‰“åŒ…
          zip -r "../${{ matrix.platform }}.zip" *
        fi
        
        echo "âœ… ${{ matrix.platform }}.zip æ„å»ºåŒ…åˆ›å»ºå®Œæˆ"
      shell: bash
      
    # ä¸Šä¼ æ„å»ºäº§ç‰©åˆ°GitHub Actions
    - name: ä¸Šä¼ Dawn WebGPUå’ŒGraphiteæ„å»ºäº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: ${{ matrix.platform }}
        path: skia/${{ matrix.platform }}.zip
        retention-days: 30
        compression-level: 0
        
  # åˆ›å»ºGitHub Releaseå‘å¸ƒï¼ˆä»…åœ¨æ¨é€åˆ°ä¸»åˆ†æ”¯æˆ–å®šæ—¶ä»»åŠ¡æ—¶ï¼‰
  create-dawn-release:
    needs: build-skia-dawn-all
    runs-on: ubuntu-latest
    if: |
      (github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master')) ||
      github.event_name == 'schedule'
    
    permissions:
      contents: write
      packages: write
    
    steps:
    # æ£€å‡ºä»£ç ä»¥è®¿é—®ä»“åº“ä¿¡æ¯
    - name: æ£€å‡ºä»£ç ä»“åº“
      uses: actions/checkout@v4
      
    # ä¸‹è½½æ‰€æœ‰æ„å»ºäº§ç‰©
    - name: ä¸‹è½½æ‰€æœ‰Dawn WebGPUæ„å»ºäº§ç‰©
      uses: actions/download-artifact@v4
      with:
        path: artifacts
        
    # è·å–å‘å¸ƒæ ‡ç­¾
    - name: è·å–å‘å¸ƒæ ‡ç­¾
      id: get_tag
      run: |
        if [ "${{ github.event_name }}" = "schedule" ]; then
          echo "tag=skia-dawn-all-daily-$(date +%Y%m%d)" >> $GITHUB_OUTPUT
          echo "name=Skia Dawn WebGPU å…¨å¹³å°æ¯æ—¥æ„å»ºåŒ… $(date +%Y-%m-%d)" >> $GITHUB_OUTPUT
        else
          echo "tag=skia-dawn-all-build-${{ github.run_number }}" >> $GITHUB_OUTPUT
          echo "name=Skia Dawn WebGPU å…¨å¹³å°æ„å»ºåŒ… v${{ github.run_number }}" >> $GITHUB_OUTPUT
        fi
        
    # åˆ›å»ºGitHub Releaseå‘å¸ƒç‰ˆæœ¬
    - name: åˆ›å»ºGitHub Release
      uses: softprops/action-gh-release@v2
      with:
        tag_name: ${{ steps.get_tag.outputs.tag }}
        name: ${{ steps.get_tag.outputs.name }}
        body: |
          # Skia Dawn WebGPU + Graphite å…¨å¹³å°æ„å»ºåŒ…ï¼ˆC++20å…¼å®¹æ€§ä¿®æ­£ç‰ˆï¼‰
          
          è¿™ä¸ªå‘å¸ƒåŒ…åŒ…å«äº†å¯ç”¨Dawn WebGPUåç«¯å’ŒGraphiteæ¸²æŸ“å™¨çš„Skiaå›¾å½¢åº“é¢„ç¼–è¯‘ç‰ˆæœ¬ï¼Œæ”¯æŒæ‰€æœ‰ä¸»æµå¹³å°ï¼Œä½¿ç”¨C++20æ ‡å‡†ï¼Œå·²ä¿®æ­£macOS C++20å…¼å®¹æ€§é—®é¢˜ã€‚
          
          ## åŒ…å«çš„å¹³å°å’ŒDawnåç«¯
          
          ### æ¡Œé¢å¹³å°
          - **x64_windows_dawn.zip** - Windows x64æ¶æ„
            - Dawnåç«¯: Direct3D 12/11 + Vulkan
            - ç¼–è¯‘å™¨è¦æ±‚: MSVC 2019 16.11+ æˆ– MSVC 2022
          
          - **x64_macos_dawn.zip** - macOS Intel x64æ¶æ„
          - **arm64_macos_dawn.zip** - macOS Apple Silicon ARM64æ¶æ„
            - Dawnåç«¯: Metalï¼ˆåŸç”ŸmacOSï¼‰
            - ç¼–è¯‘å™¨è¦æ±‚: Xcode 15+ (Clang 15+)ï¼Œä½¿ç”¨libc++æ ‡å‡†åº“
            - âœ… **å·²ä¿®æ­£C++20å…¼å®¹æ€§é—®é¢˜**
          
          - **x64_linux_dawn.zip** - Linux x64æ¶æ„
            - Dawnåç«¯: Vulkan + OpenGL + OpenGL ES
            - ç¼–è¯‘å™¨è¦æ±‚: GCC 12+ æˆ– Clang 15+
          
          ### ç§»åŠ¨å¹³å°
          - **x64_android_dawn.zip** - Android x64æ¶æ„
          - **arm64_android_dawn.zip** - Android ARM64æ¶æ„
            - Dawnåç«¯: Vulkan + OpenGL ES
            - Android APIçº§åˆ«: 21+
            - NDKç‰ˆæœ¬: r25c
          
          ## é‡è¦ä¿®æ­£
          
          - âœ… **ä¿®æ­£macOS C++20å…¼å®¹æ€§**: å¼ºåˆ¶ä½¿ç”¨libc++æ ‡å‡†åº“ï¼Œè§£å†³Conceptsæ”¯æŒé—®é¢˜
          - âœ… **ä¼˜åŒ–ç¼–è¯‘å™¨é…ç½®**: æ¯ä¸ªå¹³å°ä½¿ç”¨æœ€é€‚åˆçš„ç¼–è¯‘å™¨ç‰ˆæœ¬
          - âœ… **ä¿®æ­£å¹³å°åç«¯é…ç½®**: æ¯ä¸ªå¹³å°åªå¯ç”¨å¯¹åº”çš„Dawnåç«¯
          - âœ… **å‡å°‘ç¼–è¯‘çº¿ç¨‹**: macOSä½¿ç”¨4çº¿ç¨‹é¿å…ç¼–è¯‘å™¨è¿‡è½½
          - âœ… **è­¦å‘ŠæŠ‘åˆ¶**: æ·»åŠ C++20å…¼å®¹æ€§è­¦å‘ŠæŠ‘åˆ¶
          
          ## CMakeä½¿ç”¨æ–¹æ³•
          
          ```cmake
          # ç¡®ä¿CMakeç‰ˆæœ¬æ”¯æŒC++20
          cmake_minimum_required(VERSION 3.15)
          
          # è®¾ç½®C++20æ ‡å‡†
          set(CMAKE_CXX_STANDARD 20)
          set(CMAKE_CXX_STANDARD_REQUIRED ON)
          
          # macOSç‰¹æ®Šé…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰
          if(APPLE)
              set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -stdlib=libc++")
              set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -stdlib=libc++")
          endif()
          
          add_subdirectory(path/to/skia)
          target_link_libraries(your_target skia::skia)
          ```
          
          ## ä¸»è¦ç‰¹æ€§
          
          - Dawn WebGPUè·¨å¹³å°GPU APIæ”¯æŒï¼ˆåŸºäºC++20 Conceptsï¼‰
          - Graphiteç°ä»£æ¸²æŸ“æ¶æ„
          - å®Œæ•´çš„Skiaæ ¸å¿ƒåŠŸèƒ½
          - PDF/SVG/åŠ¨ç”»æ”¯æŒ
          - å†…ç½®å­—ä½“å’Œæ–‡æœ¬å¤„ç†
          - æ”¯æŒè®¡ç®—ç€è‰²å™¨å’Œç°ä»£GPUåŠŸèƒ½
          - Windowsä½¿ç”¨/MDè¿è¡Œæ—¶
          - Androidå¹³å°å®Œæ•´æ”¯æŒ
          - macOS C++20å…¼å®¹æ€§ä¼˜åŒ–
          - å¹³å°ç‰¹å®šçš„Dawnåç«¯ä¼˜åŒ–
          - ä½¿ç”¨å¹¶è¡Œç¼–è¯‘åŠ é€Ÿæ„å»ºè¿‡ç¨‹
        files: |
          artifacts/*/**.zip
        draft: false
        prerelease: false
        generate_release_notes: false
        make_latest: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    # æ„å»ºå®Œæˆé€šçŸ¥
    - name: æ„å»ºå®Œæˆé€šçŸ¥
      run: |
        echo "ğŸ‰ Skia Dawn WebGPU å…¨å¹³å°æ„å»ºå®Œæˆï¼ˆC++20å…¼å®¹æ€§ä¿®æ­£ç‰ˆï¼‰ï¼"
        echo "ğŸ“¦ å·²ç”Ÿæˆä»¥ä¸‹å¹³å°çš„æ„å»ºåŒ…ï¼š"
        echo "   â€¢ Windows: x64ï¼ˆDirect3D + Vulkan + C++20ï¼‰"  
        echo "   â€¢ macOS: x64, ARM64ï¼ˆMetal + C++20 + libc++ä¿®æ­£ï¼‰"
        echo "   â€¢ Linux: x64ï¼ˆVulkan + OpenGL + C++20 + GCC12ï¼‰"
        echo "   â€¢ Android: x64, ARM64ï¼ˆVulkan + OpenGL ES + C++20ï¼‰"
        echo "ğŸ”— å¯åœ¨Actionsé¡µé¢ä¸‹è½½ï¼Œæˆ–åœ¨Releasesä¸­è·å–"
        echo "ğŸ“‹ æ¯ä¸ªåŒ…éƒ½åŒ…å«å…¨å¹³å°CMakeLists.txté…ç½®"
        echo "âœ… å·²ä¿®æ­£macOS C++20å…¼å®¹æ€§é—®é¢˜ï¼Œå¼ºåˆ¶ä½¿ç”¨libc++"
        echo "âœ… å·²ä¿®æ­£å¹³å°åç«¯é…ç½®é—®é¢˜ï¼Œé¿å…è·¨å¹³å°ç¼–è¯‘é”™è¯¯"
        echo "âœ… ä¼˜åŒ–äº†ç¼–è¯‘å™¨ç‰ˆæœ¬å’Œçº¿ç¨‹é…ç½®"
        echo "ğŸ® æ”¯æŒDawn WebGPU + Graphiteç°ä»£æ¸²æŸ“æ¶æ„"
        echo "âœ¨ åŒ…å«PDFã€SVGã€Skottieç­‰æ ¸å¿ƒåŠŸèƒ½"
        echo "ğŸ”¤ ä½¿ç”¨å†…ç½®å­—ä½“å’Œæ–‡æœ¬å¼•æ“ï¼Œæ— ç³»ç»Ÿä¾èµ–"
        echo "ğŸ“„ PDFå¯¼å‡ºæ”¯æŒå­—ä½“å­é›†åŠŸèƒ½"
        echo "ğŸš€ ç”Ÿäº§ç¯å¢ƒå°±ç»ªï¼Œç¨³å®šæ€§ä¼˜å…ˆ"
        echo "ğŸ“ å®Œç¾æ”¯æŒæºç includeæ ¼å¼å’Œæ¨¡å—ä¾èµ–"
        echo "ğŸ¨ åŒ…å«skcmsé¢œè‰²ç®¡ç†æ¨¡å—"
        echo "âš™ï¸  ä½¿ç”¨C++20æ ‡å‡†æ”¯æŒDawn WebGPUçš„Conceptsç‰¹æ€§"
        echo "âš¡ ä½¿ç”¨å¹¶è¡Œç¼–è¯‘åŠ é€Ÿæ„å»ºè¿‡ç¨‹"
        echo "ğŸŒ Dawn WebGPUæä¾›è·¨å¹³å°ç»Ÿä¸€GPUæ¥å£"
        echo "ğŸ”§ Graphiteæ¸²æŸ“å™¨æ”¯æŒç°ä»£GPUæ¶æ„"
        echo "ğŸ macOSå¹³å°å·²ä¼˜åŒ–C++20å…¼å®¹æ€§ï¼Œä½¿ç”¨ç°ä»£æ ‡å‡†åº“"
