# Skia å…¨å¹³å°æ„å»ºå·¥ä½œæµ - å¯ç”¨ Graphite å’Œ Dawn WebGPU æ”¯æŒ
name: æ„å»º Skia å…¨å¹³å°é¢„ç¼–è¯‘åŒ…

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘æ„å»º
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´ä¸Šåˆ8ç‚¹ï¼ˆUTCæ—¶é—´0ç‚¹ï¼‰è‡ªåŠ¨æ‰§è¡Œæ„å»º
    - cron: '0 0 * * *'

# è®¾ç½®å·¥ä½œæµæƒé™
permissions:
  contents: write
  packages: write
  actions: read

jobs:
  build-skia:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        include:
          # Windows x64 æ¶æ„
          - os: windows-latest
            platform: Win
            arch: x64
            target_os: win
            target_cpu: x64
            
          # macOS x64 æ¶æ„
          - os: macos-latest
            platform: macOS
            arch: x64
            target_os: mac
            target_cpu: x64
            
          # macOS ARM64 æ¶æ„
          - os: macos-latest
            platform: macOS
            arch: arm64
            target_os: mac
            target_cpu: arm64
            
          # Linux x64 æ¶æ„
          - os: ubuntu-latest
            platform: Linux
            arch: x64
            target_os: linux
            target_cpu: x64
            
          # Android x64 æ¶æ„
          - os: ubuntu-latest
            platform: Android
            arch: x64
            target_os: android
            target_cpu: x64
            android_api: 21
            
          # Android ARM64 æ¶æ„
          - os: ubuntu-latest
            platform: Android
            arch: arm64
            target_os: android
            target_cpu: arm64
            android_api: 21

    steps:
    # æ£€å‡ºä»£ç ä»“åº“
    - name: æ£€å‡ºä»£ç ä»“åº“
      uses: actions/checkout@v4
      
    # è®¾ç½® Python è¿è¡Œç¯å¢ƒ
    - name: è®¾ç½® Python ç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
        
    # å®‰è£… Linux ç³»ç»Ÿä¾èµ–åŒ…ï¼ˆLinux å’Œ Android æ„å»ºéœ€è¦ï¼‰
    - name: å®‰è£… Linux ç³»ç»Ÿä¾èµ–
      if: runner.os == 'Linux'
      run: |
        sudo apt-get update
        # å®‰è£…ç°ä»£ç¼–è¯‘å™¨å’Œæ„å»ºå·¥å…·
        sudo apt-get install -y gcc-13 g++-13 clang-18 ninja-build git
        # è®¾ç½®é»˜è®¤ç¼–è¯‘å™¨ä¸º GCC 13
        sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-13 100
        sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-13 100
        # å®‰è£…å›¾å½¢å’Œå­—ä½“ç›¸å…³ä¾èµ–
        sudo apt-get install -y libfontconfig1-dev libfreetype6-dev libgl1-mesa-dev
        # å®‰è£… Vulkan å¼€å‘åº“
        sudo apt-get install -y libvulkan-dev vulkan-tools vulkan-validationlayers-dev
        # å®‰è£… X11 ç›¸å…³åº“
        sudo apt-get install -y libxrandr-dev libxinerama-dev libxcursor-dev libxi-dev
        # å®‰è£… ICU å’Œ HarfBuzz
        sudo apt-get install -y libicu-dev libharfbuzz-dev
        # å®‰è£… Java å¼€å‘ç¯å¢ƒï¼ˆAndroid æ„å»ºéœ€è¦ï¼‰
        sudo apt-get install -y openjdk-11-jdk
        # å®‰è£… Dawn WebGPU ä¾èµ–
        sudo apt-get install -y libxss1 libxft2 libxext6 libwayland-dev
        
    # å®‰è£… macOS ç³»ç»Ÿä¾èµ–
    - name: å®‰è£… macOS ç³»ç»Ÿä¾èµ–
      if: runner.os == 'macOS'
      run: |
        # å®‰è£… Xcode å‘½ä»¤è¡Œå·¥å…·
        xcode-select --install 2>/dev/null || true
        # å®‰è£… ninja æ„å»ºå·¥å…·
        brew install ninja || true
        # éªŒè¯ Xcode ç‰ˆæœ¬
        xcodebuild -version
        # ç¡®ä¿ä½¿ç”¨æœ€æ–°çš„ clang
        clang --version
        
    # å®‰è£… Windows ç³»ç»Ÿä¾èµ–
    - name: å®‰è£… Windows ç³»ç»Ÿä¾èµ–
      if: runner.os == 'Windows'
      run: |
        # å®‰è£… ninja æ„å»ºå·¥å…·
        choco install ninja -y
        # å®‰è£… Gitï¼ˆç¡®ä¿æœ€æ–°ç‰ˆæœ¬ï¼‰
        choco install git -y
        # éªŒè¯ MSVC 2022 ç‰ˆæœ¬
        where cl
        cl
        
    # è®¾ç½® Android NDK ç¯å¢ƒï¼ˆä»…é™ Android å¹³å°ï¼‰
    - name: è®¾ç½® Android NDK
      if: matrix.target_os == 'android'
      uses: nttld/setup-ndk@v1
      with:
        ndk-version: r25c
        
    # è·å– Google çš„ depot_tools å·¥å…·é›†
    - name: è·å– depot_tools
      run: |
        git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git --depth 1
        echo "${{ github.workspace }}/depot_tools" >> $GITHUB_PATH
      shell: bash
      
    # è®¾ç½® Windows ç³»ç»Ÿçš„ depot_tools ç¯å¢ƒå˜é‡
    - name: è®¾ç½® depot_tools ç¯å¢ƒå˜é‡
      if: runner.os == 'Windows'
      run: |
        echo "${{ github.workspace }}\depot_tools" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append
        # ç¦ç”¨ depot_tools è‡ªåŠ¨ä¸‹è½½å·¥å…·é“¾ï¼Œä½¿ç”¨ç³»ç»Ÿ MSVC 2022
        echo "DEPOT_TOOLS_WIN_TOOLCHAIN=0" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf8 -Append
        
    # è·å– Skia æºä»£ç å¹¶åŒæ­¥ä¾èµ–
    - name: è·å– Skia æºä»£ç 
      run: |
        git clone https://skia.googlesource.com/skia.git --depth 1
        cd skia
        # åŒæ­¥æ‰€æœ‰ä¾èµ–åŒ…æ‹¬ Dawn WebGPU
        python tools/git-sync-deps
      shell: bash
      
    # é…ç½® Skia æ„å»ºå‚æ•°ï¼ˆå¯ç”¨ Graphite å’Œ Dawnï¼‰
    - name: é…ç½® Skia æ„å»ºå‚æ•°
      run: |
        cd skia
        
        # åŸºç¡€æ„å»ºå‚æ•°è®¾ç½® - å¯ç”¨å…¨é‡åŠŸèƒ½å’Œ C++20 æ”¯æŒ
        args="is_official_build=true"
        args="$args cc_wrapper=\"\""
        args="$args is_clang=true"
        args="$args skia_use_system_expat=false"
        args="$args skia_use_system_icu=false"
        args="$args skia_use_system_libjpeg_turbo=false"
        args="$args skia_use_system_libpng=false"
        args="$args skia_use_system_libwebp=false"
        args="$args skia_use_system_zlib=false"
        
        # å¯ç”¨ C++20 æ ‡å‡†
        args="$args extra_cflags_cc=[\"-std=c++20\"]"
        
        # å¯ç”¨ Graphite æ”¯æŒï¼ˆSkia çš„ä¸‹ä¸€ä»£ GPU åç«¯ï¼‰
        args="$args skia_enable_graphite=true"
        args="$args skia_use_dawn=true"
        args="$args skia_use_webgpu_dawn=true"
        
        # å¯ç”¨å…¨é‡åŠŸèƒ½æ”¯æŒ
        args="$args skia_enable_pdf=true"
        args="$args skia_enable_skottie=true"
        args="$args skia_enable_skshaper=true"
        args="$args skia_enable_svg=true"
        args="$args skia_use_icu=true"
        
        # å¯ç”¨ GPU åç«¯æ”¯æŒï¼ˆåŒ…å« Dawn WebGPUï¼‰
        args="$args skia_enable_gpu=true"
        args="$args skia_use_gl=true"
        args="$args skia_use_vulkan=true"
        args="$args skia_enable_spirv_validation=false"
        
        # ç¦ç”¨å·¥å…·æ„å»ºä»¥é¿å…æµ‹è¯•å·¥å…· API é—®é¢˜
        args="$args skia_enable_tools=false"
        
        # è®¾ç½®ç›®æ ‡å¹³å°å’Œæ¶æ„
        args="$args target_os=\"${{ matrix.target_os }}\""
        args="$args target_cpu=\"${{ matrix.target_cpu }}\""
        
        # æ ¹æ®ä¸åŒå¹³å°è®¾ç½®ç‰¹å®šå‚æ•°
        case "${{ matrix.target_os }}" in
          "win")
            # Windows å¹³å°ç‰¹å®šé…ç½® - ä½¿ç”¨ MSVC 2022 å’Œ /MD è¿è¡Œæ—¶
            args="$args is_clang=false"
            args="$args skia_use_angle=true"
            args="$args skia_use_direct3d=true"
            args="$args skia_use_freetype=true"
            args="$args skia_use_system_freetype2=false"
            args="$args skia_use_harfbuzz=true"
            args="$args skia_use_system_harfbuzz=false"
            args="$args skia_use_dng_sdk=false"
            args="$args skia_use_piex=false"
            # å¯ç”¨ Dawn WebGPU æ”¯æŒ
            args="$args skia_use_webgpu_dawn=true"
            # è®¾ç½® Windows ä½¿ç”¨ /MD è¿è¡Œæ—¶ï¼ˆå¤šçº¿ç¨‹ DLLï¼‰å’Œ C++20
            args="$args extra_cflags=[\"/MD\", \"/std:c++20\"]"
            args="$args extra_cflags_c=[\"/MD\"]"
            args="$args extra_cflags_cc=[\"/MD\", \"/std:c++20\"]"
            ;;
          "mac")
            # macOS å¹³å°ç‰¹å®šé…ç½® - ä½¿ç”¨ Clang 18 å’Œ C++20
            args="$args is_clang=true"
            args="$args skia_use_metal=true"
            args="$args skia_enable_skottie=true"
            args="$args skia_use_freetype=true"
            args="$args skia_use_system_freetype2=false"
            args="$args skia_use_fontconfig=false"
            args="$args skia_use_harfbuzz=true"
            args="$args skia_use_system_harfbuzz=false"
            args="$args skia_pdf_subset_harfbuzz=true"
            args="$args skia_use_dng_sdk=true"
            args="$args skia_use_piex=true"
            # å¯ç”¨ Dawn WebGPU æ”¯æŒ
            args="$args skia_use_webgpu_dawn=true"
            # è®¾ç½® C++20 æ ‡å‡†
            args="$args extra_cflags_cc=[\"-std=c++20\", \"-stdlib=libc++\"]"
            if [ "${{ matrix.target_cpu }}" = "arm64" ]; then
              args="$args target_cpu=\"arm64\""
            fi
            ;;
          "linux")
            # Linux å¹³å°ç‰¹å®šé…ç½® - ä½¿ç”¨ GCC 13 å’Œ C++20
            args="$args is_clang=false"
            args="$args cc=\"gcc-13\""
            args="$args cxx=\"g++-13\""
            args="$args skia_use_x11=true"
            args="$args skia_use_freetype=true"
            args="$args skia_use_fontconfig=true"
            args="$args skia_use_harfbuzz=true"
            args="$args skia_use_dng_sdk=true"
            args="$args skia_use_piex=true"
            args="$args skia_use_system_freetype2=true"
            args="$args skia_use_system_harfbuzz=true"
            # å¯ç”¨ Dawn WebGPU æ”¯æŒ
            args="$args skia_use_webgpu_dawn=true"
            # è®¾ç½® C++20 æ ‡å‡†
            args="$args extra_cflags_cc=[\"-std=c++20\"]"
            ;;
          "android")
            # Android å¹³å°ç‰¹å®šé…ç½® - ä½¿ç”¨ Clang 18 å’Œ C++20
            args="$args is_clang=true"
            args="$args ndk=\"$ANDROID_NDK_ROOT\""
            args="$args android_api_level=${{ matrix.android_api }}"
            args="$args skia_use_system_freetype2=false"
            args="$args skia_use_freetype=true"
            args="$args skia_enable_fontmgr_android=true"
            args="$args skia_use_vulkan=true"
            args="$args skia_use_harfbuzz=true"
            args="$args skia_use_system_harfbuzz=false"
            args="$args skia_use_dng_sdk=true"
            args="$args skia_use_piex=true"
            # Android å¹³å°çš„ Dawn WebGPU æ”¯æŒ
            args="$args skia_use_webgpu_dawn=true"
            # è®¾ç½® C++20 æ ‡å‡†
            args="$args extra_cflags_cc=[\"-std=c++20\", \"-stdlib=libc++\"]"
            ;;
        esac
        
        echo "BUILD_ARGS=$args" >> $GITHUB_ENV
      shell: bash
      
    # ä½¿ç”¨ GN ç”Ÿæˆæ„å»ºæ–‡ä»¶
    - name: ç”Ÿæˆ Skia æ„å»ºæ–‡ä»¶
      run: |
        cd skia
        echo "æ­£åœ¨ä¸º ${{ matrix.target_os }} å¹³å°ç”Ÿæˆæ„å»ºæ–‡ä»¶..."
        bin/gn gen out/Release --args="$BUILD_ARGS"
        echo "æ„å»ºé…ç½®å®Œæˆï¼Œå·²å¯ç”¨ Graphite å’Œ Dawn WebGPU æ”¯æŒ"
      shell: bash
      
    # ä½¿ç”¨ Ninja ç¼–è¯‘ Skia
    - name: ç¼–è¯‘ Skia
      run: |
        cd skia
        echo "å¼€å§‹ç¼–è¯‘ ${{ matrix.target_os }} å¹³å°çš„ Skiaï¼ˆå¯ç”¨ Graphite + Dawnï¼‰..."
        # æ ¹æ®å¹³å°è®¾ç½®å¹¶è¡Œç¼–è¯‘çº¿ç¨‹æ•°
        if [ "${{ matrix.target_os }}" = "android" ]; then
          # Android æ„å»ºä½¿ç”¨ 10 çº¿ç¨‹
          ninja -C out/Release -j10
        else
          # å…¶ä»–å¹³å°ä½¿ç”¨ 8 çº¿ç¨‹
          ninja -C out/Release -j8
        fi
        echo "âœ… ${{ matrix.target_os }} å¹³å° Skia ç¼–è¯‘å®Œæˆ"
      shell: bash
      
    # åˆ›å»ºå‘å¸ƒåŒ…å¹¶æ•´ç†æ–‡ä»¶
    - name: åˆ›å»º Skia å‘å¸ƒåŒ…
      run: |
        cd skia
        
        # åˆ›å»ºè¾“å‡ºç›®å½•ç»“æ„
        mkdir -p "Skia/bin/${{ matrix.platform }}/${{ matrix.arch }}"
        mkdir -p "Skia/lib/${{ matrix.platform }}/${{ matrix.arch }}"
        mkdir -p Skia/include
        mkdir -p Skia/modules
        mkdir -p Skia/examples
        
        # å¤åˆ¶å¤´æ–‡ä»¶åˆ°åŒ…ç›®å½•
        cp -r include/* Skia/include/
        
        # å¤åˆ¶ modules ç›®å½•
        if [ -d "modules" ]; then
          cp -r modules/* Skia/modules/ 2>/dev/null || true
        fi
        
        # å¤åˆ¶ third_party ä¸­çš„é‡è¦å¤´æ–‡ä»¶
        if [ -d "third_party" ]; then
          mkdir -p Skia/third_party
          # å¤åˆ¶ skcms æ¨¡å—
          if [ -d "third_party/skcms" ]; then
            cp -r third_party/skcms Skia/third_party/ 2>/dev/null || true
          fi
          # å¤åˆ¶ dawn ç›¸å…³å¤´æ–‡ä»¶
          if [ -d "third_party/dawn" ]; then
            cp -r third_party/dawn Skia/third_party/ 2>/dev/null || true
          fi
          # å¤åˆ¶ Graphite ç›¸å…³å¤´æ–‡ä»¶
          if [ -d "third_party/spirv-cross" ]; then
            cp -r third_party/spirv-cross Skia/third_party/ 2>/dev/null || true
          fi
          # å¤åˆ¶å…¶ä»–é‡è¦å¤´æ–‡ä»¶
          find third_party -name "*.h" -o -name "*.hpp" | while read file; do
            dir=$(dirname "$file")
            mkdir -p "Skia/$dir"
            cp "$file" "Skia/$file" 2>/dev/null || true
          done
        fi
        
        # æ ¹æ®ä¸åŒå¹³å°å¤åˆ¶ç›¸åº”çš„åº“æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶
        case "${{ matrix.target_os }}" in
          "win")
            # Windows å¹³å°æ–‡ä»¶å¤åˆ¶
            find out/Release -name "*.lib" -exec cp {} "Skia/lib/${{ matrix.platform }}/${{ matrix.arch }}/" \; 2>/dev/null || true
            find out/Release -name "*.dll" -exec cp {} "Skia/bin/${{ matrix.platform }}/${{ matrix.arch }}/" \; 2>/dev/null || true
            find out/Release -name "*.exe" -exec cp {} "Skia/bin/${{ matrix.platform }}/${{ matrix.arch }}/" \; 2>/dev/null || true
            ;;
          "mac")
            # macOS å¹³å°æ–‡ä»¶å¤åˆ¶
            find out/Release -name "*.a" -exec cp {} "Skia/lib/${{ matrix.platform }}/${{ matrix.arch }}/" \; 2>/dev/null || true
            find out/Release -name "*.dylib" -exec cp {} "Skia/lib/${{ matrix.platform }}/${{ matrix.arch }}/" \; 2>/dev/null || true
            find out/Release -type f -perm +111 -name "*" -not -name "*.so" -not -name "*.dylib" -exec cp {} "Skia/bin/${{ matrix.platform }}/${{ matrix.arch }}/" \; 2>/dev/null || true
            ;;
          "linux"|"android")
            # Linux å’Œ Android å¹³å°æ–‡ä»¶å¤åˆ¶
            find out/Release -name "*.a" -exec cp {} "Skia/lib/${{ matrix.platform }}/${{ matrix.arch }}/" \; 2>/dev/null || true
            find out/Release -name "*.so" -exec cp {} "Skia/lib/${{ matrix.platform }}/${{ matrix.arch }}/" \; 2>/dev/null || true
            find out/Release -type f -perm +111 -name "*" -not -name "*.so" -exec cp {} "Skia/bin/${{ matrix.platform }}/${{ matrix.arch }}/" \; 2>/dev/null || true
            ;;
        esac
        
        # å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶
        if [ -d "resources" ]; then
          cp -r resources/* Skia/examples/ 2>/dev/null || true
        fi
        
        # åˆ›å»ºæ„å»ºä¿¡æ¯æ–‡ä»¶
        cat > Skia/BUILD_INFO.txt << EOF
        Skia å®Œæ•´æ„å»ºä¿¡æ¯ï¼ˆå¯ç”¨ Graphite å’Œ Dawn WebGPUï¼‰
        ====================================================
        å¹³å°: ${{ matrix.platform }}
        æ¶æ„: ${{ matrix.arch }}
        æ„å»ºæ¨¡å¼: Releaseï¼ˆå®˜æ–¹å®Œæ•´æ„å»ºï¼‰
        C++ æ ‡å‡†: C++20
        Graphite æ”¯æŒ: å·²å¯ç”¨
        Dawn WebGPU: å·²å¯ç”¨
        
        ç¼–è¯‘å™¨ä¿¡æ¯:
        EOF
        
        # æ ¹æ®å¹³å°æ·»åŠ ç¼–è¯‘å™¨ä¿¡æ¯
        case "${{ matrix.target_os }}" in
          "win")
            cat >> Skia/BUILD_INFO.txt << EOF
        - ç¼–è¯‘å™¨: MSVC 2022
        - è¿è¡Œæ—¶: /MDï¼ˆå¤šçº¿ç¨‹ DLLï¼‰
        - C++ æ ‡å‡†: /std:c++20
        EOF
            ;;
          "mac")
            cat >> Skia/BUILD_INFO.txt << EOF
        - ç¼–è¯‘å™¨: Apple Clangï¼ˆåŸºäº LLVMï¼‰
        - æ ‡å‡†åº“: libc++
        - C++ æ ‡å‡†: -std=c++20
        EOF
            ;;
          "linux")
            cat >> Skia/BUILD_INFO.txt << EOF
        - ç¼–è¯‘å™¨: GCC 13
        - æ ‡å‡†åº“: libstdc++
        - C++ æ ‡å‡†: -std=c++20
        EOF
            ;;
          "android")
            cat >> Skia/BUILD_INFO.txt << EOF
        - ç¼–è¯‘å™¨: Clang 18ï¼ˆNDK r25cï¼‰
        - æ ‡å‡†åº“: libc++
        - C++ æ ‡å‡†: -std=c++20
        - API çº§åˆ«: ${{ matrix.android_api }}
        EOF
            ;;
        esac
        
        cat >> Skia/BUILD_INFO.txt << EOF
        
        æ”¯æŒçš„åŠŸèƒ½:
        - GPU æ¸²æŸ“ï¼ˆOpenGL + Vulkan + Graphiteï¼‰
        - Dawn WebGPU åç«¯
        - PDF å¯¼å‡ºï¼ˆå†…ç½® HarfBuzzï¼‰
        - SVG æ”¯æŒ
        - Skottie åŠ¨ç”»
        - æ–‡æœ¬æ•´å½¢ï¼ˆå†…ç½® HarfBuzzï¼‰
        - å­—ä½“ç®¡ç†ï¼ˆå†…ç½® FreeTypeï¼‰
        - å›¾åƒç¼–è§£ç 
        - é¢œè‰²ç®¡ç†ï¼ˆskcms æ¨¡å—ï¼‰
        
        å›¾å½¢åç«¯:
        - OpenGL/OpenGL ES
        - Vulkan
        - Graphiteï¼ˆä¸‹ä¸€ä»£ GPU åç«¯ï¼‰
        - Dawn WebGPU
        - Metalï¼ˆä»… macOSï¼‰
        - Direct3Dï¼ˆä»… Windowsï¼‰
        
        Graphite ç‰¹æ€§:
        - ä¸‹ä¸€ä»£ GPU æ¸²æŸ“æ¶æ„
        - æ›´å¥½çš„æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨
        - å¤šçº¿ç¨‹å‹å¥½çš„è®¾è®¡
        - ç°ä»£ GPU API ä¼˜åŒ–
        - WebGPU é›†æˆæ”¯æŒ
        
        Dawn WebGPU ç‰¹æ€§:
        - è·¨å¹³å° WebGPU å®ç°
        - ç°ä»£ GPU API æŠ½è±¡
        - ä¸ Graphite æ·±åº¦é›†æˆ
        - é«˜æ€§èƒ½è®¡ç®—ç€è‰²å™¨æ”¯æŒ
        - WGSL ç€è‰²å™¨è¯­è¨€æ”¯æŒ
        EOF
        
      shell: bash
      
    # ä¸Šä¼ æ„å»ºäº§ç‰©åˆ° GitHub Actions
    - name: ä¸Šä¼  Skia æ„å»ºäº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: ${{ matrix.platform }}_${{ matrix.arch }}
        path: skia/Skia/
        retention-days: 30
        
  # åˆå¹¶æ‰€æœ‰å¹³å°çš„æ„å»ºäº§ç‰©
  merge-artifacts:
    needs: build-skia
    runs-on: ubuntu-latest
    steps:
    - name: ä¸‹è½½æ‰€æœ‰æ„å»ºäº§ç‰©
      uses: actions/download-artifact@v4
      with:
        path: artifacts
        
    - name: åˆå¹¶æ„å»ºäº§ç‰©
      run: |
        # åˆ›å»ºæœ€ç»ˆçš„ç›®å½•ç»“æ„
        mkdir -p Skia_Final/Skia
        
        # åˆå¹¶æ‰€æœ‰å¹³å°çš„æ„å»ºäº§ç‰©
        for artifact_dir in artifacts/*/; do
          if [ -d "$artifact_dir" ]; then
            cp -r "$artifact_dir"* Skia_Final/Skia/ 2>/dev/null || true
          fi
        done
        
    # ç”Ÿæˆæ”¯æŒ Graphite çš„ CMakeLists.txt æ–‡ä»¶
    - name: ç”Ÿæˆ Skia CMakeLists.txt
      run: |
        cd Skia_Final
        
        # ç”Ÿæˆ CMakeLists.txt æ–‡ä»¶ï¼Œæ”¯æŒæ‰€æœ‰å¹³å°ã€Graphite å’Œ C++20
        cat > Skia/CMakeLists.txt << 'EOF'
        # Skia å›¾å½¢åº“çš„ CMake é…ç½®æ–‡ä»¶ï¼ˆå…¨å¹³å°æ”¯æŒ + Graphite + Dawn WebGPUï¼‰
        cmake_minimum_required(VERSION 3.20)
        
        # è®¾ç½®é¡¹ç›®ä¿¡æ¯
        project(SkiaPrebuilt
            VERSION 1.0.0
            DESCRIPTION "å®Œæ•´é¢„ç¼–è¯‘çš„ Skia å›¾å½¢åº“ï¼ˆå¯ç”¨ Graphite å’Œ Dawn WebGPUï¼‰"
            LANGUAGES CXX C
        )
        
        # è®¾ç½® C++20 æ ‡å‡†
        set(CMAKE_CXX_STANDARD 20)
        set(CMAKE_CXX_STANDARD_REQUIRED ON)
        set(CMAKE_CXX_EXTENSIONS OFF)
        
        # è·å–å½“å‰ç›®å½•
        get_filename_component(SKIA_ROOT_DIR "${CMAKE_CURRENT_LIST_DIR}" ABSOLUTE)
        
        # åˆ›å»º skdnï¼ˆSkia + Dawnï¼‰æ¥å£åº“
        add_library(skdn INTERFACE)
        add_library(skdn::skdn ALIAS skdn)
        
        # åˆ›å»ºä¼ ç»Ÿçš„ skia æ¥å£åº“ï¼ˆå‘åå…¼å®¹ï¼‰
        add_library(skia INTERFACE)
        add_library(skia::skia ALIAS skia)
        
        # è®¾ç½®åŒ…å«ç›®å½•
        target_include_directories(skdn INTERFACE
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/modules>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/third_party>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/third_party/dawn/include>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/third_party/spirv-cross>
            $<INSTALL_INTERFACE:.>
            $<INSTALL_INTERFACE:modules>
            $<INSTALL_INTERFACE:third_party>
            $<INSTALL_INTERFACE:third_party/dawn/include>
            $<INSTALL_INTERFACE:third_party/spirv-cross>
        )
        
        # skia åº“ä½¿ç”¨ç›¸åŒçš„åŒ…å«ç›®å½•
        target_include_directories(skia INTERFACE
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/modules>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/third_party>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/third_party/dawn/include>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/third_party/spirv-cross>
            $<INSTALL_INTERFACE:.>
            $<INSTALL_INTERFACE:modules>
            $<INSTALL_INTERFACE:third_party>
            $<INSTALL_INTERFACE:third_party/dawn/include>
            $<INSTALL_INTERFACE:third_party/spirv-cross>
        )
        
        # æ£€æµ‹å½“å‰å¹³å°å’Œæ¶æ„
        if(WIN32)
            set(PLATFORM_NAME "Win")
            if(CMAKE_SIZEOF_VOID_P EQUAL 8)
                set(ARCH_NAME "x64")
            else()
                set(ARCH_NAME "x86")
            endif()
        elseif(APPLE)
            set(PLATFORM_NAME "macOS")
            if(CMAKE_SYSTEM_PROCESSOR MATCHES "arm64|aarch64")
                set(ARCH_NAME "arm64")
            else()
                set(ARCH_NAME "x64")
            endif()
        elseif(ANDROID)
            set(PLATFORM_NAME "Android")
            if(CMAKE_ANDROID_ARCH_ABI STREQUAL "arm64-v8a")
                set(ARCH_NAME "arm64")
            elseif(CMAKE_ANDROID_ARCH_ABI STREQUAL "x86_64")
                set(ARCH_NAME "x64")
            else()
                set(ARCH_NAME "arm64")  # é»˜è®¤
            endif()
        else()
            set(PLATFORM_NAME "Linux")
            if(CMAKE_SIZEOF_VOID_P EQUAL 8)
                set(ARCH_NAME "x64")
            else()
                set(ARCH_NAME "x86")
            endif()
        endif()
        
        # è®¾ç½®åº“æ–‡ä»¶è·¯å¾„
        set(SKIA_LIB_DIR "${SKIA_ROOT_DIR}/lib/${PLATFORM_NAME}/${ARCH_NAME}")
        
        # æŸ¥æ‰¾æ‰€æœ‰çš„åº“æ–‡ä»¶
        file(GLOB SKIA_LIBRARIES "${SKIA_LIB_DIR}/*")
        
        # æ ¹æ®å¹³å°è®¾ç½®ç‰¹å®šçš„é“¾æ¥åº“å’Œç¼–è¯‘é€‰é¡¹
        if(WIN32)
            # Windows å¹³å°é…ç½® - å¯ç”¨ Graphite å’Œ Dawn
            target_compile_definitions(skdn INTERFACE
                SK_GANESH=1
                SK_GRAPHITE=1
                SK_DAWN=1
                SK_VULKAN=1
                SK_GL=1
                SK_BUILD_FOR_WIN=1
                SK_ENABLE_SKOTTIE=1
                SK_ENABLE_SVG=1
                UNICODE
                _UNICODE
                NOMINMAX
            )
            
            # è®¾ç½® Windows è¿è¡Œæ—¶ä¸º /MDï¼ˆå¤šçº¿ç¨‹ DLLï¼‰
            target_compile_options(skdn INTERFACE
                $<$<CONFIG:Debug>:/MDd>
                $<$<CONFIG:Release>:/MD>
                $<$<CONFIG:RelWithDebInfo>:/MD>
                $<$<CONFIG:MinSizeRel>:/MD>
            )
            
            # æ·»åŠ  Windows ç³»ç»Ÿåº“
            target_link_libraries(skdn INTERFACE
                ${SKIA_LIBRARIES}
                # OpenGL ç›¸å…³
                OpenGL32
                # DirectX ç›¸å…³
                d3d11
                dxgi
                d3dcompiler
                dxguid
                # ç³»ç»Ÿåº“
                Gdi32
                User32
                Kernel32
                Ole32
                OleAut32
                Uuid
                Advapi32
                Shell32
                # å­—ä½“å’Œæ–‡æœ¬
                Usp10
                # ç½‘ç»œ
                Ws2_32
                # Dawn WebGPU ç›¸å…³
                dxva2
                bcrypt
            )
            
        elseif(APPLE)
            # macOS å¹³å°é…ç½® - å¯ç”¨ Graphite å’Œ Dawn
            target_compile_definitions(skdn INTERFACE
                SK_GANESH=1
                SK_GRAPHITE=1
                SK_DAWN=1
                SK_METAL=1
                SK_GL=1
                SK_VULKAN=1
                SK_BUILD_FOR_MAC=1
                SK_ENABLE_SKOTTIE=1
                SK_ENABLE_SVG=1
            )
            
            # æŸ¥æ‰¾ macOS ç³»ç»Ÿæ¡†æ¶
            find_library(FOUNDATION_FRAMEWORK Foundation)
            find_library(COREGRAPHICS_FRAMEWORK CoreGraphics)
            find_library(CORETEXT_FRAMEWORK CoreText)
            find_library(COREFOUNDATION_FRAMEWORK CoreFoundation)
            find_library(COCOA_FRAMEWORK Cocoa)
            find_library(METAL_FRAMEWORK Metal)
            find_library(METALKIT_FRAMEWORK MetalKit)
            find_library(OPENGL_FRAMEWORK OpenGL)
            find_library(QUARTZCORE_FRAMEWORK QuartzCore)
            find_library(IOSURFACE_FRAMEWORK IOSurface)
            
            target_link_libraries(skdn INTERFACE
                ${SKIA_LIBRARIES}
                ${FOUNDATION_FRAMEWORK}
                ${COREGRAPHICS_FRAMEWORK}
                ${CORETEXT_FRAMEWORK}
                ${COREFOUNDATION_FRAMEWORK}
                ${COCOA_FRAMEWORK}
                ${METAL_FRAMEWORK}
                ${METALKIT_FRAMEWORK}
                ${OPENGL_FRAMEWORK}
                ${QUARTZCORE_FRAMEWORK}
                ${IOSURFACE_FRAMEWORK}
            )
            
        elseif(ANDROID)
            # Android å¹³å°é…ç½® - å¯ç”¨ Graphite å’Œ Dawn
            target_compile_definitions(skdn INTERFACE
                ANDROID
                SK_GANESH=1
                SK_GRAPHITE=1
                SK_DAWN=1
                SK_VULKAN=1
                SK_GL=1
                SK_BUILD_FOR_ANDROID=1
                SK_ENABLE_SKOTTIE=1
                SK_ENABLE_SVG=1
                __ANDROID_API__=21
            )
            
            target_compile_options(skdn INTERFACE
                -fPIC
                -fno-rtti
                -fno-exceptions
            )
            
            target_link_libraries(skdn INTERFACE
                ${SKIA_LIBRARIES}
                # OpenGL ES ç›¸å…³
                GLESv2
                EGL
                # Vulkan ç›¸å…³
                vulkan
                # Android ç³»ç»Ÿåº“
                android
                log
                jnigraphics
                # åª’ä½“ç›¸å…³
                mediandk
                # ç³»ç»Ÿåº“
                dl
                m
                z
            )
            
            # Android ç‰¹å®šçš„é“¾æ¥é€‰é¡¹
            target_link_options(skdn INTERFACE
                -Wl,--gc-sections
                -Wl,--as-needed
            )
            
        else()
            # Linux å¹³å°é…ç½® - å¯ç”¨ Graphite å’Œ Dawn
            target_compile_definitions(skdn INTERFACE
                SK_GANESH=1
                SK_GRAPHITE=1
                SK_DAWN=1
                SK_VULKAN=1
                SK_GL=1
                SK_BUILD_FOR_UNIX=1
                SK_ENABLE_SKOTTIE=1
                SK_ENABLE_SVG=1
            )
            
            # æŸ¥æ‰¾å¿…è¦çš„ç³»ç»Ÿåº“
            find_package(PkgConfig QUIET)
            if(PKG_CONFIG_FOUND)
                pkg_check_modules(FONTCONFIG QUIET fontconfig)
                pkg_check_modules(HARFBUZZ QUIET harfbuzz)
            endif()
            
            # æŸ¥æ‰¾ Vulkan
            find_package(Vulkan QUIET)
            
            # æŸ¥æ‰¾ X11 ç›¸å…³åº“
            find_package(X11 QUIET)
            
            target_link_libraries(skdn INTERFACE
                ${SKIA_LIBRARIES}
                # OpenGL
                GL
                # ç³»ç»Ÿåº“
                pthread
                dl
                m
            )
            
            # FontConfig æ”¯æŒ
            if(FONTCONFIG_FOUND)
                target_link_libraries(skdn INTERFACE ${FONTCONFIG_LIBRARIES})
                target_include_directories(skdn INTERFACE ${FONTCONFIG_INCLUDE_DIRS})
            endif()
            
            # HarfBuzz æ”¯æŒ
            if(HARFBUZZ_FOUND)
                target_link_libraries(skdn INTERFACE ${HARFBUZZ_LIBRARIES})
                target_include_directories(skdn INTERFACE ${HARFBUZZ_INCLUDE_DIRS})
            endif()
            
            # æ·»åŠ  Vulkan æ”¯æŒ
            if(Vulkan_FOUND)
                target_link_libraries(skdn INTERFACE ${Vulkan_LIBRARIES})
                target_include_directories(skdn INTERFACE ${Vulkan_INCLUDE_DIRS})
            endif()
            
            # æ·»åŠ  X11 æ”¯æŒ
            if(X11_FOUND)
                target_link_libraries(skdn INTERFACE
                    ${X11_LIBRARIES}
                    ${X11_Xrandr_LIB}
                    ${X11_Xinerama_LIB}
                    ${X11_Xcursor_LIB}
                    ${X11_Xi_LIB}
                )
                target_include_directories(skdn INTERFACE ${X11_INCLUDE_DIR})
            endif()
        endif()
        
        # å‘åå…¼å®¹çš„ skia åº“ä½¿ç”¨ç›¸åŒçš„è®¾ç½®
        target_compile_definitions(skia INTERFACE $<TARGET_PROPERTY:skdn,INTERFACE_COMPILE_DEFINITIONS>)
        target_compile_options(skia INTERFACE $<TARGET_PROPERTY:skdn,INTERFACE_COMPILE_OPTIONS>)
        target_link_libraries(skia INTERFACE $<TARGET_PROPERTY:skdn,INTERFACE_LINK_LIBRARIES>)
        target_link_options(skia INTERFACE $<TARGET_PROPERTY:skdn,INTERFACE_LINK_OPTIONS>)
        
        # è®¾ç½®ç¼–è¯‘ç‰¹æ€§
        target_compile_features(skdn INTERFACE cxx_std_20)
        target_compile_features(skia INTERFACE cxx_std_20)
        
        # ä¼˜åŒ–è®¾ç½®
        target_compile_options(skdn INTERFACE
            $<$<CONFIG:Debug>:-g -O0>
            $<$<CONFIG:Release>:-O3 -DNDEBUG>
            $<$<CONFIG:RelWithDebInfo>:-O2 -g -DNDEBUG>
        )
        
        target_compile_options(skia INTERFACE
            $<$<CONFIG:Debug>:-g -O0>
            $<$<CONFIG:Release>:-O3 -DNDEBUG>
            $<$<CONFIG:RelWithDebInfo>:-O2 -g -DNDEBUG>
        )
        
        # è®¾ç½®é¢„å¤„ç†å™¨å®šä¹‰
        target_compile_definitions(skdn INTERFACE
            $<$<CONFIG:Debug>:SK_DEBUG>
            $<$<CONFIG:Release>:SK_RELEASE>
        )
        
        target_compile_definitions(skia INTERFACE
            $<$<CONFIG:Debug>:SK_DEBUG>
            $<$<CONFIG:Release>:SK_RELEASE>
        )
        
        # åˆ›å»ºä¾¿åˆ©å‡½æ•°ç”¨äºç®€åŒ–ä½¿ç”¨
        function(AddSkiaGraphiteSupport target)
            target_link_libraries(${target} PRIVATE skdn::skdn)
            target_compile_features(${target} PRIVATE cxx_std_20)
            
            # æ·»åŠ æœ‰ç”¨çš„ç¼–è¯‘å®šä¹‰
            target_compile_definitions(${target} PRIVATE
                SK_USE_GRAPHITE=1
                SK_USE_DAWN=1
            )
            
            message(STATUS "å·²ä¸ºç›®æ ‡ ${target} å¯ç”¨ Skia Graphite å’Œ Dawn WebGPU æ”¯æŒ")
        endfunction()
        
        # æä¾›æœ‰ç”¨çš„ä¿¡æ¯
        message(STATUS "Skia é¢„ç¼–è¯‘åº“é…ç½®å®Œæˆ")
        message(STATUS "å¹³å°: ${PLATFORM_NAME}")
        message(STATUS "æ¶æ„: ${ARCH_NAME}")
        message(STATUS "åº“ç›®å½•: ${SKIA_LIB_DIR}")
        message(STATUS "C++ æ ‡å‡†: C++20")
        message(STATUS "æ”¯æŒçš„ç‰¹æ€§:")
        message(STATUS "  âœ… Ganesh GPU åç«¯")
        message(STATUS "  âœ… Graphite GPU åç«¯ï¼ˆä¸‹ä¸€ä»£ï¼‰")
        message(STATUS "  âœ… Dawn WebGPU åç«¯")
        message(STATUS "  âœ… å®Œæ•´çš„ 2D å›¾å½¢åŠŸèƒ½")
        message(STATUS "  âœ… PDF/SVG/åŠ¨ç”»æ”¯æŒ")
        message(STATUS "  âœ… ç°ä»£ C++20 æ”¯æŒ")
        message(STATUS "ä½¿ç”¨æ–¹æ³•:")
        message(STATUS "  æ¨è: target_link_libraries(your_target skdn::skdn)")
        message(STATUS "  å…¼å®¹: target_link_libraries(your_target skia::skia)")
        message(STATUS "  ä¾¿åˆ©: AddSkiaGraphiteSupport(your_target)")
        EOF
        
    - name: åˆ›å»ºæœ€ç»ˆ ZIP åŒ…
      run: |
        cd Skia_Final
        
        # åˆ›å»ºç»Ÿä¸€çš„æ„å»ºä¿¡æ¯æ–‡ä»¶
        cat > Skia/BUILD_INFO_COMBINED.txt << EOF
        Skia å…¨å¹³å°æ„å»ºåŒ…ï¼ˆå¯ç”¨ Graphite + Dawn WebGPU + C++20ï¼‰
        ========================================================
        
        åŒ…å«å¹³å°:
        - Windows x64ï¼ˆMSVC 2022ï¼‰
        - macOS x64 & ARM64ï¼ˆApple Clangï¼‰
        - Linux x64ï¼ˆGCC 13ï¼‰
        - Android x64 & ARM64ï¼ˆClang 18ï¼‰
        
        ä¸»è¦ç‰¹æ€§:
        âœ… C++20 æ ‡å‡†æ”¯æŒ
        âœ… Ganesh GPU åç«¯ï¼ˆä¼ ç»Ÿï¼‰
        âœ… Graphite GPU åç«¯ï¼ˆä¸‹ä¸€ä»£ï¼‰
        âœ… Dawn WebGPU æ”¯æŒ
        âœ… å®Œæ•´çš„ 2D å›¾å½¢åŠŸèƒ½
        âœ… PDF/SVG/åŠ¨ç”»æ”¯æŒ
        âœ… å†…ç½®å­—ä½“å’Œæ–‡æœ¬å¤„ç†
        âœ… è·¨å¹³å°å…¼å®¹æ€§
        âœ… ç°ä»£ç¼–è¯‘å™¨æ”¯æŒ
        
        ä½¿ç”¨æ–¹æ³•:
        1. è§£å‹åˆ°é¡¹ç›®ç›®å½•
        2. åœ¨ CMakeLists.txt ä¸­æ·»åŠ :
           set(CMAKE_CXX_STANDARD 20)
           add_subdirectory(path/to/Skia)
           target_link_libraries(your_target skdn::skdn)
        
        æˆ–ä½¿ç”¨ä¾¿åˆ©å‡½æ•°:
           AddSkiaGraphiteSupport(your_target)
        
        Graphite ä¼˜åŠ¿:
        - ç°ä»£ GPU æ¶æ„ä¼˜åŒ–
        - æ›´å¥½çš„å¤šçº¿ç¨‹æ€§èƒ½
        - é™ä½ CPU å¼€é”€
        - WebGPU æ ‡å‡†æ”¯æŒ
        - ä¸ Dawn æ·±åº¦é›†æˆ
        
        Dawn WebGPU ä¼˜åŠ¿:
        - è·¨å¹³å° GPU è®¡ç®—
        - ç°ä»£ç€è‰²å™¨æ”¯æŒï¼ˆWGSLï¼‰
        - é«˜æ€§èƒ½å›¾å½¢æ¸²æŸ“
        - æœªæ¥æ ‡å‡†å…¼å®¹
        
        ç¼–è¯‘å™¨æ”¯æŒ:
        - Windows: MSVC 2022 + /std:c++20
        - macOS: Apple Clang + -std=c++20
        - Linux: GCC 13 + -std=c++20
        - Android: Clang 18 + -std=c++20
        
        æŠ€æœ¯äº®ç‚¹:
        - å…¨æ–°çš„ Graphite æ¸²æŸ“æ¶æ„
        - å®Œæ•´çš„ Dawn WebGPU é›†æˆ
        - ç°ä»£ C++20 ç‰¹æ€§æ”¯æŒ
        - ä¼˜åŒ–çš„å¤šçº¿ç¨‹æ€§èƒ½
        - ç”Ÿäº§ç¯å¢ƒå°±ç»ª
        EOF
        
        # æ‰“åŒ…æˆ ZIP æ–‡ä»¶
        zip -r Skia_Prebuilt.zip Skia/
        
    - name: ä¸Šä¼ æœ€ç»ˆæ„å»ºåŒ…
      uses: actions/upload-artifact@v4
      with:
        name: Skia_Prebuilt
        path: Skia_Final/Skia_Prebuilt.zip
        retention-days: 90
        
  # åˆ›å»º GitHub Release å‘å¸ƒï¼ˆä»…åœ¨æ¨é€åˆ°ä¸»åˆ†æ”¯æˆ–å®šæ—¶ä»»åŠ¡æˆ–æ‰‹åŠ¨è§¦å‘æ—¶ï¼‰
  create-release:
    needs: merge-artifacts
    runs-on: ubuntu-latest
    if: |
      (github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master')) ||
      github.event_name == 'schedule' ||
      github.event_name == 'workflow_dispatch'
    
    permissions:
      contents: write
      packages: write
    
    steps:
    # æ£€å‡ºä»£ç ä»¥è®¿é—®ä»“åº“ä¿¡æ¯
    - name: æ£€å‡ºä»£ç ä»“åº“
      uses: actions/checkout@v4
      
    # ä¸‹è½½æœ€ç»ˆæ„å»ºåŒ…
    - name: ä¸‹è½½ Skia æ„å»ºåŒ…
      uses: actions/download-artifact@v4
      with:
        name: Skia_Prebuilt
        path: .
        
    # è·å–å‘å¸ƒæ ‡ç­¾
    - name: è·å–å‘å¸ƒæ ‡ç­¾
      id: get_tag
      run: |
        if [ "${{ github.event_name }}" = "schedule" ]; then
          echo "tag=skia-graphite-daily-$(date +%Y%m%d)" >> $GITHUB_OUTPUT
          echo "name=Skia Graphite å…¨å¹³å°æ¯æ—¥æ„å»ºåŒ… $(date +%Y-%m-%d)" >> $GITHUB_OUTPUT
        else
          echo "tag=skia-graphite-v${{ github.run_number }}" >> $GITHUB_OUTPUT
          echo "name=Skia Graphite å…¨å¹³å°æ„å»ºåŒ… v${{ github.run_number }}" >> $GITHUB_OUTPUT
        fi
        
    # åˆ›å»º GitHub Release å‘å¸ƒç‰ˆæœ¬
    - name: åˆ›å»º GitHub Release
      uses: softprops/action-gh-release@v2
      with:
        tag_name: ${{ steps.get_tag.outputs.tag }}
        name: ${{ steps.get_tag.outputs.name }}
        body: |
          # ğŸš€ Skia å…¨å¹³å°æ„å»ºåŒ…ï¼ˆå¯ç”¨ Graphite + Dawn + C++20ï¼‰
          
          è¿™ä¸ªå‘å¸ƒåŒ…åŒ…å«äº†å¯ç”¨ **Graphite**ã€**Dawn WebGPU** å’Œ **C++20** çš„ Skia å›¾å½¢åº“å…¨å¹³å°é¢„ç¼–è¯‘ç‰ˆæœ¬ã€‚
          
          ## ğŸ¯ æ–°ç‰¹æ€§
          
          ### C++20 æ ‡å‡†æ”¯æŒ
          - ğŸ”¥ **ç°ä»£ C++**: å®Œæ•´æ”¯æŒ C++20 æ ‡å‡†å’Œç‰¹æ€§
          - âš¡ **æ€§èƒ½ä¼˜åŒ–**: åˆ©ç”¨ C++20 çš„ç¼–è¯‘æ—¶ä¼˜åŒ–
          - ğŸ§µ **åç¨‹æ”¯æŒ**: ä¸ºå¼‚æ­¥å›¾å½¢æ“ä½œåšå¥½å‡†å¤‡
          - ğŸ® **æ¦‚å¿µæ”¯æŒ**: æ›´å¥½çš„æ¨¡æ¿é”™è¯¯ä¿¡æ¯
          
          ### Graphite æ¸²æŸ“åç«¯
          - ğŸ”¥ **ä¸‹ä¸€ä»£GPUæ¶æ„**: ä¸“ä¸ºç°ä»£GPUè®¾è®¡çš„å…¨æ–°æ¸²æŸ“åç«¯
          - âš¡ **æè‡´æ€§èƒ½**: æ˜¾è‘—é™ä½CPUå¼€é”€ï¼Œæå‡GPUåˆ©ç”¨ç‡
          - ğŸ§µ **å¤šçº¿ç¨‹å‹å¥½**: åŸç”Ÿæ”¯æŒå¤šçº¿ç¨‹æ¸²æŸ“ç®¡çº¿
          - ğŸ® **ç°ä»£API**: åŸºäºVulkan/Metal/Direct3D 12è®¾è®¡
          
          ### Dawn WebGPU æ”¯æŒ
          - ğŸŒ **WebGPUæ ‡å‡†**: å®Œæ•´æ”¯æŒæœ€æ–°WebGPUè§„èŒƒ
          - âš¡ **GPUè®¡ç®—**: é«˜æ€§èƒ½è®¡ç®—ç€è‰²å™¨æ”¯æŒ
          - ğŸ”§ **ç°ä»£å·¥å…·é“¾**: ä¸Graphiteæ·±åº¦é›†æˆ
          - ğŸ“± **è·¨å¹³å°**: ç»Ÿä¸€çš„GPUæŠ½è±¡å±‚
          
          ## ğŸ“¦ åŒ…å«å¹³å°
          
          | å¹³å° | æ¶æ„ | ç¼–è¯‘å™¨ | GPUåç«¯ | C++æ ‡å‡† |
          |------|------|--------|---------|---------|
          | **Windows** | x64 | MSVC 2022 | DirectX 12 + Vulkan + OpenGL + Graphite + Dawn | /std:c++20 |
          | **macOS** | x64 + ARM64 | Apple Clang | Metal + Vulkan + OpenGL + Graphite + Dawn | -std=c++20 |
          | **Linux** | x64 | GCC 13 | Vulkan + OpenGL + Graphite + Dawn | -std=c++20 |
          | **Android** | x64 + ARM64 | Clang 18 (NDK r25c) | Vulkan + OpenGL ES + Graphite + Dawn | -std=c++20 |
          
          ## ğŸš€ å¿«é€Ÿå¼€å§‹
          
          ### CMake é›†æˆï¼ˆæ¨èï¼‰
          
          ```cmake
          # è®¾ç½® C++20 æ ‡å‡†
          set(CMAKE_CXX_STANDARD 20)
          set(CMAKE_CXX_STANDARD_REQUIRED ON)
          
          # æ·»åŠ  Skia å­ç›®å½•
          add_subdirectory(path/to/Skia)
          
          # æ–¹æ³•ä¸€ï¼šä½¿ç”¨æ¨èçš„ skdn åº“ï¼ˆåŒ…å« Graphite + Dawnï¼‰
          target_link_libraries(your_target skdn::skdn)
          
          # æ–¹æ³•äºŒï¼šä½¿ç”¨ä¾¿åˆ©å‡½æ•°ï¼ˆè‡ªåŠ¨é…ç½®ï¼‰
          AddSkiaGraphiteSupport(your_target)
          
          # æ–¹æ³•ä¸‰ï¼šä¼ ç»Ÿæ–¹å¼ï¼ˆå‘åå…¼å®¹ï¼‰
          target_link_libraries(your_target skia::skia)
          ```
          
          ### åŸºç¡€ä½¿ç”¨ç¤ºä¾‹
          
          ```cpp
          #include "include/core/SkCanvas.h"
          #include "include/core/SkSurface.h"
          #include "include/gpu/graphite/Context.h"  // Graphite æ”¯æŒ
          #include "include/gpu/dawn/DawnTypes.h"    // Dawn WebGPU æ”¯æŒ
          
          // ä½¿ç”¨ Graphite æ¸²æŸ“
          auto contextOptions = skgpu::graphite::ContextOptions{};
          auto context = skgpu::graphite::Context::MakeVulkan(contextOptions);
          
          SkImageInfo info = SkImageInfo::MakeN32Premul(800, 600);
          auto surface = SkSurface::MakeGraphite(context.get(), info);
          auto canvas = surface->getCanvas();
          
          // ä½¿ç”¨ç°ä»£ C++20 ç‰¹æ€§
          auto drawCircle = [&](auto center, auto radius, const SkPaint& paint) {
              canvas->drawCircle(center.x(), center.y(), radius, paint);
          };
          
          SkPoint center{400, 300};
          drawCircle(center, 50.0f, paint);
          ```
          
          ## ğŸ”§ é«˜çº§ç‰¹æ€§
          
          ### Graphite é…ç½®
          ```cpp
          // å¯ç”¨ Graphite æ¸²æŸ“
          #define SK_GRAPHITE 1
          #define SK_USE_GRAPHITE 1
          
          // åˆ›å»º Graphite ä¸Šä¸‹æ–‡
          skgpu::graphite::ContextOptions options;
          options.fStoreContextRefInRecorder = true;
          auto context = skgpu::graphite::Context::MakeVulkan(options);
          ```
          
          ### Dawn WebGPU é…ç½®
          ```cpp
          // å¯ç”¨ Dawn WebGPU
          #define SK_DAWN 1
          #define SK_USE_DAWN 1
          
          // åˆ›å»º Dawn è®¾å¤‡
          wgpu::Device device = CreateWebGPUDevice();
          auto context = skgpu::graphite::Context::MakeDawn(device);
          ```
          
          ### C++20 ç‰¹æ€§ç¤ºä¾‹
          ```cpp
          #include <concepts>
          #include <ranges>
          #include <coroutine>
          
          // ä½¿ç”¨æ¦‚å¿µçº¦æŸ
          template<std::floating_point T>
          void DrawWithPrecision(SkCanvas* canvas, T x, T y, T radius) {
              SkPaint paint;
              canvas->drawCircle(static_cast<SkScalar>(x), 
                               static_cast<SkScalar>(y), 
                               static_cast<SkScalar>(radius), paint);
          }
          
          // ä½¿ç”¨èŒƒå›´åº“
          auto points = std::vector<SkPoint>{{0, 0}, {100, 100}, {200, 50}};
          for (const auto& point : points | std::views::take(2)) {
              canvas->drawPoint(point, paint);
          }
          ```
          
          ## ğŸ“‹ ç³»ç»Ÿè¦æ±‚
          
          ### Windows
          - Windows 10 1909+ æˆ– Windows 11
          - Visual Studio 2022 17.0+
          - MSVC 2022 ç¼–è¯‘å™¨
          - DirectX 12 å…¼å®¹æ˜¾å¡
          
          ### macOS
          - macOS 11.0+ (Big Sur)
          - Xcode 13+
          - Apple Clang 13+
          - Metal å…¼å®¹æ˜¾å¡
          
          ### Linux
          - Ubuntu 22.04+ æˆ– equivalent
          - GCC 13+ æˆ– Clang 15+
          - Vulkan 1.2+ é©±åŠ¨
          - ç°ä»£ OpenGL 4.5+ æ”¯æŒ
          
          ### Android
          - Android API 21+ (Android 5.0)
          - NDK r25c+
          - Clang 18+
          - OpenGL ES 3.0+ æˆ– Vulkan 1.0+
          
          ## ğŸ†• ç‰ˆæœ¬äº®ç‚¹
          
          - âœ… **C++20 é¦–å‘**: å®Œæ•´çš„ C++20 æ ‡å‡†æ”¯æŒ
          - âœ… **Graphite å®Œæ•´ç‰ˆ**: ç”Ÿäº§å°±ç»ªçš„ Graphite æ¸²æŸ“åç«¯
          - âœ… **Dawn é›†æˆ**: æ·±åº¦é›†æˆçš„ WebGPU æ”¯æŒ
          - âœ… **ç°ä»£ç¼–è¯‘å™¨**: ä½¿ç”¨æœ€æ–°çš„ç¼–è¯‘å™¨å’Œå·¥å…·é“¾
          - âœ… **æ€§èƒ½ä¼˜åŒ–**: å¤šçº¿ç¨‹å’Œ GPU ä¼˜åŒ–
          - âœ… **ä¾¿åˆ©å‡½æ•°**: ç®€åŒ–çš„é›†æˆå’Œé…ç½®
          
          ## ğŸ“– æ–‡æ¡£å’Œèµ„æº
          
          - [Skia å®˜æ–¹æ–‡æ¡£](https://skia.org/docs/)
          - [Graphite è®¾è®¡æ–‡æ¡£](https://skia.org/docs/dev/design/graphite/)
          - [Dawn WebGPU é¡¹ç›®](https://dawn.googlesource.com/dawn)
          - [WebGPU è§„èŒƒ](https://www.w3.org/TR/webgpu/)
          - [C++20 ç‰¹æ€§å‚è€ƒ](https://en.cppreference.com/w/cpp/20)
          
          ## ğŸ› é—®é¢˜åé¦ˆ
          
          å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
          1. æ“ä½œç³»ç»Ÿå’Œç‰ˆæœ¬
          2. ç¼–è¯‘å™¨å’Œç‰ˆæœ¬
          3. CMake ç‰ˆæœ¬
          4. é”™è¯¯ä¿¡æ¯å’Œå †æ ˆè·Ÿè¸ª
          5. æœ€å°å¤ç°ä»£ç 
          
          ---
          
          **æ„å»ºä¿¡æ¯**: ä½¿ç”¨æœ€æ–°ç¼–è¯‘å™¨ï¼Œå¯ç”¨ C++20 æ ‡å‡†ï¼ŒåŒ…å« Graphite å’Œ Dawn WebGPU æ”¯æŒï¼Œç”Ÿäº§ç¯å¢ƒå°±ç»ªã€‚
        files: |
          Skia_Prebuilt.zip
        draft: false
        prerelease: false
        generate_release_notes: false
        make_latest: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
