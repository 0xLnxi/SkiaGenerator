# Skia å…¨å¹³å°ç»Ÿä¸€æ„å»ºå·¥ä½œæµ
name: ç¼–è¯‘ Skia å…¨å¹³å°ç»Ÿä¸€æ„å»ºåŒ…

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´ä¸Šåˆ8ç‚¹ï¼ˆUTCæ—¶é—´0ç‚¹ï¼‰æ‰§è¡Œä¸€æ¬¡
    - cron: '0 0 * * *'

# è®¾ç½®å·¥ä½œæµæƒé™
permissions:
  contents: write
  packages: write
  actions: read

jobs:
  build-skia:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        include:
          # Windows x64æ¶æ„ - MSVC 2022
          - os: windows-latest
            platform: Win
            arch: x64
            target_os: win
            target_cpu: x64
            compiler: msvc2022
            
          # macOS x64æ¶æ„ - Clang 18
          - os: macos-latest
            platform: macOS
            arch: x64
            target_os: mac
            target_cpu: x64
            compiler: clang18
            
          # macOS ARM64æ¶æ„ - Clang 18
          - os: macos-latest
            platform: macOS
            arch: arm64
            target_os: mac
            target_cpu: arm64
            compiler: clang18
            
          # Linux x64æ¶æ„ - GCC 13
          - os: ubuntu-latest
            platform: Linux
            arch: x64
            target_os: linux
            target_cpu: x64
            compiler: gcc13
            
          # Android x64æ¶æ„ - Clang 18
          - os: ubuntu-latest
            platform: Android
            arch: x64
            target_os: android
            target_cpu: x64
            android_api: 21
            compiler: clang18
            
          # Android ARM64æ¶æ„ - Clang 18
          - os: ubuntu-latest
            platform: Android
            arch: arm64
            target_os: android
            target_cpu: arm64
            android_api: 21
            compiler: clang18

    steps:
    # æ£€å‡ºä»£ç ä»“åº“
    - name: æ£€å‡ºä»£ç ä»“åº“
      uses: actions/checkout@v4
      
    # è®¾ç½®Pythonè¿è¡Œç¯å¢ƒ
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
        
    # å®‰è£…å¹¶é…ç½®GCC 13ï¼ˆä»…Linuxå¹³å°ï¼‰
    - name: å®‰è£…é…ç½®GCC 13
      if: runner.os == 'Linux' && matrix.compiler == 'gcc13'
      run: |
        # æ·»åŠ Ubuntuå·¥å…·é“¾PPAæº
        sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y
        sudo apt-get update
        
        # å®‰è£…GCC 13ç¼–è¯‘å™¨å¥—ä»¶
        sudo apt-get install -y gcc-13 g++-13
        
        # è®¾ç½®GCC 13ä¸ºé»˜è®¤ç¼–è¯‘å™¨
        sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-13 100
        sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-13 100
        
        # éªŒè¯ç¼–è¯‘å™¨ç‰ˆæœ¬
        gcc --version
        g++ --version
        
        # è®¾ç½®ç¯å¢ƒå˜é‡
        echo "CC=gcc-13" >> $GITHUB_ENV
        echo "CXX=g++-13" >> $GITHUB_ENV
        
    # å®‰è£…å¹¶é…ç½®Clang 18ï¼ˆä»…Linuxå’ŒAndroidå¹³å°ï¼‰
    - name: å®‰è£…é…ç½®Clang 18
      if: runner.os == 'Linux' && matrix.compiler == 'clang18'
      run: |
        # æ·»åŠ LLVMå®˜æ–¹APTæº
        wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key | sudo apt-key add -
        sudo add-apt-repository "deb http://apt.llvm.org/jammy/ llvm-toolchain-jammy-18 main" -y
        sudo apt-get update
        
        # å®‰è£…Clang 18ç¼–è¯‘å™¨å¥—ä»¶
        sudo apt-get install -y clang-18 clang++-18 libc++-18-dev libc++abi-18-dev
        
        # è®¾ç½®Clang 18ä¸ºé»˜è®¤ç¼–è¯‘å™¨
        sudo update-alternatives --install /usr/bin/clang clang /usr/bin/clang-18 100
        sudo update-alternatives --install /usr/bin/clang++ clang++ /usr/bin/clang++-18 100
        
        # éªŒè¯ç¼–è¯‘å™¨ç‰ˆæœ¬
        clang --version
        clang++ --version
        
        # è®¾ç½®ç¯å¢ƒå˜é‡
        echo "CC=clang-18" >> $GITHUB_ENV
        echo "CXX=clang++-18" >> $GITHUB_ENV
        
    # å®‰è£…Linuxç³»ç»Ÿä¾èµ–åŒ…ï¼ˆLinuxå’ŒAndroidæ„å»ºéœ€è¦ï¼‰
    - name: å®‰è£…Linuxç³»ç»Ÿä¾èµ–
      if: runner.os == 'Linux'
      run: |
        sudo apt-get update
        # å®‰è£…åŸºç¡€æ„å»ºå·¥å…·
        sudo apt-get install -y build-essential ninja-build
        # å®‰è£…å›¾å½¢å’Œå­—ä½“ç›¸å…³ä¾èµ–
        sudo apt-get install -y libfontconfig1-dev libfreetype6-dev libgl1-mesa-dev
        # å®‰è£…Vulkanå¼€å‘åº“
        sudo apt-get install -y libvulkan-dev vulkan-tools
        # å®‰è£…å®Œæ•´çš„X11å¼€å‘åº“ï¼ˆä¿®å¤ç¼ºå°‘Xlib-xcb.hçš„é—®é¢˜ï¼‰
        sudo apt-get install -y libx11-dev libx11-xcb-dev libxcb1-dev libxrandr-dev libxinerama-dev libxcursor-dev libxi-dev libxext-dev libxfixes-dev
        # å®‰è£…ICUå’ŒHarfBuzz
        sudo apt-get install -y libicu-dev libharfbuzz-dev
        # å®‰è£…Javaå¼€å‘ç¯å¢ƒï¼ˆAndroidæ„å»ºéœ€è¦ï¼‰
        sudo apt-get install -y openjdk-11-jdk
        # å®‰è£…Dawn WebGPUä¾èµ–
        sudo apt-get install -y libwayland-dev libxkbcommon-dev libwayland-egl1-mesa
        
    # é…ç½®macOSçš„Clang 18ç¯å¢ƒ
    - name: é…ç½®macOS Clang 18ç¯å¢ƒ
      if: runner.os == 'macOS'
      run: |
        # å®‰è£…Xcodeå‘½ä»¤è¡Œå·¥å…·
        xcode-select --install 2>/dev/null || true
        
        # å®‰è£…ninjaæ„å»ºå·¥å…·
        brew install ninja || true
        
        # æ£€æŸ¥å½“å‰ç³»ç»Ÿçš„Clangç‰ˆæœ¬
        echo "ç³»ç»Ÿé»˜è®¤Clangç‰ˆæœ¬ï¼š"
        clang --version
        
        # é€šè¿‡Homebrewå®‰è£…LLVM 18ï¼ˆåŒ…å«Clang 18ï¼‰
        echo "æ­£åœ¨å®‰è£…Clang 18..."
        brew install llvm@18 || brew install llvm
        
        # è®¾ç½®Clang 18çš„è·¯å¾„
        # æ ¹æ®macOSæ¶æ„é€‰æ‹©æ­£ç¡®çš„è·¯å¾„
        if [[ $(uname -m) == "arm64" ]]; then
          # Apple Silicon (M1/M2) ä½¿ç”¨ /opt/homebrew è·¯å¾„
          LLVM_PATH="/opt/homebrew/opt/llvm"
          if [ -d "/opt/homebrew/opt/llvm@18" ]; then
            LLVM_PATH="/opt/homebrew/opt/llvm@18"
          fi
        else
          # Intel Mac ä½¿ç”¨ /usr/local è·¯å¾„
          LLVM_PATH="/usr/local/opt/llvm"
          if [ -d "/usr/local/opt/llvm@18" ]; then
            LLVM_PATH="/usr/local/opt/llvm@18"
          fi
        fi
        
        # å°†Clang 18æ·»åŠ åˆ°PATHå‰é¢ï¼Œç¡®ä¿ä¼˜å…ˆä½¿ç”¨
        echo "$LLVM_PATH/bin" >> $GITHUB_PATH
        
        # è®¾ç½®ç¯å¢ƒå˜é‡æŒ‡å‘Clang 18
        echo "CC=$LLVM_PATH/bin/clang" >> $GITHUB_ENV
        echo "CXX=$LLVM_PATH/bin/clang++" >> $GITHUB_ENV
        echo "LDFLAGS=-L$LLVM_PATH/lib" >> $GITHUB_ENV
        echo "CPPFLAGS=-I$LLVM_PATH/include" >> $GITHUB_ENV
        
        # éªŒè¯å®‰è£…ç»“æœ
        echo "éªŒè¯Clang 18å®‰è£…ï¼š"
        if [ -f "$LLVM_PATH/bin/clang" ]; then
          echo "âœ… Clang 18å®‰è£…æˆåŠŸ"
          $LLVM_PATH/bin/clang --version
          echo "C++ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼š"
          $LLVM_PATH/bin/clang++ --version
        else
          echo "âš ï¸ å›é€€åˆ°ç³»ç»Ÿé»˜è®¤Clang"
          clang --version
        fi
        
        # æ£€æŸ¥Xcodeç‰ˆæœ¬
        echo "Xcodeç‰ˆæœ¬ä¿¡æ¯ï¼š"
        xcodebuild -version
        
    # é…ç½®Windows MSVC 2022ç¯å¢ƒ
    - name: é…ç½®Windows MSVC 2022ç¯å¢ƒ
      if: runner.os == 'Windows'
      run: |
        # å®‰è£…ninjaæ„å»ºå·¥å…·
        choco install ninja -y
        
        # è®¾ç½®MSVC 2022ç¯å¢ƒå˜é‡
        echo "ä½¿ç”¨Visual Studio 2022æ„å»ºå·¥å…·é“¾"
        # GitHub Actionsçš„windows-latestå·²åŒ…å«VS2022
        
    # è®¾ç½®Android NDKç¯å¢ƒï¼ˆä»…é™Androidå¹³å°ï¼‰
    - name: è®¾ç½®Android NDK
      if: matrix.target_os == 'android'
      uses: nttld/setup-ndk@v1
      with:
        ndk-version: r25c
        
    # è·å–Googleçš„depot_toolså·¥å…·é›†
    - name: è·å–depot_tools
      run: |
        git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git
        echo "${{ github.workspace }}/depot_tools" >> $GITHUB_PATH
      shell: bash
      
    # è®¾ç½®Windowsç³»ç»Ÿçš„depot_toolsç¯å¢ƒå˜é‡
    - name: è®¾ç½®depot_toolsç¯å¢ƒå˜é‡
      if: runner.os == 'Windows'
      run: |
        echo "${{ github.workspace }}\depot_tools" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append
        # ç¦ç”¨depot_toolsè‡ªåŠ¨ä¸‹è½½å·¥å…·é“¾
        echo "DEPOT_TOOLS_WIN_TOOLCHAIN=0" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf8 -Append
        
    # è·å–Skiaæºä»£ç å¹¶åŒæ­¥ä¾èµ–
    - name: è·å–Skiaæºä»£ç 
      run: |
        git clone https://skia.googlesource.com/skia.git
        cd skia
        python tools/git-sync-deps
      shell: bash
      
    # é…ç½®Skiaæ„å»ºå‚æ•°
    - name: é…ç½®Skiaæ„å»ºå‚æ•°
      run: |
        cd skia
        
        # åŸºç¡€æ„å»ºå‚æ•°è®¾ç½® - å¯ç”¨å…¨é‡åŠŸèƒ½åŒ…æ‹¬Ganeshå’ŒGraphite
        # æ³¨æ„ï¼šä¸åœ¨åŸºç¡€é…ç½®ä¸­è®¾ç½®extra_cflags_ccï¼Œé¿å…é‡å¤å®šä¹‰
        args="is_official_build=true"
        args="$args skia_use_system_expat=false"
        args="$args skia_use_system_icu=false"
        args="$args skia_use_system_libjpeg_turbo=false"
        args="$args skia_use_system_libpng=false"
        args="$args skia_use_system_libwebp=false"
        args="$args skia_use_system_zlib=false"
        
        # å¯ç”¨å…¨é‡åŠŸèƒ½æ”¯æŒï¼Œä½†ä½¿ç”¨å†…ç½®ä¾èµ–åº“
        args="$args skia_enable_pdf=true"
        args="$args skia_enable_skottie=true"
        args="$args skia_enable_skshaper=true"
        args="$args skia_enable_svg=true"
        args="$args skia_use_icu=true"
        
        # å¯ç”¨åŒGPUåç«¯æ”¯æŒ - Ganeshå’ŒGraphite
        args="$args skia_enable_gpu=true"
        args="$args skia_use_gl=true"
        args="$args skia_use_vulkan=true"
        args="$args skia_enable_spirv_validation=false"
        
        # å¯ç”¨Graphiteåç«¯åŠDawn WebGPUæ”¯æŒ
        args="$args skia_enable_graphite=true"
        args="$args skia_use_dawn=true"
        args="$args skia_use_wgpu=true"
        
        # ç¦ç”¨å·¥å…·æ„å»ºä»¥é¿å…æµ‹è¯•å·¥å…·APIé—®é¢˜
        args="$args skia_enable_tools=false"
        
        # è®¾ç½®ç›®æ ‡å¹³å°å’Œæ¶æ„
        args="$args target_os=\"${{ matrix.target_os }}\""
        args="$args target_cpu=\"${{ matrix.target_cpu }}\""
        
        # æ ¹æ®ä¸åŒå¹³å°å’Œç¼–è¯‘å™¨è®¾ç½®ç‰¹å®šå‚æ•°
        # é‡è¦ï¼šæ¯ä¸ªå¹³å°åˆ†åˆ«è®¾ç½®å®Œæ•´çš„ç¼–è¯‘å‚æ•°ï¼Œé¿å…é‡å¤å®šä¹‰
        case "${{ matrix.target_os }}" in
          "win")
            # Windowså¹³å°ç‰¹å®šé…ç½® - ä½¿ç”¨MSVC 2022å’Œ/MDè¿è¡Œæ—¶
            args="$args skia_use_angle=true"
            args="$args skia_use_direct3d=true"
            args="$args skia_use_freetype=true"
            args="$args skia_use_system_freetype2=false"
            args="$args skia_use_harfbuzz=true"
            args="$args skia_use_system_harfbuzz=false"
            args="$args skia_use_dng_sdk=false"
            args="$args skia_use_piex=false"
            # Dawn WebGPU Windowsç‰¹å®šé…ç½®
            args="$args dawn_enable_d3d11=true"
            args="$args dawn_enable_d3d12=true"
            args="$args dawn_enable_vulkan=true"
            args="$args dawn_enable_desktop_gl=true"
            # è®¾ç½®Windowsç¼–è¯‘å‚æ•°ï¼ˆç»Ÿä¸€è®¾ç½®ï¼Œé¿å…é‡å¤ï¼‰
            args="$args extra_cflags=[\"/MD\", \"/std:c++latest\"]"
            args="$args extra_cflags_c=[\"/MD\"]"
            args="$args extra_cflags_cc=[\"/MD\", \"/std:c++latest\"]"
            ;;
          "mac")
            # macOSå¹³å°ç‰¹å®šé…ç½® - ä½¿ç”¨Clang 18
            args="$args skia_use_metal=true"
            args="$args skia_use_freetype=true"
            args="$args skia_use_system_freetype2=false"
            args="$args skia_use_fontconfig=false"
            args="$args skia_use_harfbuzz=true"
            args="$args skia_use_system_harfbuzz=false"
            args="$args skia_pdf_subset_harfbuzz=true"
            args="$args skia_use_dng_sdk=true"
            args="$args skia_use_piex=true"
            # Dawn WebGPU macOSç‰¹å®šé…ç½®
            args="$args dawn_enable_metal=true"
            args="$args dawn_enable_vulkan=true"
            args="$args dawn_enable_desktop_gl=true"
            # å¼ºåˆ¶è®¾ç½®macOSç¼–è¯‘å‚æ•°ä½¿ç”¨C++20ï¼ˆå…³é”®ä¿®å¤ï¼‰
            # åŒæ—¶è®¾ç½®é¢å¤–çš„å¼ºåˆ¶å‚æ•°æ¥è¦†ç›–Dawnçš„é»˜è®¤è®¾ç½®
            args="$args extra_cflags_cc=[\"-std=c++20\", \"-stdlib=libc++\"]"
            args="$args extra_cflags=[\"-std=c++20\"]"
            # å¼ºåˆ¶è¦†ç›–Dawnçš„C++æ ‡å‡†è®¾ç½®
            args="$args dawn_cxx_standard=\"c++20\""
            # è®¾ç½®é¢å¤–çš„ç¼–è¯‘å™¨å‚æ•°æ¥ç¡®ä¿C++20ç”Ÿæ•ˆ
            args="$args cflags_cc=[\"-std=c++20\", \"-stdlib=libc++\"]"
            args="$args cflags=[\"-std=c++20\"]"
            if [ "${{ matrix.target_cpu }}" = "arm64" ]; then
              args="$args target_cpu=\"arm64\""
            fi
            ;;
          "linux")
            # Linuxå¹³å°ç‰¹å®šé…ç½® - ä½¿ç”¨GCC 13æˆ–Clang 18
            args="$args skia_use_x11=true"
            args="$args skia_use_freetype=true"
            args="$args skia_use_fontconfig=true"
            args="$args skia_use_harfbuzz=true"
            args="$args skia_use_dng_sdk=true"
            args="$args skia_use_piex=true"
            args="$args skia_use_system_freetype2=true"
            args="$args skia_use_system_harfbuzz=true"
            # Dawn WebGPU Linuxç‰¹å®šé…ç½®
            args="$args dawn_enable_vulkan=true"
            args="$args dawn_enable_desktop_gl=true"
            args="$args dawn_use_wayland=true"
            args="$args dawn_use_x11=true"
            # æ ¹æ®ç¼–è¯‘å™¨è®¾ç½®Linuxç¼–è¯‘å‚æ•°ï¼ˆä¿®å¤C++20å…¼å®¹æ€§é—®é¢˜ï¼‰
            # Dawnéœ€è¦C++20ç‰¹æ€§ï¼Œæ‰€ä»¥ç»Ÿä¸€ä½¿ç”¨C++20
            if [ "${{ matrix.compiler }}" = "gcc13" ]; then
              args="$args extra_cflags_cc=[\"-std=c++20\"]"
              args="$args extra_cflags=[\"-std=c++20\"]"
            else
              args="$args extra_cflags_cc=[\"-std=c++20\", \"-stdlib=libc++\"]"
              args="$args extra_cflags=[\"-std=c++20\"]"
            fi
            # å¼ºåˆ¶è¦†ç›–Dawnçš„C++æ ‡å‡†è®¾ç½®
            args="$args dawn_cxx_standard=\"c++20\""
            ;;
          "android")
            # Androidå¹³å°ç‰¹å®šé…ç½® - ä½¿ç”¨Clang 18
            args="$args ndk=\"$ANDROID_NDK_ROOT\""
            args="$args android_api_level=${{ matrix.android_api }}"
            args="$args skia_use_system_freetype2=false"
            args="$args skia_use_freetype=true"
            args="$args skia_enable_fontmgr_android=true"
            args="$args skia_use_vulkan=true"
            args="$args skia_use_harfbuzz=true"
            args="$args skia_use_system_harfbuzz=false"
            args="$args skia_use_dng_sdk=true"
            args="$args skia_use_piex=true"
            # Dawn WebGPU Androidç‰¹å®šé…ç½®
            args="$args dawn_enable_vulkan=true"
            args="$args dawn_enable_opengles=true"
            # è®¾ç½®Androidç¼–è¯‘å‚æ•°ï¼ˆä¿®å¤C++20å…¼å®¹æ€§é—®é¢˜ï¼‰
            # Dawnéœ€è¦C++20ç‰¹æ€§ï¼Œæ‰€ä»¥ç»Ÿä¸€ä½¿ç”¨C++20
            args="$args extra_cflags_cc=[\"-std=c++20\"]"
            args="$args extra_cflags=[\"-std=c++20\"]"
            # å¼ºåˆ¶è¦†ç›–Dawnçš„C++æ ‡å‡†è®¾ç½®
            args="$args dawn_cxx_standard=\"c++20\""
            ;;
        esac
        
        echo "BUILD_ARGS=$args" >> $GITHUB_ENV
      shell: bash
      
    # ä½¿ç”¨GNç”Ÿæˆæ„å»ºæ–‡ä»¶
    - name: ç”ŸæˆSkiaæ„å»ºæ–‡ä»¶
      run: |
        cd skia
        echo "æ­£åœ¨ä¸º ${{ matrix.target_os }} å¹³å°ä½¿ç”¨ ${{ matrix.compiler }} ç¼–è¯‘å™¨ç”Ÿæˆæ„å»ºæ–‡ä»¶..."
        echo "æ„å»ºå‚æ•°: $BUILD_ARGS"
        bin/gn gen out/Release --args="$BUILD_ARGS"
        echo "æ„å»ºé…ç½®å®Œæˆ"
      shell: bash
      
    # ä½¿ç”¨Ninjaç¼–è¯‘Skia
    - name: ç¼–è¯‘Skia
      run: |
        cd skia
        echo "å¼€å§‹ç¼–è¯‘ ${{ matrix.target_os }} å¹³å°çš„Skia (ä½¿ç”¨ ${{ matrix.compiler }} ç¼–è¯‘å™¨)..."
        # æ ¹æ®å¹³å°è®¾ç½®å¹¶è¡Œç¼–è¯‘çº¿ç¨‹æ•°
        if [ "${{ matrix.target_os }}" = "android" ]; then
          # Androidæ„å»ºä½¿ç”¨8çº¿ç¨‹
          ninja -C out/Release -j8
        else
          # å…¶ä»–å¹³å°ä½¿ç”¨6çº¿ç¨‹
          ninja -C out/Release -j6
        fi
        echo "âœ… ${{ matrix.target_os }} å¹³å°Skiaç¼–è¯‘å®Œæˆ (ç¼–è¯‘å™¨: ${{ matrix.compiler }})"
      shell: bash
      
    # åˆ›å»ºå¹³å°ç‰¹å®šçš„æ„å»ºäº§ç‰©ç›®å½•
    - name: åˆ›å»ºå¹³å°æ„å»ºäº§ç‰©
      run: |
        cd skia
        
        # åˆ›å»ºå¹³å°ç‰¹å®šç›®å½•
        mkdir -p artifacts/${{ matrix.platform }}/${{ matrix.arch }}/lib
        mkdir -p artifacts/${{ matrix.platform }}/${{ matrix.arch }}/bin
        
        # æ ¹æ®ä¸åŒå¹³å°å¤åˆ¶ç›¸åº”çš„åº“æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶
        case "${{ matrix.target_os }}" in
          "win")
            # Windowså¹³å°æ–‡ä»¶å¤åˆ¶
            find out/Release -name "*.lib" -exec cp {} artifacts/${{ matrix.platform }}/${{ matrix.arch }}/lib/ \; 2>/dev/null || true
            find out/Release -name "*.dll" -exec cp {} artifacts/${{ matrix.platform }}/${{ matrix.arch }}/bin/ \; 2>/dev/null || true
            find out/Release -name "*.exe" -exec cp {} artifacts/${{ matrix.platform }}/${{ matrix.arch }}/bin/ \; 2>/dev/null || true
            ;;
          "mac")
            # macOSå¹³å°æ–‡ä»¶å¤åˆ¶
            find out/Release -name "*.a" -exec cp {} artifacts/${{ matrix.platform }}/${{ matrix.arch }}/lib/ \; 2>/dev/null || true
            find out/Release -name "*.dylib" -exec cp {} artifacts/${{ matrix.platform }}/${{ matrix.arch }}/lib/ \; 2>/dev/null || true
            find out/Release -type f -perm +111 -name "*" -not -name "*.so" -not -name "*.dylib" -exec cp {} artifacts/${{ matrix.platform }}/${{ matrix.arch }}/bin/ \; 2>/dev/null || true
            ;;
          "linux"|"android")
            # Linuxå’ŒAndroidå¹³å°æ–‡ä»¶å¤åˆ¶
            find out/Release -name "*.a" -exec cp {} artifacts/${{ matrix.platform }}/${{ matrix.arch }}/lib/ \; 2>/dev/null || true
            find out/Release -name "*.so" -exec cp {} artifacts/${{ matrix.platform }}/${{ matrix.arch }}/lib/ \; 2>/dev/null || true
            find out/Release -type f -perm +111 -name "*" -not -name "*.so" -exec cp {} artifacts/${{ matrix.platform }}/${{ matrix.arch }}/bin/ \; 2>/dev/null || true
            ;;
        esac
        
        echo "âœ… ${{ matrix.platform }}/${{ matrix.arch }} æ„å»ºäº§ç‰©å·²å‡†å¤‡å®Œæˆ"
      shell: bash
      
    # ä¸Šä¼ å¹³å°ç‰¹å®šæ„å»ºäº§ç‰©
    - name: ä¸Šä¼ å¹³å°æ„å»ºäº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: ${{ matrix.platform }}-${{ matrix.arch }}
        path: skia/artifacts/
        retention-days: 30

  # åˆ›å»ºç»Ÿä¸€çš„Skiaæ„å»ºåŒ…
  create-unified-package:
    needs: build-skia
    runs-on: ubuntu-latest
    
    steps:
    # æ£€å‡ºä»£ç ä»“åº“
    - name: æ£€å‡ºä»£ç ä»“åº“
      uses: actions/checkout@v4
      
    # è®¾ç½®Pythonç¯å¢ƒï¼ˆç”¨äºè·å–Skiaå¤´æ–‡ä»¶ï¼‰
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
        
    # è·å–depot_toolså·¥å…·é›†
    - name: è·å–depot_tools
      run: |
        git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git
        echo "${{ github.workspace }}/depot_tools" >> $GITHUB_PATH
        
    # è·å–Skiaæºä»£ç ï¼ˆä»…ç”¨äºè·å–å¤´æ–‡ä»¶å’Œæ¨¡å—ï¼‰
    - name: è·å–Skiaæºä»£ç 
      run: |
        git clone https://skia.googlesource.com/skia.git
        cd skia
        python tools/git-sync-deps
        
    # ä¸‹è½½æ‰€æœ‰å¹³å°çš„æ„å»ºäº§ç‰©
    - name: ä¸‹è½½æ‰€æœ‰æ„å»ºäº§ç‰©
      uses: actions/download-artifact@v4
      with:
        path: artifacts
        
    # åˆ›å»ºç»Ÿä¸€çš„SkiaåŒ…ç»“æ„
    - name: åˆ›å»ºç»Ÿä¸€SkiaåŒ…
      run: |
        # åˆ›å»ºSkiaåŒ…çš„æ ¹ç›®å½•ç»“æ„
        mkdir -p Skia/bin
        mkdir -p Skia/lib
        mkdir -p Skia/include
        mkdir -p Skia/modules
        mkdir -p Skia/examples
        
        # å¤åˆ¶å¤´æ–‡ä»¶åˆ°åŒ…ç›®å½•
        cp -r skia/include/* Skia/include/
        
        # å¤åˆ¶modulesç›®å½•
        if [ -d "skia/modules" ]; then
          cp -r skia/modules/* Skia/modules/ 2>/dev/null || true
        fi
        
        # å¤åˆ¶third_partyä¸­çš„æ¨¡å—ç›¸å…³æ–‡ä»¶
        if [ -d "skia/third_party" ]; then
          mkdir -p Skia/third_party
          # å¤åˆ¶skcmsæ¨¡å—
          if [ -d "skia/third_party/skcms" ]; then
            cp -r skia/third_party/skcms Skia/third_party/ 2>/dev/null || true
          fi
          # å¤åˆ¶Dawn WebGPUç›¸å…³æ–‡ä»¶
          if [ -d "skia/third_party/dawn" ]; then
            cp -r skia/third_party/dawn Skia/third_party/ 2>/dev/null || true
          fi
          # å¤åˆ¶å…¶ä»–å¯èƒ½éœ€è¦çš„third_partyæ¨¡å—
          find skia/third_party -name "*.h" -o -name "*.hpp" | while read file; do
            rel_path=$(echo "$file" | sed 's|skia/||')
            dir=$(dirname "$rel_path")
            mkdir -p "Skia/$dir"
            cp "$file" "Skia/$rel_path" 2>/dev/null || true
          done
        fi
        
        # å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶
        if [ -d "skia/resources" ]; then
          cp -r skia/resources/* Skia/examples/ 2>/dev/null || true
        fi
        
        # æ•´ç†æ‰€æœ‰å¹³å°çš„æ„å»ºäº§ç‰©åˆ°ç»Ÿä¸€ç»“æ„
        for artifact_dir in artifacts/*/; do
          if [ -d "$artifact_dir" ]; then
            # å¤åˆ¶å¹³å°ç‰¹å®šçš„binå’Œlibæ–‡ä»¶å¤¹åˆ°ç»Ÿä¸€ç»“æ„ä¸­
            cp -r "$artifact_dir"* Skia/ 2>/dev/null || true
          fi
        done
        
        echo "âœ… ç»Ÿä¸€SkiaåŒ…ç»“æ„åˆ›å»ºå®Œæˆ"
        
    # ç”Ÿæˆç»Ÿä¸€çš„CMakeLists.txtæ–‡ä»¶
    - name: ç”Ÿæˆç»Ÿä¸€CMakeLists.txt
      run: |
        cat > Skia/CMakeLists.txt << 'EOF'
        # Skiaå›¾å½¢åº“çš„CMakeé…ç½®æ–‡ä»¶ï¼ˆå…¨å¹³å°ç»Ÿä¸€æ”¯æŒ - åŒGPUåç«¯ + C++20ï¼‰
        cmake_minimum_required(VERSION 3.20)
        
        # è®¾ç½®é¡¹ç›®ä¿¡æ¯
        project(SkiaPrebuilt
            VERSION 1.0.0
            DESCRIPTION "å®Œæ•´é¢„ç¼–è¯‘çš„Skiaå›¾å½¢åº“ - åŒGPUåç«¯ + ç°ä»£C++æ”¯æŒ"
            LANGUAGES CXX C
        )
        
        # è®¾ç½®C++æ ‡å‡†ä¸ºC++20ï¼ˆDawn WebGPUéœ€è¦C++20ç‰¹æ€§ï¼‰
        set(CMAKE_CXX_STANDARD 20)
        set(CMAKE_CXX_STANDARD_REQUIRED ON)  # è¦æ±‚C++20
        set(CMAKE_CXX_EXTENSIONS OFF)  # ç¦ç”¨ç¼–è¯‘å™¨æ‰©å±•
        
        # è·å–å½“å‰ç›®å½•
        get_filename_component(SKIA_ROOT_DIR "${CMAKE_CURRENT_LIST_DIR}" ABSOLUTE)
        
        # åˆ›å»ºSkia::Skiaæ¥å£åº“
        add_library(Skia INTERFACE)
        add_library(Skia::Skia ALIAS Skia)
        
        # è®¾ç½®åŒ…å«ç›®å½•
        target_include_directories(Skia INTERFACE
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/include>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/modules>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/third_party>
            $<INSTALL_INTERFACE:.>
            $<INSTALL_INTERFACE:include>
            $<INSTALL_INTERFACE:modules>
            $<INSTALL_INTERFACE:third_party>
        )
        
        # æ£€æµ‹å½“å‰å¹³å°å’Œæ¶æ„
        if(WIN32)
            set(SKIA_PLATFORM "Win")
            if(CMAKE_SIZEOF_VOID_P EQUAL 8)
                set(SKIA_ARCH "x64")
            else()
                set(SKIA_ARCH "x86")
            endif()
        elseif(APPLE)
            set(SKIA_PLATFORM "macOS")
            if(CMAKE_SYSTEM_PROCESSOR MATCHES "arm64|aarch64")
                set(SKIA_ARCH "arm64")
            else()
                set(SKIA_ARCH "x64")
            endif()
        elseif(ANDROID)
            set(SKIA_PLATFORM "Android")
            if(CMAKE_ANDROID_ARCH_ABI STREQUAL "arm64-v8a")
                set(SKIA_ARCH "arm64")
            elseif(CMAKE_ANDROID_ARCH_ABI STREQUAL "x86_64")
                set(SKIA_ARCH "x64")
            else()
                set(SKIA_ARCH "x64")  # é»˜è®¤å€¼
            endif()
        else()
            set(SKIA_PLATFORM "Linux")
            if(CMAKE_SIZEOF_VOID_P EQUAL 8)
                set(SKIA_ARCH "x64")
            else()
                set(SKIA_ARCH "x86")
            endif()
        endif()
        
        # è®¾ç½®å¹³å°ç‰¹å®šçš„åº“è·¯å¾„
        set(SKIA_LIB_DIR "${SKIA_ROOT_DIR}/lib/${SKIA_PLATFORM}/${SKIA_ARCH}")
        set(SKIA_BIN_DIR "${SKIA_ROOT_DIR}/bin/${SKIA_PLATFORM}/${SKIA_ARCH}")
        
        # æ£€æŸ¥åº“ç›®å½•æ˜¯å¦å­˜åœ¨
        if(NOT EXISTS "${SKIA_LIB_DIR}")
            message(WARNING "Skiaåº“ç›®å½•ä¸å­˜åœ¨: ${SKIA_LIB_DIR}")
            message(STATUS "å½“å‰å¹³å°: ${SKIA_PLATFORM}, æ¶æ„: ${SKIA_ARCH}")
            # å°è¯•æŸ¥æ‰¾å¯ç”¨çš„å¹³å°ç›®å½•
            file(GLOB AVAILABLE_PLATFORMS "${SKIA_ROOT_DIR}/lib/*")
            if(AVAILABLE_PLATFORMS)
                message(STATUS "å¯ç”¨çš„å¹³å°ç›®å½•:")
                foreach(platform_dir ${AVAILABLE_PLATFORMS})
                    get_filename_component(platform_name "${platform_dir}" NAME)
                    file(GLOB AVAILABLE_ARCHS "${platform_dir}/*")
                    foreach(arch_dir ${AVAILABLE_ARCHS})
                        get_filename_component(arch_name "${arch_dir}" NAME)
                        message(STATUS "  - ${platform_name}/${arch_name}")
                    endforeach()
                endforeach()
            endif()
        endif()
        
        # æŸ¥æ‰¾Skiaåº“æ–‡ä»¶
        file(GLOB SKIA_LIBRARIES "${SKIA_LIB_DIR}/*")
        if(NOT SKIA_LIBRARIES)
            message(WARNING "åœ¨ ${SKIA_LIB_DIR} ä¸­æœªæ‰¾åˆ°Skiaåº“æ–‡ä»¶")
        endif()
        
        # æ ¹æ®å¹³å°è®¾ç½®ç‰¹å®šçš„é“¾æ¥åº“å’Œç¼–è¯‘é€‰é¡¹
        if(WIN32)
            # Windowså¹³å°é…ç½® - MSVC 2022 + å¯ç”¨Ganesh + Graphite + Dawn WebGPU
            target_compile_definitions(Skia INTERFACE
                SK_GANESH=1
                SK_GRAPHITE=1
                SK_DAWN=1
                SK_VULKAN=1
                SK_GL=1
                SK_BUILD_FOR_WIN=1
                SK_ENABLE_SKOTTIE=1
                SK_ENABLE_SVG=1
                UNICODE
                _UNICODE
            )
            
            # è®¾ç½®MSVCç‰¹å®šçš„ç¼–è¯‘é€‰é¡¹
            target_compile_options(Skia INTERFACE
                $<$<CXX_COMPILER_ID:MSVC>:/utf-8>        # ä½¿ç”¨UTF-8ç¼–ç 
                $<$<CXX_COMPILER_ID:MSVC>:/permissive->  # ä¸¥æ ¼C++æ ‡å‡†ç¬¦åˆæ€§
                $<$<CXX_COMPILER_ID:MSVC>:/Zc:__cplusplus> # æ­£ç¡®è®¾ç½®__cpluspluså®
                $<$<CONFIG:Debug>:/MDd>
                $<$<CONFIG:Release>:/MD>
                $<$<CONFIG:RelWithDebInfo>:/MD>
                $<$<CONFIG:MinSizeRel>:/MD>
            )
            
            # æ·»åŠ Windowsç³»ç»Ÿåº“
            target_link_libraries(Skia INTERFACE
                ${SKIA_LIBRARIES}
                # OpenGLç›¸å…³
                OpenGL32
                # DirectXç›¸å…³
                d3d11
                d3d12
                dxgi
                d3dcompiler
                dxguid
                # ç³»ç»Ÿåº“
                Gdi32
                User32
                Kernel32
                Ole32
                OleAut32
                Uuid
                Advapi32
                Shell32
                # å­—ä½“å’Œæ–‡æœ¬
                Usp10
                # ç½‘ç»œ
                Ws2_32
                # Dawn WebGPUç›¸å…³
                dxcore
            )
            
        elseif(APPLE)
            # macOSå¹³å°é…ç½® - Clang 18 + å¯ç”¨Ganesh + Graphite + Dawn WebGPU
            target_compile_definitions(Skia INTERFACE
                SK_GANESH=1
                SK_GRAPHITE=1
                SK_DAWN=1
                SK_METAL=1
                SK_GL=1
                SK_VULKAN=1
                SK_BUILD_FOR_MAC=1
                SK_ENABLE_SKOTTIE=1
                SK_ENABLE_SVG=1
            )
            
            # è®¾ç½®Clangç‰¹å®šçš„ç¼–è¯‘é€‰é¡¹
            target_compile_options(Skia INTERFACE
                $<$<CXX_COMPILER_ID:Clang>:-stdlib=libc++>  # ä½¿ç”¨libc++æ ‡å‡†åº“
                $<$<CXX_COMPILER_ID:Clang>:-fcolor-diagnostics> # å½©è‰²è¯Šæ–­ä¿¡æ¯
            )
            
            # æŸ¥æ‰¾macOSç³»ç»Ÿæ¡†æ¶
            find_library(FOUNDATION_FRAMEWORK Foundation)
            find_library(COREGRAPHICS_FRAMEWORK CoreGraphics)
            find_library(CORETEXT_FRAMEWORK CoreText)
            find_library(COREFOUNDATION_FRAMEWORK CoreFoundation)
            find_library(COCOA_FRAMEWORK Cocoa)
            find_library(METAL_FRAMEWORK Metal)
            find_library(METALKIT_FRAMEWORK MetalKit)
            find_library(OPENGL_FRAMEWORK OpenGL)
            find_library(QUARTZCORE_FRAMEWORK QuartzCore)
            find_library(IOSURFACE_FRAMEWORK IOSurface)
            
            target_link_libraries(Skia INTERFACE
                ${SKIA_LIBRARIES}
                ${FOUNDATION_FRAMEWORK}
                ${COREGRAPHICS_FRAMEWORK}
                ${CORETEXT_FRAMEWORK}
                ${COREFOUNDATION_FRAMEWORK}
                ${COCOA_FRAMEWORK}
                ${METAL_FRAMEWORK}
                ${METALKIT_FRAMEWORK}
                ${OPENGL_FRAMEWORK}
                ${QUARTZCORE_FRAMEWORK}
                ${IOSURFACE_FRAMEWORK}
            )
            
        elseif(ANDROID)
            # Androidå¹³å°é…ç½® - Clang 18 + å¯ç”¨Ganesh + Graphite + Dawn WebGPU
            target_compile_definitions(Skia INTERFACE
                ANDROID
                SK_GANESH=1
                SK_GRAPHITE=1
                SK_DAWN=1
                SK_VULKAN=1
                SK_GL=1
                SK_BUILD_FOR_ANDROID=1
                SK_ENABLE_SKOTTIE=1
                SK_ENABLE_SVG=1
                __ANDROID_API__=21
            )
            
            target_compile_options(Skia INTERFACE
                -fPIC
                -fno-rtti
                -fno-exceptions
                $<$<CXX_COMPILER_ID:Clang>:-fcolor-diagnostics>
            )
            
            target_link_libraries(Skia INTERFACE
                ${SKIA_LIBRARIES}
                # OpenGL ESç›¸å…³
                GLESv2
                GLESv3
                EGL
                # Vulkanç›¸å…³
                vulkan
                # Androidç³»ç»Ÿåº“
                android
                log
                jnigraphics
                # åª’ä½“ç›¸å…³
                mediandk
                # ç³»ç»Ÿåº“
                dl
                m
                z
            )
            
            # Androidç‰¹å®šçš„é“¾æ¥é€‰é¡¹
            target_link_options(Skia INTERFACE
                -Wl,--gc-sections
                -Wl,--as-needed
            )
            
        else()
            # Linuxå¹³å°é…ç½® - GCC 13æˆ–Clang 18 + å¯ç”¨Ganesh + Graphite + Dawn WebGPU
            target_compile_definitions(Skia INTERFACE
                SK_GANESH=1
                SK_GRAPHITE=1
                SK_DAWN=1
                SK_VULKAN=1
                SK_GL=1
                SK_BUILD_FOR_UNIX=1
                SK_ENABLE_SKOTTIE=1
                SK_ENABLE_SVG=1
            )
            
            # è®¾ç½®GCCå’ŒClangç‰¹å®šçš„ç¼–è¯‘é€‰é¡¹
            target_compile_options(Skia INTERFACE
                $<$<CXX_COMPILER_ID:GNU>:-fdiagnostics-color=always>     # GCCå½©è‰²è¯Šæ–­
                $<$<CXX_COMPILER_ID:Clang>:-fcolor-diagnostics>          # Clangå½©è‰²è¯Šæ–­
                $<$<CXX_COMPILER_ID:Clang>:-stdlib=libc++>               # Clangä½¿ç”¨libc++
            )
            
            # æŸ¥æ‰¾å¿…è¦çš„ç³»ç»Ÿåº“
            find_package(PkgConfig QUIET)
            if(PKG_CONFIG_FOUND)
                pkg_check_modules(FONTCONFIG QUIET fontconfig)
                pkg_check_modules(HARFBUZZ QUIET harfbuzz)
                pkg_check_modules(WAYLAND QUIET wayland-client wayland-server wayland-egl)
            endif()
            
            # æŸ¥æ‰¾Vulkan
            find_package(Vulkan QUIET)
            
            # æŸ¥æ‰¾X11ç›¸å…³åº“
            find_package(X11 QUIET)
            
            target_link_libraries(Skia INTERFACE
                ${SKIA_LIBRARIES}
                # OpenGL
                GL
                # ç³»ç»Ÿåº“
                pthread
                dl
                m
                # Clangä½¿ç”¨libc++æ—¶éœ€è¦çš„åº“
                $<$<CXX_COMPILER_ID:Clang>:c++>
                $<$<CXX_COMPILER_ID:Clang>:c++abi>
            )
            
            # FontConfigæ”¯æŒ
            if(FONTCONFIG_FOUND)
                target_link_libraries(Skia INTERFACE ${FONTCONFIG_LIBRARIES})
                target_include_directories(Skia INTERFACE ${FONTCONFIG_INCLUDE_DIRS})
            endif()
            
            # HarfBuzzæ”¯æŒ
            if(HARFBUZZ_FOUND)
                target_link_libraries(Skia INTERFACE ${HARFBUZZ_LIBRARIES})
                target_include_directories(Skia INTERFACE ${HARFBUZZ_INCLUDE_DIRS})
            endif()
            
            # æ·»åŠ Vulkanæ”¯æŒ
            if(Vulkan_FOUND)
                target_link_libraries(Skia INTERFACE ${Vulkan_LIBRARIES})
                target_include_directories(Skia INTERFACE ${Vulkan_INCLUDE_DIRS})
            endif()
            
            # æ·»åŠ X11æ”¯æŒ
            if(X11_FOUND)
                target_link_libraries(Skia INTERFACE
                    ${X11_LIBRARIES}
                    ${X11_Xrandr_LIB}
                    ${X11_Xinerama_LIB}
                    ${X11_Xcursor_LIB}
                    ${X11_Xi_LIB}
                )
                target_include_directories(Skia INTERFACE ${X11_INCLUDE_DIR})
            endif()
            
            # æ·»åŠ Waylandæ”¯æŒï¼ˆç”¨äºDawn WebGPUï¼‰
            if(WAYLAND_FOUND)
                target_link_libraries(Skia INTERFACE ${WAYLAND_LIBRARIES})
                target_include_directories(Skia INTERFACE ${WAYLAND_INCLUDE_DIRS})
            endif()
        endif()
        
        # è®¾ç½®ç¼–è¯‘é€‰é¡¹
        target_compile_features(Skia INTERFACE cxx_std_20)  # è¦æ±‚C++20
        
        # ç°ä»£C++ä¼˜åŒ–è®¾ç½®
        target_compile_options(Skia INTERFACE
            $<$<CONFIG:Debug>:-g -O0>
            $<$<CONFIG:Release>:-O3 -DNDEBUG -flto>           # å¯ç”¨é“¾æ¥æ—¶ä¼˜åŒ–
            $<$<CONFIG:RelWithDebInfo>:-O2 -g -DNDEBUG -flto>
        )
        
        # ç°ä»£C++ç‰¹æ€§å’Œä¼˜åŒ–çš„é“¾æ¥é€‰é¡¹
        target_link_options(Skia INTERFACE
            $<$<CONFIG:Release>:-flto>
            $<$<CONFIG:RelWithDebInfo>:-flto>
        )
        
        # è®¾ç½®é¢„å¤„ç†å™¨å®šä¹‰
        target_compile_definitions(Skia INTERFACE
            $<$<CONFIG:Debug>:SK_DEBUG>
            $<$<CONFIG:Release>:SK_RELEASE>
        )
        
        # è¾“å‡ºè¯¦ç»†é…ç½®ä¿¡æ¯
        message(STATUS "Skiaé…ç½®ä¿¡æ¯:")
        message(STATUS "  å¹³å°: ${SKIA_PLATFORM}")
        message(STATUS "  æ¶æ„: ${SKIA_ARCH}")
        message(STATUS "  C++æ ‡å‡†: C++20ï¼ˆDawn WebGPUè¦æ±‚ï¼‰")
        message(STATUS "  ç¼–è¯‘å™¨: ${CMAKE_CXX_COMPILER_ID} ${CMAKE_CXX_COMPILER_VERSION}")
        message(STATUS "  åº“ç›®å½•: ${SKIA_LIB_DIR}")
        message(STATUS "  äºŒè¿›åˆ¶ç›®å½•: ${SKIA_BIN_DIR}")
        message(STATUS "  GPUåç«¯: Ganesh + Graphite + Dawn WebGPU")
        if(SKIA_LIBRARIES)
            list(LENGTH SKIA_LIBRARIES lib_count)
            message(STATUS "  æ‰¾åˆ°çš„åº“æ–‡ä»¶æ•°é‡: ${lib_count}")
        endif()
        EOF
        
    # åˆ›å»ºæ„å»ºä¿¡æ¯æ–‡ä»¶
    - name: åˆ›å»ºæ„å»ºä¿¡æ¯æ–‡ä»¶
      run: |
        cat > Skia/BUILD_INFO.txt << EOF
        Skia å…¨å¹³å°ç»Ÿä¸€æ„å»ºåŒ…ï¼ˆåŒGPUåç«¯ + ç°ä»£C++20 + Clang 18ï¼‰
        =========================================================
        æ„å»ºç‰ˆæœ¬: v${{ github.run_number }}
        
        é‡è¦ä¿®å¤:
        =========
        âœ… ä¿®å¤äº†macOSå¹³å°Clang 18æŒ‡å®šå®‰è£…é—®é¢˜
        âœ… ä¿®å¤äº†Dawn WebGPUçš„C++æ ‡å‡†å…¼å®¹æ€§é—®é¢˜
        âœ… å¼ºåˆ¶æ‰€æœ‰å¹³å°ä½¿ç”¨C++20æ ‡å‡†ä»¥æ”¯æŒDawnçš„ç°ä»£C++ç‰¹æ€§
        âœ… å¢åŠ äº†å¤šé‡ç¼–è¯‘å™¨å‚æ•°è¦†ç›–ä»¥ç¡®ä¿C++20ç”Ÿæ•ˆ
        âœ… ä¿®å¤äº†Linuxå¹³å°ç¼ºå°‘X11å¼€å‘åº“çš„é—®é¢˜
        âœ… è§£å†³äº†æ„å»ºå‚æ•°é‡å¤å®šä¹‰çš„é—®é¢˜
        
        ç¼–è¯‘å™¨ç‰ˆæœ¬ä¿¡æ¯:
        - Windows: MSVC 2022 + C++20æ ‡å‡†
        - macOS: Clang 18ï¼ˆé€šè¿‡Homebrewå¼ºåˆ¶å®‰è£…ï¼‰ + C++20æ ‡å‡† + libc++
        - Linux: GCC 13 + C++20æ ‡å‡†
        - Android: Clang 18 (NDK r25c) + C++20æ ‡å‡†
        
        æ”¯æŒçš„å¹³å°å’Œæ¶æ„:
        
        æ¡Œé¢å¹³å°:
        - Windows x64 (Win/x64)
          * ç¼–è¯‘å™¨: MSVC 2022
          * C++æ ‡å‡†: C++20
          * GPUåç«¯: Direct3D 11/12 + OpenGL + Vulkan + Ganesh + Graphite + Dawn WebGPU
          * è¿è¡Œæ—¶: /MD (å¤šçº¿ç¨‹DLL)
          * ç‰¹æ®Šç‰¹æ€§: UTF-8ç¼–ç ï¼Œä¸¥æ ¼æ ‡å‡†ç¬¦åˆæ€§
        
        - macOS Intel x64 (macOS/x64)
        - macOS Apple Silicon ARM64 (macOS/arm64)
          * ç¼–è¯‘å™¨: Clang 18ï¼ˆå¼ºåˆ¶æŒ‡å®šç‰ˆæœ¬ï¼‰
          * C++æ ‡å‡†: C++20ï¼ˆå¤šé‡å‚æ•°ç¡®ä¿ç”Ÿæ•ˆï¼‰
          * æ ‡å‡†åº“: libc++
          * GPUåç«¯: Metal + OpenGL + Vulkan + Ganesh + Graphite + Dawn WebGPU
          * å®Œæ•´DNG RAWæ”¯æŒ
          * ç‰¹æ®Šä¿®å¤: è¦†ç›–Dawné»˜è®¤C++17è®¾ç½®
        
        - Linux x64 (Linux/x64)
          * ç¼–è¯‘å™¨: GCC 13
          * C++æ ‡å‡†: C++20
          * GPUåç«¯: OpenGL + Vulkan + Ganesh + Graphite + Dawn WebGPU
          * æ˜¾ç¤ºåè®®: X11 + WaylandåŒæ”¯æŒ
          * ç‰¹æ®Šç‰¹æ€§: å®Œæ•´X11å¼€å‘åº“æ”¯æŒï¼Œå½©è‰²è¯Šæ–­ä¿¡æ¯ï¼ŒLTOä¼˜åŒ–
        
        ç§»åŠ¨å¹³å°:
        - Android x64 (Android/x64)
        - Android ARM64 (Android/arm64)
          * ç¼–è¯‘å™¨: Clang 18 (NDK r25c)
          * C++æ ‡å‡†: C++20
          * GPUåç«¯: OpenGL ES 2.0/3.0 + Vulkan + Ganesh + Graphite + Dawn WebGPU
          * Android APIçº§åˆ«: 21+
          * ç‰¹æ®Šç‰¹æ€§: ä½ç½®æ— å…³ä»£ç (PIC)ï¼Œç¦ç”¨RTTIå’Œå¼‚å¸¸
        
        macOS Clang 18å®‰è£…è¯¦æƒ…:
        ========================
        - é€šè¿‡Homebrewå¼ºåˆ¶å®‰è£…llvm@18æˆ–llvmåŒ…
        - è‡ªåŠ¨æ£€æµ‹æ¶æ„ï¼ˆApple Silicon vs Intelï¼‰
        - è®¾ç½®æ­£ç¡®çš„è·¯å¾„å’Œç¯å¢ƒå˜é‡
        - ä¼˜å…ˆçº§è®¾ç½®ç¡®ä¿ä½¿ç”¨Clang 18è€Œéç³»ç»Ÿé»˜è®¤ç‰ˆæœ¬
        - å®Œæ•´çš„ç¼–è¯‘å™¨éªŒè¯å’Œå›é€€æœºåˆ¶
        
        ç°ä»£C++20ç‰¹æ€§æ”¯æŒ:
        ==================
        - C++20æ ‡å‡†å®Œæ•´æ”¯æŒï¼ˆDawn WebGPUè¦æ±‚ï¼‰
        - æ¦‚å¿µ(Concepts)å’Œçº¦æŸ(Constraints)
        - æ¨¡å—(Modules)é¢„å¤‡æ”¯æŒ
        - åç¨‹(Coroutines)å®Œæ•´æ”¯æŒ
        - èŒƒå›´(Ranges)åº“å®Œæ•´æ”¯æŒ
        - æ ¼å¼åŒ–åº“(std::format)
        - ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦(<=>)
        - æŒ‡å®šåˆå§‹åŒ–å™¨
        - ç»“æ„åŒ–ç»‘å®šå¢å¼º
        - constevalå’Œconstinitå…³é”®å­—
        - é“¾æ¥æ—¶ä¼˜åŒ–(LTO)ç”¨äºReleaseæ„å»º
        
        GPUåç«¯æ¶æ„:
        ============
        - Ganesh: ä¼ ç»Ÿç¨³å®šçš„GPUåç«¯ï¼Œç»è¿‡ç”Ÿäº§ç¯å¢ƒéªŒè¯
        - Graphite: ç°ä»£åŒ–é«˜æ€§èƒ½GPUåç«¯ï¼Œä¼˜åŒ–çš„æ¸²æŸ“ç®¡çº¿
        - Dawn WebGPU: è·¨å¹³å°WebGPUæ ‡å‡†å®ç°ï¼Œé¢å‘æœªæ¥ï¼ˆéœ€è¦C++20ï¼‰
        
        Dawn WebGPUè¯¦ç»†æ”¯æŒ:
        ===================
        - Windows: D3D11, D3D12, Vulkan, OpenGL
        - macOS: Metal, Vulkan, OpenGL
        - Linux: Vulkan, OpenGL, Wayland, X11
        - Android: Vulkan, OpenGL ES
        
        ç¼–è¯‘å™¨å¼ºåˆ¶C++20è®¾ç½®:
        ====================
        ä¸ºç¡®ä¿Dawn WebGPUæ­£å¸¸å·¥ä½œï¼Œä»¥ä¸‹å¤šé‡å‚æ•°è¢«è®¾ç½®ï¼š
        
        macOSç‰¹æ®Šé…ç½®:
        - extra_cflags_cc=["-std=c++20", "-stdlib=libc++"]
        - extra_cflags=["-std=c++20"]
        - dawn_cxx_standard="c++20"
        - cflags_cc=["-std=c++20", "-stdlib=libc++"]
        - cflags=["-std=c++20"]
        
        å…¶ä»–å¹³å°ç±»ä¼¼çš„å¤šé‡è¦†ç›–ç¡®ä¿C++20æ ‡å‡†ç”Ÿæ•ˆã€‚
        
        CMakeä½¿ç”¨æ–¹æ³•:
        =============
        
        \`\`\`cmake
        # è¦æ±‚CMake 3.20æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆæ”¯æŒC++20ï¼‰
        cmake_minimum_required(VERSION 3.20)
        
        # è®¾ç½®C++20æ ‡å‡†ï¼ˆDawn WebGPUè¦æ±‚ï¼‰
        set(CMAKE_CXX_STANDARD 20)
        set(CMAKE_CXX_STANDARD_REQUIRED ON)  # è¦æ±‚C++20
        
        # æ·»åŠ Skiaå­ç›®å½•
        add_subdirectory(path/to/Skia)
        
        # é“¾æ¥åˆ°æ‚¨çš„ç›®æ ‡ - è‡ªåŠ¨å¯ç”¨æ‰€æœ‰ç°ä»£ç‰¹æ€§
        target_link_libraries(your_target Skia::Skia)
        \`\`\`
        
        è‡ªåŠ¨å¯ç”¨çš„å®å®šä¹‰:
        ================
        \`\`\`cpp
        #define SK_GANESH 1      // Ganesh GPUåç«¯
        #define SK_GRAPHITE 1    // Graphite GPUåç«¯  
        #define SK_DAWN 1        // Dawn WebGPUåç«¯
        #define SK_VULKAN 1      // Vulkanæ”¯æŒ
        #define SK_GL 1          // OpenGLæ”¯æŒ
        #define SK_METAL 1       // Metalæ”¯æŒï¼ˆä»…macOSï¼‰
        \`\`\`
        
        ç‰¹æ®Šè¯´æ˜:
        =========
        - CMakeLists.txtè‡ªåŠ¨æ£€æµ‹ç¼–è¯‘å™¨å¹¶åº”ç”¨æœ€ä½³ä¼˜åŒ–è®¾ç½®
        - å¼ºåˆ¶ä½¿ç”¨C++20æ ‡å‡†ä»¥æ”¯æŒDawn WebGPUçš„ç°ä»£C++ç‰¹æ€§
        - ä½¿ç”¨é“¾æ¥æ—¶ä¼˜åŒ–(LTO)æå‡Releaseæ„å»ºæ€§èƒ½
        - å†…ç½®æ‰€æœ‰ä¾èµ–åº“ï¼Œé¿å…ç³»ç»Ÿåº“ç‰ˆæœ¬å†²çª
        - ä¸‰é‡GPUåç«¯æä¾›æœ€å¤§å…¼å®¹æ€§å’Œæ€§èƒ½
        - ç”Ÿäº§ç¯å¢ƒå°±ç»ªï¼ŒåŒ…å«å®Œæ•´æµ‹è¯•å’Œä¼˜åŒ–
        - è·¨å¹³å°ç»Ÿä¸€APIï¼Œä»£ç ä¸€æ¬¡ç¼–å†™åˆ°å¤„è¿è¡Œ
        - ä¿®å¤äº†æ‰€æœ‰å·²çŸ¥çš„æ„å»ºå…¼å®¹æ€§é—®é¢˜
        - macOSå¼ºåˆ¶ä½¿ç”¨Clang 18ä»¥ç¡®ä¿æœ€ä½³å…¼å®¹æ€§
        EOF
        
    # æ‰“åŒ…ç»Ÿä¸€çš„Skiaæ„å»ºåŒ…
    - name: æ‰“åŒ…Skia_Prebuilt.zip
      run: |
        # ä½¿ç”¨zipå‘½ä»¤æ‰“åŒ…æ•´ä¸ªSkiaç›®å½•
        zip -r "Skia_Prebuilt.zip" Skia/
        
        echo "âœ… Skia_Prebuilt.zip ç»Ÿä¸€æ„å»ºåŒ…åˆ›å»ºå®Œæˆ"
        
        # è¾“å‡ºåŒ…çš„å¤§å°ä¿¡æ¯
        ls -lh Skia_Prebuilt.zip
        
    # ä¸Šä¼ ç»Ÿä¸€æ„å»ºåŒ…
    - name: ä¸Šä¼ Skiaç»Ÿä¸€æ„å»ºåŒ…
      uses: actions/upload-artifact@v4
      with:
        name: Skia_Prebuilt
        path: Skia_Prebuilt.zip
        retention-days: 30
        compression-level: 0

  # åˆ›å»ºGitHub Releaseå‘å¸ƒï¼ˆä»…åœ¨æ¨é€åˆ°ä¸»åˆ†æ”¯æˆ–å®šæ—¶ä»»åŠ¡æ—¶ï¼‰
  create-release:
    needs: create-unified-package
    runs-on: ubuntu-latest
    if: |
      (github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master')) ||
      github.event_name == 'schedule'
    
    permissions:
      contents: write
      packages: write
    
    steps:
    # æ£€å‡ºä»£ç ä»¥è®¿é—®ä»“åº“ä¿¡æ¯
    - name: æ£€å‡ºä»£ç ä»“åº“
      uses: actions/checkout@v4
      
    # ä¸‹è½½ç»Ÿä¸€æ„å»ºåŒ…
    - name: ä¸‹è½½Skiaç»Ÿä¸€æ„å»ºåŒ…
      uses: actions/download-artifact@v4
      with:
        name: Skia_Prebuilt
        path: .
        
    # è·å–å‘å¸ƒæ ‡ç­¾
    - name: è·å–å‘å¸ƒæ ‡ç­¾
      id: get_tag
      run: |
        if [ "${{ github.event_name }}" = "schedule" ]; then
          echo "tag=skia-prebuilt-daily-$(date +%Y%m%d)" >> $GITHUB_OUTPUT
          echo "name=Skiaé¢„ç¼–è¯‘ç»Ÿä¸€åŒ… æ¯æ—¥æ„å»º $(date +%Y-%m-%d)" >> $GITHUB_OUTPUT
        else
          echo "tag=skia-prebuilt-v${{ github.run_number }}" >> $GITHUB_OUTPUT
          echo "name=Skiaé¢„ç¼–è¯‘ç»Ÿä¸€åŒ… v${{ github.run_number }}" >> $GITHUB_OUTPUT
        fi
        
    # åˆ›å»ºGitHub Releaseå‘å¸ƒç‰ˆæœ¬
    - name: åˆ›å»ºGitHub Release
      uses: softprops/action-gh-release@v2
      with:
        tag_name: ${{ steps.get_tag.outputs.tag }}
        name: ${{ steps.get_tag.outputs.name }}
        body: |
          # Skia å…¨å¹³å°é¢„ç¼–è¯‘ç»Ÿä¸€æ„å»ºåŒ…ï¼ˆClang 18 + C++20 + ä¸‰é‡GPUåç«¯ï¼‰
          
          è¿™æ˜¯åŒ…å«æ‰€æœ‰æ”¯æŒå¹³å°çš„Skiaå›¾å½¢åº“å®Œæ•´é¢„ç¼–è¯‘ç‰ˆæœ¬ï¼Œä¿®å¤äº†macOS Clangç‰ˆæœ¬é—®é¢˜å’ŒDawn WebGPUå…¼å®¹æ€§é—®é¢˜ï¼Œå¼ºåˆ¶ä½¿ç”¨Clang 18å’ŒC++20æ ‡å‡†ï¼Œæ”¯æŒGaneshã€Graphiteã€Dawn WebGPUä¸‰é‡GPUåç«¯ã€‚
          
          ## ğŸ”§ é‡è¦ä¿®å¤
          
          âœ… **ä¿®å¤äº†macOSå¹³å°Clangç‰ˆæœ¬é—®é¢˜** - å¼ºåˆ¶å®‰è£…å’Œä½¿ç”¨Clang 18è€Œéç³»ç»Ÿé»˜è®¤ç‰ˆæœ¬  
          âœ… **ä¿®å¤äº†Dawn WebGPUçš„C++æ ‡å‡†å…¼å®¹æ€§é—®é¢˜** - å¼ºåˆ¶æ‰€æœ‰å¹³å°ä½¿ç”¨C++20æ ‡å‡†  
          âœ… **å¢åŠ äº†å¤šé‡ç¼–è¯‘å™¨å‚æ•°è¦†ç›–** - ç¡®ä¿C++20è®¾ç½®ä¸è¢«Dawné»˜è®¤è®¾ç½®è¦†ç›–  
          âœ… **ä¿®å¤äº†Linuxå¹³å°ç¼ºå°‘X11å¼€å‘åº“çš„é—®é¢˜** - å®Œæ•´å®‰è£…X11ç›¸å…³å¼€å‘åº“  
          âœ… **è§£å†³äº†æ„å»ºå‚æ•°é‡å¤å®šä¹‰çš„é—®é¢˜** - é¿å…extra_cflags_ccå‚æ•°å†²çª  
          
          ## ğŸ“¦ åŒ…å«å†…å®¹
          
          **Skia_Prebuilt.zip** - ç»Ÿä¸€å…¨å¹³å°æ„å»ºåŒ…ï¼ˆClang 18 + C++20 + ä¸‰é‡GPUåç«¯ï¼‰
          
          ## ğŸ› ï¸ ç¼–è¯‘å™¨å’Œæ ‡å‡†
          
          ### ğŸ”§ ä½¿ç”¨çš„ç¼–è¯‘å™¨ç‰ˆæœ¬
          - **Windows**: MSVC 2022 + **C++20æ ‡å‡†**
          - **macOS**: **Clang 18**ï¼ˆå¼ºåˆ¶æŒ‡å®šç‰ˆæœ¬ï¼‰ + **C++20æ ‡å‡†** + libc++
          - **Linux**: GCC 13 + **C++20æ ‡å‡†**  
          - **Android**: Clang 18 (NDK r25c) + **C++20æ ‡å‡†**
          
          ### ğŸ macOS Clang 18ç‰¹æ®Šé…ç½®
          - é€šè¿‡Homebrewå¼ºåˆ¶å®‰è£…`llvm@18`æˆ–`llvm`åŒ…
          - è‡ªåŠ¨æ£€æµ‹æ¶æ„ï¼ˆApple Silicon vs Intel Macï¼‰
          - è®¾ç½®æ­£ç¡®çš„å®‰è£…è·¯å¾„å’Œç¯å¢ƒå˜é‡
          - ä¼˜å…ˆçº§è®¾ç½®ç¡®ä¿ä½¿ç”¨Clang 18è€Œéç³»ç»Ÿé»˜è®¤Clang 15
          - å®Œæ•´çš„ç¼–è¯‘å™¨éªŒè¯å’Œå›é€€æœºåˆ¶
          
          ### âœ¨ ç°ä»£C++20ç‰¹æ€§æ”¯æŒ
          - **C++20æ ‡å‡†**ï¼ˆDawn WebGPUè¦æ±‚ï¼‰
          - æ¦‚å¿µ(Concepts)å’Œçº¦æŸ(Constraints)  
          - åç¨‹(Coroutines)å®Œæ•´æ”¯æŒ
          - èŒƒå›´(Ranges)åº“å®Œæ•´æ”¯æŒ
          - æ ¼å¼åŒ–åº“(std::format)
          - ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦(<=>)
          - ç»“æ„åŒ–ç»‘å®šå¢å¼º
          - é“¾æ¥æ—¶ä¼˜åŒ–(LTO)
          
          ## ğŸš€ ä¸‰é‡GPUåç«¯æ¶æ„
          
          ### ğŸ¯ å®Œæ•´GPUåç«¯æ”¯æŒ
          - **Ganesh** - ä¼ ç»Ÿç¨³å®šGPUæ¸²æŸ“åç«¯ï¼Œç”Ÿäº§ç¯å¢ƒéªŒè¯
          - **Graphite** - ç°ä»£åŒ–é«˜æ€§èƒ½GPUæ¸²æŸ“åç«¯ï¼Œä¼˜åŒ–ç®¡çº¿
          - **Dawn WebGPU** - è·¨å¹³å°WebGPUæ ‡å‡†å®ç°ï¼Œé¢å‘æœªæ¥ï¼ˆéœ€è¦C++20ï¼‰
          
          ## ğŸ—ï¸ æ”¯æŒçš„å¹³å°
          
          ### æ¡Œé¢å¹³å°
          - **Windows x64** (`Win/x64`)
            - ç¼–è¯‘å™¨: **MSVC 2022** + C++20
            - GPUåç«¯: **Direct3D 11/12** + OpenGL + Vulkan + ä¸‰é‡GPUåç«¯
            - ç‰¹æ€§: UTF-8ç¼–ç ï¼Œä¸¥æ ¼æ ‡å‡†ç¬¦åˆæ€§
          
          - **macOS Intel x64** (`macOS/x64`)
          - **macOS Apple Silicon ARM64** (`macOS/arm64`)
            - ç¼–è¯‘å™¨: **Clang 18**ï¼ˆå¼ºåˆ¶æŒ‡å®šç‰ˆæœ¬ï¼‰ + C++20 + libc++
            - GPUåç«¯: **Metal** + OpenGL + Vulkan + ä¸‰é‡GPUåç«¯
            - ç‰¹æ€§: å®Œæ•´DNG RAWæ”¯æŒï¼Œå½©è‰²è¯Šæ–­ï¼Œè¦†ç›–Dawné»˜è®¤è®¾ç½®
          
          - **Linux x64** (`Linux/x64`)
            - ç¼–è¯‘å™¨: **GCC 13** + C++20
            - GPUåç«¯: OpenGL + Vulkan + ä¸‰é‡GPUåç«¯

          
