# Skia Graphite + Dawn WebGPU ÂÖ®Âπ≥Âè∞ÊûÑÂª∫Â∑•‰ΩúÊµÅ
name: ÊûÑÂª∫ Skia Graphite ÂÖ®Âπ≥Âè∞È¢ÑÁºñËØëÂåÖ

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:  # ÂÖÅËÆ∏ÊâãÂä®Ëß¶Âèë
  schedule:
    # ÊØèÂë®Êó•Âåó‰∫¨Êó∂Èó¥‰∏äÂçà8ÁÇπÔºàUTCÊó∂Èó¥0ÁÇπÔºâÊâßË°å‰∏ÄÊ¨°
    - cron: '0 0 * * 0'

# ËÆæÁΩÆÂ∑•‰ΩúÊµÅÊùÉÈôê
permissions:
  contents: write
  packages: write
  actions: read

jobs:
  build-skia-graphite:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        include:
          # Windows x64Êû∂ÊûÑ
          - os: windows-latest
            platform: Win
            arch: x64
            target_os: win
            target_cpu: x64
            
          # macOS x64Êû∂ÊûÑ
          - os: macos-13  # Intel Mac
            platform: macOS
            arch: x64
            target_os: mac
            target_cpu: x64
            
          # macOS ARM64Êû∂ÊûÑ
          - os: macos-latest  # Apple Silicon Mac
            platform: macOS
            arch: arm64
            target_os: mac
            target_cpu: arm64
            
          # Linux x64Êû∂ÊûÑ
          - os: ubuntu-latest
            platform: Linux
            arch: x64
            target_os: linux
            target_cpu: x64
            
          # Android x64Êû∂ÊûÑ
          - os: ubuntu-latest
            platform: Android
            arch: x64
            target_os: android
            target_cpu: x64
            android_api: 21
            
          # Android ARM64Êû∂ÊûÑ
          - os: ubuntu-latest
            platform: Android
            arch: arm64
            target_os: android
            target_cpu: arm64
            android_api: 21

    steps:
    # Ê£ÄÂá∫‰ª£Á†Å‰ªìÂ∫ì
    - name: Ê£ÄÂá∫‰ª£Á†Å‰ªìÂ∫ì
      uses: actions/checkout@v4
      
    # ËÆæÁΩÆPythonËøêË°åÁéØÂ¢É
    - name: ËÆæÁΩÆPythonÁéØÂ¢É
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
        
    # ÂÆâË£ÖLinuxÁ≥ªÁªü‰æùËµñÂåÖ
    - name: ÂÆâË£ÖLinuxÁ≥ªÁªü‰æùËµñ
      if: runner.os == 'Linux'
      run: |
        sudo apt-get update
        # Âü∫Á°ÄÊûÑÂª∫Â∑•ÂÖ∑
        sudo apt-get install -y build-essential ninja-build pkg-config
        # ÂõæÂΩ¢ÂíåÂ≠ó‰ΩìÁõ∏ÂÖ≥‰æùËµñ
        sudo apt-get install -y libfontconfig1-dev libfreetype6-dev libgl1-mesa-dev
        # VulkanÂºÄÂèëÂ∫ì
        sudo apt-get install -y libvulkan-dev vulkan-tools
        # X11Áõ∏ÂÖ≥Â∫ì
        sudo apt-get install -y libxrandr-dev libxinerama-dev libxcursor-dev libxi-dev
        # WebGPU/Dawn‰æùËµñ
        sudo apt-get install -y libxss1 libgconf-2-4 libgtk-3-dev libxss1
        # ICUÂíåHarfBuzz
        sudo apt-get install -y libicu-dev libharfbuzz-dev
        # JavaÂºÄÂèëÁéØÂ¢ÉÔºàAndroidÊûÑÂª∫ÈúÄË¶ÅÔºâ
        sudo apt-get install -y openjdk-11-jdk
        # Git LFS for large files
        sudo apt-get install -y git-lfs
        
    # ÂÆâË£ÖmacOSÁ≥ªÁªü‰æùËµñ
    - name: ÂÆâË£ÖmacOSÁ≥ªÁªü‰æùËµñ
      if: runner.os == 'macOS'
      run: |
        # ÂÆâË£ÖninjaÊûÑÂª∫Â∑•ÂÖ∑
        brew install ninja pkg-config
        # È™åËØÅXcodeÁâàÊú¨
        xcodebuild -version
        # ÂÆâË£ÖGit LFS
        brew install git-lfs
        
    # ÂÆâË£ÖWindowsÁ≥ªÁªü‰æùËµñ
    - name: ÂÆâË£ÖWindowsÁ≥ªÁªü‰æùËµñ
      if: runner.os == 'Windows'
      run: |
        # ÂÆâË£ÖninjaÊûÑÂª∫Â∑•ÂÖ∑
        choco install ninja -y
        # ÂÆâË£ÖGit LFS
        choco install git-lfs -y
        
    # ËÆæÁΩÆAndroid NDKÁéØÂ¢É
    - name: ËÆæÁΩÆAndroid NDK
      if: matrix.target_os == 'android'
      uses: nttld/setup-ndk@v1
      with:
        ndk-version: r25c
        
    # Ëé∑Âèñdepot_tools
    - name: Ëé∑Âèñdepot_tools
      run: |
        git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git
        echo "${{ github.workspace }}/depot_tools" >> $GITHUB_PATH
      shell: bash
      
    # ËÆæÁΩÆWindows depot_toolsÁéØÂ¢É
    - name: ËÆæÁΩÆdepot_toolsÁéØÂ¢ÉÂèòÈáè
      if: runner.os == 'Windows'
      run: |
        echo "${{ github.workspace }}\depot_tools" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append
        echo "DEPOT_TOOLS_WIN_TOOLCHAIN=0" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf8 -Append
        
    # Ëé∑ÂèñSkiaÊ∫ê‰ª£Á†Å
    - name: Ëé∑ÂèñSkiaÊ∫ê‰ª£Á†Å
      run: |
        git clone https://skia.googlesource.com/skia.git
        cd skia
        # ÂàùÂßãÂåñGit LFS
        git lfs install
        # ÂêåÊ≠•‰æùËµñ
        python tools/git-sync-deps
      shell: bash
      
    # Ëé∑ÂèñDawn WebGPUÊ∫ê‰ª£Á†Å
    - name: Ëé∑ÂèñDawn WebGPUÊ∫ê‰ª£Á†Å
      run: |
        cd skia
        # Ëé∑ÂèñDawn‰Ωú‰∏∫third_party‰æùËµñ
        git clone https://dawn.googlesource.com/dawn.git third_party/externals/dawn
        cd third_party/externals/dawn
        # ÂàùÂßãÂåñDawn‰æùËµñ
        cp scripts/standalone.gclient .gclient
        gclient sync
      shell: bash
      
    # ÈÖçÁΩÆSkia Graphite + DawnÊûÑÂª∫ÂèÇÊï∞
    - name: ÈÖçÁΩÆSkia GraphiteÊûÑÂª∫ÂèÇÊï∞
      run: |
        cd skia
        
        # Âü∫Á°ÄÊûÑÂª∫ÂèÇÊï∞ - ÂêØÁî®GraphiteÂíåWebGPU
        args="is_official_build=true"
        args="$args skia_use_system_expat=false"
        args="$args skia_use_system_icu=false"
        args="$args skia_use_system_libjpeg_turbo=false"
        args="$args skia_use_system_libpng=false"
        args="$args skia_use_system_libwebp=false"
        args="$args skia_use_system_zlib=false"
        
        # ÂêØÁî®GraphiteÊñ∞ÂõæÂΩ¢API
        args="$args skia_enable_graphite=true"
        args="$args skia_enable_ganesh=true"
        
        # ÂêØÁî®Dawn WebGPUÂêéÁ´Ø
        args="$args skia_use_dawn=true"
        args="$args skia_use_webgpu=true"
        
        # ÂêØÁî®ÂÖ®ÈáèÂäüËÉΩÊîØÊåÅ
        args="$args skia_enable_pdf=true"
        args="$args skia_enable_skottie=true"
        args="$args skia_enable_skshaper=true"
        args="$args skia_enable_svg=true"
        args="$args skia_use_icu=true"
        
        # ÂêØÁî®GPUÂêéÁ´ØÊîØÊåÅ
        args="$args skia_enable_gpu=true"
        args="$args skia_use_gl=true"
        args="$args skia_use_vulkan=true"
        args="$args skia_enable_spirv_validation=false"
        
        # Á¶ÅÁî®Â∑•ÂÖ∑ÊûÑÂª∫
        args="$args skia_enable_tools=false"
        
        # ËÆæÁΩÆÁõÆÊ†áÂπ≥Âè∞ÂíåÊû∂ÊûÑ
        args="$args target_os=\"${{ matrix.target_os }}\""
        args="$args target_cpu=\"${{ matrix.target_cpu }}\""
        
        # Ê†πÊçÆ‰∏çÂêåÂπ≥Âè∞ËÆæÁΩÆÁâπÂÆöÂèÇÊï∞
        case "${{ matrix.target_os }}" in
          "win")
            # WindowsÂπ≥Âè∞ÁâπÂÆöÈÖçÁΩÆ
            args="$args skia_use_angle=true"
            args="$args skia_use_direct3d=true"
            args="$args skia_use_freetype=true"
            args="$args skia_use_system_freetype2=false"
            args="$args skia_use_harfbuzz=true"
            args="$args skia_use_system_harfbuzz=false"
            # Windows WebGPUÂêéÁ´ØÈÖçÁΩÆ
            args="$args dawn_enable_d3d11=true"
            args="$args dawn_enable_d3d12=true"
            args="$args dawn_enable_vulkan=true"
            args="$args dawn_enable_desktop_gl=true"
            # ËÆæÁΩÆËøêË°åÊó∂
            args="$args extra_cflags=[\"/MD\"]"
            args="$args extra_cflags_c=[\"/MD\"]"
            args="$args extra_cflags_cc=[\"/MD\"]"
            ;;
          "mac")
            # macOSÂπ≥Âè∞ÁâπÂÆöÈÖçÁΩÆ
            args="$args skia_use_metal=true"
            args="$args skia_use_freetype=true"
            args="$args skia_use_system_freetype2=false"
            args="$args skia_use_fontconfig=false"
            args="$args skia_use_harfbuzz=true"
            args="$args skia_use_system_harfbuzz=false"
            # macOS WebGPUÂêéÁ´ØÈÖçÁΩÆ
            args="$args dawn_enable_metal=true"
            args="$args dawn_enable_vulkan=true"
            args="$args dawn_enable_desktop_gl=true"
            if [ "${{ matrix.target_cpu }}" = "arm64" ]; then
              args="$args target_cpu=\"arm64\""
            fi
            ;;
          "linux")
            # LinuxÂπ≥Âè∞ÁâπÂÆöÈÖçÁΩÆ
            args="$args skia_use_x11=true"
            args="$args skia_use_freetype=true"
            args="$args skia_use_fontconfig=true"
            args="$args skia_use_harfbuzz=true"
            args="$args skia_use_system_freetype2=true"
            args="$args skia_use_system_harfbuzz=true"
            # Linux WebGPUÂêéÁ´ØÈÖçÁΩÆ
            args="$args dawn_enable_vulkan=true"
            args="$args dawn_enable_desktop_gl=true"
            ;;
          "android")
            # AndroidÂπ≥Âè∞ÁâπÂÆöÈÖçÁΩÆ
            args="$args ndk=\"$ANDROID_NDK_ROOT\""
            args="$args android_api_level=${{ matrix.android_api }}"
            args="$args skia_use_system_freetype2=false"
            args="$args skia_use_freetype=true"
            args="$args skia_enable_fontmgr_android=true"
            args="$args skia_use_vulkan=true"
            args="$args skia_use_harfbuzz=true"
            args="$args skia_use_system_harfbuzz=false"
            # Android WebGPUÂêéÁ´ØÈÖçÁΩÆ
            args="$args dawn_enable_vulkan=true"
            args="$args dawn_enable_opengles=true"
            ;;
        esac
        
        echo "BUILD_ARGS=$args" >> $GITHUB_ENV
      shell: bash
      
    # ÁîüÊàêÊûÑÂª∫Êñá‰ª∂
    - name: ÁîüÊàêSkia GraphiteÊûÑÂª∫Êñá‰ª∂
      run: |
        cd skia
        echo "Ê≠£Âú®‰∏∫ ${{ matrix.target_os }} Âπ≥Âè∞ÁîüÊàêGraphiteÊûÑÂª∫Êñá‰ª∂..."
        bin/gn gen out/Release --args="$BUILD_ARGS"
        echo "GraphiteÊûÑÂª∫ÈÖçÁΩÆÂÆåÊàê"
      shell: bash
      
    # ÁºñËØëSkia Graphite
    - name: ÁºñËØëSkia Graphite
      run: |
        cd skia
        echo "ÂºÄÂßãÁºñËØë ${{ matrix.target_os }} Âπ≥Âè∞ÁöÑSkia Graphite..."
        if [ "${{ matrix.target_os }}" = "android" ]; then
          ninja -C out/Release -j8
        else
          ninja -C out/Release -j6
        fi
        echo "‚úÖ ${{ matrix.target_os }} Âπ≥Âè∞Skia GraphiteÁºñËØëÂÆåÊàê"
      shell: bash
      
    # ÂàõÂª∫Âπ≥Âè∞ÁâπÂÆöÁöÑÂèëÂ∏ÉÂåÖ
    - name: ÂàõÂª∫Âπ≥Âè∞ÊûÑÂª∫ÂåÖ
      run: |
        cd skia
        
        # ÂàõÂª∫Âπ≥Âè∞ÁâπÂÆöÁöÑÁõÆÂΩïÁªìÊûÑ
        platform_dir="build-output/${{ matrix.platform }}/${{ matrix.arch }}"
        mkdir -p "$platform_dir/bin"
        mkdir -p "$platform_dir/lib"
        mkdir -p "$platform_dir/include"
        mkdir -p "$platform_dir/modules"
        
        # Â§çÂà∂Â§¥Êñá‰ª∂
        cp -r include/* "$platform_dir/include/"
        
        # Â§çÂà∂modules
        if [ -d "modules" ]; then
          cp -r modules/* "$platform_dir/modules/" 2>/dev/null || true
        fi
        
        # Â§çÂà∂third_partyÂ§¥Êñá‰ª∂
        if [ -d "third_party" ]; then
          mkdir -p "$platform_dir/third_party"
          find third_party -name "*.h" -o -name "*.hpp" | while read file; do
            dir=$(dirname "$file")
            mkdir -p "$platform_dir/$dir"
            cp "$file" "$platform_dir/$file" 2>/dev/null || true
          done
        fi
        
        # Â§çÂà∂DawnÂ§¥Êñá‰ª∂
        if [ -d "third_party/externals/dawn/include" ]; then
          mkdir -p "$platform_dir/dawn"
          cp -r third_party/externals/dawn/include/* "$platform_dir/dawn/" 2>/dev/null || true
        fi
        
        # Ê†πÊçÆÂπ≥Âè∞Â§çÂà∂Â∫ìÊñá‰ª∂ÂíåÂèØÊâßË°åÊñá‰ª∂
        case "${{ matrix.target_os }}" in
          "win")
            find out/Release -name "*.lib" -exec cp {} "$platform_dir/lib/" \; 2>/dev/null || true
            find out/Release -name "*.dll" -exec cp {} "$platform_dir/bin/" \; 2>/dev/null || true
            find out/Release -name "*.exe" -exec cp {} "$platform_dir/bin/" \; 2>/dev/null || true
            ;;
          "mac")
            find out/Release -name "*.a" -exec cp {} "$platform_dir/lib/" \; 2>/dev/null || true
            find out/Release -name "*.dylib" -exec cp {} "$platform_dir/lib/" \; 2>/dev/null || true
            ;;
          "linux"|"android")
            find out/Release -name "*.a" -exec cp {} "$platform_dir/lib/" \; 2>/dev/null || true
            find out/Release -name "*.so" -exec cp {} "$platform_dir/lib/" \; 2>/dev/null || true
            ;;
        esac
        
        # ÂàõÂª∫ÊûÑÂª∫‰ø°ÊÅØÊñá‰ª∂
        cat > "$platform_dir/BUILD_INFO.txt" << EOF
        Skia Graphite + Dawn WebGPU ÊûÑÂª∫‰ø°ÊÅØ
        ====================================
        Âπ≥Âè∞: ${{ matrix.platform }}
        Êû∂ÊûÑ: ${{ matrix.arch }}
        ÁõÆÊ†áOS: ${{ matrix.target_os }}
        ÁõÆÊ†áCPU: ${{ matrix.target_cpu }}
        ÊûÑÂª∫Ê®°Âºè: Release (ÂÆòÊñπÊûÑÂª∫)
        
        ÂêØÁî®ÁöÑÂäüËÉΩ:
        - Skia Graphite (‰∏ã‰∏Ä‰ª£ÂõæÂΩ¢API)
        - Dawn WebGPUÂêéÁ´Ø
        - GPUÊ∏≤Êüì (OpenGL + Vulkan + Metal + Direct3D)
        - PDFÂØºÂá∫ÊîØÊåÅ
        - SVGÊîØÊåÅ
        - SkottieÂä®Áîª
        - ÊñáÊú¨Êï¥ÂΩ¢ÊîØÊåÅ
        - Â≠ó‰ΩìÁÆ°ÁêÜ
        - ÂõæÂÉèÁºñËß£Á†Å
        - È¢úËâ≤ÁÆ°ÁêÜ
        
        ÁâπÊÆäËØ¥Êòé:
        - ÂêåÊó∂ÊîØÊåÅ‰º†ÁªüGaneshÂíåÊñ∞Graphite API
        - WebGPUÈÄöËøáDawnÂêéÁ´ØÊèê‰æõË∑®Âπ≥Âè∞ÊîØÊåÅ
        - ÊâÄÊúâ‰æùËµñÂ∑≤ÈùôÊÄÅÈìæÊé•
        - Áîü‰∫ßÁéØÂ¢ÉÂ∞±Áª™
        EOF
        
      shell: bash
      
    # ‰∏ä‰º†Âπ≥Âè∞ÊûÑÂª∫‰∫ßÁâ©
    - name: ‰∏ä‰º†ÊûÑÂª∫‰∫ßÁâ©
      uses: actions/upload-artifact@v4
      with:
        name: ${{ matrix.platform }}-${{ matrix.arch }}
        path: skia/build-output/${{ matrix.platform }}/${{ matrix.arch }}
        retention-days: 30
        
  # Êï¥ÂêàÊâÄÊúâÂπ≥Âè∞ÁöÑÊûÑÂª∫‰∫ßÁâ©
  package-release:
    needs: build-skia-graphite
    runs-on: ubuntu-latest
    
    steps:
    # Ê£ÄÂá∫‰ª£Á†Å
    - name: Ê£ÄÂá∫‰ª£Á†Å‰ªìÂ∫ì
      uses: actions/checkout@v4
      
    # ‰∏ãËΩΩÊâÄÊúâÊûÑÂª∫‰∫ßÁâ©
    - name: ‰∏ãËΩΩÊâÄÊúâÊûÑÂª∫‰∫ßÁâ©
      uses: actions/download-artifact@v4
      with:
        path: artifacts
        
    # ÂàõÂª∫Áªü‰∏ÄÂåÖÁªìÊûÑ
    - name: ÂàõÂª∫Skia_Prebuilt.zip
      run: |
        # ÂàõÂª∫ÁõÆÊ†áÁõÆÂΩïÁªìÊûÑ
        mkdir -p Skia/bin
        mkdir -p Skia/lib
        mkdir -p Skia/include
        mkdir -p Skia/modules
        mkdir -p Skia/examples
        
        # Â§çÂà∂ÊâÄÊúâÂπ≥Âè∞ÁöÑÊûÑÂª∫‰∫ßÁâ©
        for platform_dir in artifacts/*/; do
          platform_name=$(basename "$platform_dir")
          echo "Â§ÑÁêÜÂπ≥Âè∞: $platform_name"
          
          # Ëß£ÊûêÂπ≥Âè∞ÂêçÁß∞ÂíåÊû∂ÊûÑ
          if [[ "$platform_name" == *"-"* ]]; then
            platform=$(echo "$platform_name" | cut -d'-' -f1)
            arch=$(echo "$platform_name" | cut -d'-' -f2)
          else
            platform="$platform_name"
            arch="x64"
          fi
          
          # ÂàõÂª∫Âπ≥Âè∞ÁâπÂÆöÁõÆÂΩï
          mkdir -p "Skia/bin/$platform/$arch"
          mkdir -p "Skia/lib/$platform/$arch"
          
          # Â§çÂà∂Êñá‰ª∂
          if [ -d "$platform_dir/bin" ]; then
            cp -r "$platform_dir"/bin/* "Skia/bin/$platform/$arch/" 2>/dev/null || true
          fi
          
          if [ -d "$platform_dir/lib" ]; then
            cp -r "$platform_dir"/lib/* "Skia/lib/$platform/$arch/" 2>/dev/null || true
          fi
          
          # Â§çÂà∂Â§¥Êñá‰ª∂ÔºàÂè™ÈúÄË¶ÅÂ§çÂà∂‰∏ÄÊ¨°Ôºâ
          if [ ! -d "Skia/include/core" ] && [ -d "$platform_dir/include" ]; then
            cp -r "$platform_dir"/include/* Skia/include/ 2>/dev/null || true
          fi
          
          # Â§çÂà∂modulesÔºàÂè™ÈúÄË¶ÅÂ§çÂà∂‰∏ÄÊ¨°Ôºâ
          if [ ! -d "Skia/modules/skcms" ] && [ -d "$platform_dir/modules" ]; then
            cp -r "$platform_dir"/modules/* Skia/modules/ 2>/dev/null || true
          fi
          
          # Â§çÂà∂third_partyÔºàÂè™ÈúÄË¶ÅÂ§çÂà∂‰∏ÄÊ¨°Ôºâ
          if [ ! -d "Skia/third_party" ] && [ -d "$platform_dir/third_party" ]; then
            cp -r "$platform_dir/third_party" Skia/ 2>/dev/null || true
          fi
          
          # Â§çÂà∂DawnÂ§¥Êñá‰ª∂ÔºàÂè™ÈúÄË¶ÅÂ§çÂà∂‰∏ÄÊ¨°Ôºâ
          if [ ! -d "Skia/dawn" ] && [ -d "$platform_dir/dawn" ]; then
            cp -r "$platform_dir/dawn" Skia/ 2>/dev/null || true
          fi
        done
        
        # ÂàõÂª∫Á§∫‰æãÊñá‰ª∂
        mkdir -p Skia/examples
        cat > Skia/examples/hello_graphite.cpp << 'EOF'
        // Skia Graphite + Dawn WebGPU Á§∫‰æã
        #include "include/core/SkCanvas.h"
        #include "include/core/SkSurface.h"
        #include "include/gpu/graphite/Context.h"
        #include "include/gpu/graphite/Surface.h"
        #include "include/gpu/graphite/dawn/DawnBackendContext.h"
        
        // ËøôÊòØ‰∏Ä‰∏™Â±ïÁ§∫Â¶Ç‰Ωï‰ΩøÁî®Skia Graphite‰∏éDawn WebGPUÁöÑÂü∫Á°ÄÁ§∫‰æã
        // ÂÆûÈôÖ‰ΩøÁî®Êó∂ÈúÄË¶ÅÊ†πÊçÆÂÖ∑‰ΩìÂπ≥Âè∞ÂàùÂßãÂåñWebGPUËÆæÂ§á
        EOF
        
        cat > Skia/examples/CMakeLists.txt << 'EOF'
        # Skia Graphite + Dawn Á§∫‰æãÈ°πÁõÆ
        cmake_minimum_required(VERSION 3.15)
        project(SkiaGraphiteExample)
        
        set(CMAKE_CXX_STANDARD 17)
        set(CMAKE_CXX_STANDARD_REQUIRED ON)
        
        # Ê∑ªÂä†Áà∂ÁõÆÂΩïÁöÑSkia
        add_subdirectory(.. skia_build)
        
        # ÂàõÂª∫Á§∫‰æãÂèØÊâßË°åÊñá‰ª∂
        add_executable(hello_graphite hello_graphite.cpp)
        target_link_libraries(hello_graphite skdn)
        EOF
        
      shell: bash
      
    # ÁîüÊàêÁªü‰∏ÄÁöÑCMakeLists.txt
    - name: ÁîüÊàêÁªü‰∏ÄCMakeLists.txt
      run: |
        cat > Skia/CMakeLists.txt << 'EOF'
        # Skia Graphite + Dawn WebGPU ÂÖ®Âπ≥Âè∞CMakeÈÖçÁΩÆ
        cmake_minimum_required(VERSION 3.15)
        
        project(SkiaGraphitePrebuilt
            VERSION 1.0.0
            DESCRIPTION "Skia Graphite + Dawn WebGPU È¢ÑÁºñËØëÂ∫ì"
            LANGUAGES CXX C
        )
        
        # ËÆæÁΩÆC++Ê†áÂáÜ
        set(CMAKE_CXX_STANDARD 17)
        set(CMAKE_CXX_STANDARD_REQUIRED ON)
        
        # Ëé∑ÂèñÂΩìÂâçÁõÆÂΩï
        get_filename_component(SKIA_ROOT_DIR "${CMAKE_CURRENT_LIST_DIR}" ABSOLUTE)
        
        # Ëá™Âä®Ê£ÄÊµãÂπ≥Âè∞
        if(WIN32)
            set(SKIA_PLATFORM "Win")
        elseif(APPLE)
            set(SKIA_PLATFORM "macOS")
        elseif(ANDROID)
            set(SKIA_PLATFORM "Android")
        else()
            set(SKIA_PLATFORM "Linux")
        endif()
        
        # Ëá™Âä®Ê£ÄÊµãÊû∂ÊûÑ
        if(CMAKE_SIZEOF_VOID_P EQUAL 8)
            if(CMAKE_SYSTEM_PROCESSOR MATCHES "arm64|aarch64|ARM64")
                set(SKIA_ARCH "arm64")
            else()
                set(SKIA_ARCH "x64")
            endif()
        else()
            set(SKIA_ARCH "x86")
        endif()
        
        # ËÆæÁΩÆÂ∫ìÂíå‰∫åËøõÂà∂Êñá‰ª∂Ë∑ØÂæÑ
        set(SKIA_LIB_DIR "${SKIA_ROOT_DIR}/lib/${SKIA_PLATFORM}/${SKIA_ARCH}")
        set(SKIA_BIN_DIR "${SKIA_ROOT_DIR}/bin/${SKIA_PLATFORM}/${SKIA_ARCH}")
        
        # Ê£ÄÊü•ÁõÆÂΩïÊòØÂê¶Â≠òÂú®
        if(NOT EXISTS "${SKIA_LIB_DIR}")
            message(FATAL_ERROR "SkiaÂ∫ìÁõÆÂΩï‰∏çÂ≠òÂú®: ${SKIA_LIB_DIR}")
        endif()
        
        # ÂàõÂª∫skdnÊé•Âè£Â∫ì (Skia + Dawn)
        add_library(skdn INTERFACE)
        add_library(skdn::skdn ALIAS skdn)
        
        # ËÆæÁΩÆÂåÖÂê´ÁõÆÂΩï
        target_include_directories(skdn INTERFACE
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/include>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/modules>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/third_party>
            $<BUILD_INTERFACE:${SKIA_ROOT_DIR}/dawn>
            $<INSTALL_INTERFACE:.>
            $<INSTALL_INTERFACE:include>
            $<INSTALL_INTERFACE:modules>
            $<INSTALL_INTERFACE:third_party>
            $<INSTALL_INTERFACE:dawn>
        )
        
        # Êü•ÊâæÊâÄÊúâÂ∫ìÊñá‰ª∂
        file(GLOB SKIA_LIBRARIES "${SKIA_LIB_DIR}/*")
        
        # Ê†πÊçÆÂπ≥Âè∞ËÆæÁΩÆÁâπÂÆöÈÖçÁΩÆ
        if(WIN32)
            # WindowsÂπ≥Âè∞ÈÖçÁΩÆ
            target_compile_definitions(skdn INTERFACE
                SK_GANESH=1
                SK_GRAPHITE=1
                SK_DAWN=1
                SK_VULKAN=1
                SK_GL=1
                SK_BUILD_FOR_WIN=1
                SK_ENABLE_SKOTTIE=1
                SK_ENABLE_SVG=1
                UNICODE
                _UNICODE
            )
            
            # WindowsËøêË°åÊó∂ÈÖçÁΩÆ
            target_compile_options(skdn INTERFACE
                $<$<CONFIG:Debug>:/MDd>
                $<$<CONFIG:Release>:/MD>
                $<$<CONFIG:RelWithDebInfo>:/MD>
                $<$<CONFIG:MinSizeRel>:/MD>
            )
            
            # WindowsÁ≥ªÁªüÂ∫ì
            target_link_libraries(skdn INTERFACE
                ${SKIA_LIBRARIES}
                # DirectXÁõ∏ÂÖ≥
                d3d11 d3d12 dxgi d3dcompiler dxguid
                # OpenGLÁõ∏ÂÖ≥
                OpenGL32
                # Á≥ªÁªüÂ∫ì
                Gdi32 User32 Kernel32 Ole32 OleAut32 Uuid
                Advapi32 Shell32 Usp10 Ws2_32
            )
            
        elseif(APPLE)
            # macOSÂπ≥Âè∞ÈÖçÁΩÆ
            target_compile_definitions(skdn INTERFACE
                SK_GANESH=1
                SK_GRAPHITE=1
                SK_DAWN=1
                SK_METAL=1
                SK_GL=1
                SK_VULKAN=1
                SK_BUILD_FOR_MAC=1
                SK_ENABLE_SKOTTIE=1
                SK_ENABLE_SVG=1
            )
            
            # macOSÁ≥ªÁªüÊ°ÜÊû∂
            find_library(FOUNDATION_FRAMEWORK Foundation)
            find_library(COREGRAPHICS_FRAMEWORK CoreGraphics)
            find_library(CORETEXT_FRAMEWORK CoreText)
            find_library(COREFOUNDATION_FRAMEWORK CoreFoundation)
            find_library(COCOA_FRAMEWORK Cocoa)
            find_library(METAL_FRAMEWORK Metal)
            find_library(METALKIT_FRAMEWORK MetalKit)
            find_library(OPENGL_FRAMEWORK OpenGL)
            find_library(QUARTZCORE_FRAMEWORK QuartzCore)
            find_library(IOSURFACE_FRAMEWORK IOSurface)
            
            target_link_libraries(skdn INTERFACE
                ${SKIA_LIBRARIES}
                ${FOUNDATION_FRAMEWORK}
                ${COREGRAPHICS_FRAMEWORK}
                ${CORETEXT_FRAMEWORK}
                ${COREFOUNDATION_FRAMEWORK}
                ${COCOA_FRAMEWORK}
                ${METAL_FRAMEWORK}
                ${METALKIT_FRAMEWORK}
                ${OPENGL_FRAMEWORK}
                ${QUARTZCORE_FRAMEWORK}
                ${IOSURFACE_FRAMEWORK}
            )
            
        elseif(ANDROID)
            # AndroidÂπ≥Âè∞ÈÖçÁΩÆ
            target_compile_definitions(skdn INTERFACE
                ANDROID
                SK_GANESH=1
                SK_GRAPHITE=1
                SK_DAWN=1
                SK_VULKAN=1
                SK_GL=1
                SK_BUILD_FOR_ANDROID=1
                SK_ENABLE_SKOTTIE=1
                SK_ENABLE_SVG=1
                __ANDROID_API__=21
            )
            
            target_compile_options(skdn INTERFACE
                -fPIC -fno-rtti -fno-exceptions
            )
            
            target_link_libraries(skdn INTERFACE
                ${SKIA_LIBRARIES}
                GLESv2 EGL vulkan
                android log jnigraphics mediandk
                dl m z
            )
            
        else()
            # LinuxÂπ≥Âè∞ÈÖçÁΩÆ
            target_compile_definitions(skdn INTERFACE
                SK_GANESH=1
                SK_GRAPHITE=1
                SK_DAWN=1
                SK_VULKAN=1
                SK_GL=1
                SK_BUILD_FOR_UNIX=1
                SK_ENABLE_SKOTTIE=1
                SK_ENABLE_SVG=1
            )
            
            # Êü•ÊâæÁ≥ªÁªüÂ∫ì
            find_package(PkgConfig QUIET)
            find_package(Vulkan QUIET)
            find_package(X11 QUIET)
            
            target_link_libraries(skdn INTERFACE
                ${SKIA_LIBRARIES}
                GL pthread dl m
            )
            
            # Ê∑ªÂä†Á≥ªÁªüÂ∫ìÊîØÊåÅ
            if(Vulkan_FOUND)
                target_link_libraries(skdn INTERFACE ${Vulkan_LIBRARIES})
                target_include_directories(skdn INTERFACE ${Vulkan_INCLUDE_DIRS})
            endif()
            
            if(X11_FOUND)
                target_link_libraries(skdn INTERFACE
                    ${X11_LIBRARIES} ${X11_Xrandr_LIB} ${X11_Xinerama_LIB}
                    ${X11_Xcursor_LIB} ${X11_Xi_LIB}
                )
                target_include_directories(skdn INTERFACE ${X11_INCLUDE_DIR})
            endif()
        endif()
        
        # ËÆæÁΩÆÁºñËØëÁâπÊÄß
        target_compile_features(skdn INTERFACE cxx_std_17)
        
        # ‰ºòÂåñËÆæÁΩÆ
        target_compile_options(skdn INTERFACE
            $<$<CONFIG:Debug>:-g -O0>
            $<$<CONFIG:Release>:-O3 -DNDEBUG>
            $<$<CONFIG:RelWithDebInfo>:-O2 -g -DNDEBUG>
        )
        
        # Ë∞ÉËØïÈ¢ÑÂ§ÑÁêÜÂÆö‰πâ
        target_compile_definitions(skdn INTERFACE
            $<$<CONFIG:Debug>:SK_DEBUG>
            $<$<CONFIG:Release>:SK_RELEASE>
        )
        
        # ÊòæÁ§∫ÊûÑÂª∫‰ø°ÊÅØ
        message(STATUS "Skia Graphite + Dawn WebGPU ÈÖçÁΩÆ:")
        message(STATUS "  Âπ≥Âè∞: ${SKIA_PLATFORM}")
        message(STATUS "  Êû∂ÊûÑ: ${SKIA_ARCH}")
        message(STATUS "  Â∫ìÁõÆÂΩï: ${SKIA_LIB_DIR}")
        message(STATUS "  ‰∫åËøõÂà∂ÁõÆÂΩï: ${SKIA_BIN_DIR}")
        EOF
        
      shell: bash
      
    # ÂàõÂª∫ÊúÄÁªàÁöÑZIPÂåÖ
    - name: ÂàõÂª∫Skia_Prebuilt.zip
      run: |
        # ÂàõÂª∫README
        cat > Skia/README.md << 'EOF'
        # Skia Graphite + Dawn WebGPU È¢ÑÁºñËØëÂ∫ì
        
        ËøôÊòØ‰∏Ä‰∏™ÂåÖÂê´Skia GraphiteÂíåDawn WebGPUÁöÑÂÆåÊï¥È¢ÑÁºñËØëÂ∫ìÂåÖÔºåÊîØÊåÅÂ§ö‰∏™Âπ≥Âè∞„ÄÇ
        
        ## ÊîØÊåÅÁöÑÂπ≥Âè∞
        
        - **Windows x64** - DirectX 11/12 + Vulkan + OpenGL
        - **macOS x64/ARM64** - Metal + Vulkan + OpenGL  
        - **Linux x64** - Vulkan + OpenGL
        - **Android x64/ARM64** - Vulkan + OpenGL ES
        
        ## ‰ΩøÁî®ÊñπÊ≥ï
        
        ### CMakeÈõÜÊàê
        
        ```cmake
        # ËÆæÁΩÆC++17Ê†áÂáÜ
        set(CMAKE_CXX_STANDARD 17)
        set(CMAKE_CXX_STANDARD_REQUIRED ON)
        
        # Ê∑ªÂä†SkiaÁõÆÂΩï
        add_subdirectory(path/to/Skia)
        
        # ÈìæÊé•Âà∞ÊÇ®ÁöÑÁõÆÊ†á
        target_link_libraries(your_target skdn::skdn)
        ```
        
        ### Âü∫Á°ÄÁ§∫‰æã
        
        ```cpp
        #include "include/core/SkCanvas.h"
        #include "include/core/SkSurface.h"
        #include "include/gpu/graphite/Context.h"
        #include "include/gpu/graphite/Surface.h"
        
        // ‰ΩøÁî®Skia GraphiteÂàõÂª∫ÂõæÂΩ¢‰∏ä‰∏ãÊñáÂíåË°®Èù¢
        // ËØ¶ÁªÜÁ§∫‰æãËØ∑ÂèÇËÄÉexamplesÁõÆÂΩï
        ```
        
        ## ‰∏ªË¶ÅÁâπÊÄß
        
        - ‚úÖ **Skia Graphite** - ‰∏ã‰∏Ä‰ª£ÂõæÂΩ¢API
        - ‚úÖ **Dawn WebGPU** - Ë∑®Âπ≥Âè∞WebGPUÂÆûÁé∞
        - ‚úÖ **‰º†ÁªüGanesh** - ÂêëÂêéÂÖºÂÆπÊîØÊåÅ
        - ‚úÖ **Â§öGPUÂêéÁ´Ø** - Metal/DirectX/Vulkan/OpenGL
        - ‚úÖ **ÂÆåÊï¥ÂäüËÉΩ** - PDF/SVG/Âä®Áîª/ÊñáÊú¨Â§ÑÁêÜ
        - ‚úÖ **Ëá™Âä®Âπ≥Âè∞Ê£ÄÊµã** - CMakeËá™Âä®ÈÖçÁΩÆ
        - ‚úÖ **Áîü‰∫ßÂ∞±Áª™** - ‰ºòÂåñÊûÑÂª∫ÈÖçÁΩÆ
        
        ## ÊûÑÂª∫‰ø°ÊÅØ
        
        - **ÊûÑÂª∫Êó•Êúü**: $(date)
        - **SkiaÁâàÊú¨**: ÊúÄÊñ∞‰∏ªÂàÜÊîØ
        - **DawnÁâàÊú¨**: ÊúÄÊñ∞‰∏ªÂàÜÊîØ
        - **ÁºñËØëÂô®**: ÂêÑÂπ≥Âè∞ÂÆòÊñπÊé®ËçêÁºñËØëÂô®
        - **‰ºòÂåñÁ∫ßÂà´**: Release/O3
        
        ## ËÆ∏ÂèØËØÅ
        
        Skia‰ΩøÁî®BSD-3-ClauseËÆ∏ÂèØËØÅ
        Dawn‰ΩøÁî®Apache-2.0ËÆ∏ÂèØËØÅ
        
        ËØ∑ÈÅµÂÆàÁõ∏Â∫îÁöÑÂºÄÊ∫êËÆ∏ÂèØËØÅÊù°Ê¨æ„ÄÇ
        EOF
        
        # ÂàõÂª∫ÊúÄÁªàZIPÂåÖ
        zip -r Skia_Prebuilt.zip Skia/
        
        echo "‚úÖ Skia_Prebuilt.zip ÂàõÂª∫ÂÆåÊàê"
        ls -lh Skia_Prebuilt.zip
        
      shell: bash
      
    # ‰∏ä‰º†ÊúÄÁªàÂåÖ
    - name: ‰∏ä‰º†Skia_Prebuilt.zip
      uses: actions/upload-artifact@v4
      with:
        name: Skia_Prebuilt
        path: Skia_Prebuilt.zip
        retention-days: 90
        
    # ÂàõÂª∫ReleaseÔºà‰ªÖÂú®‰∏ªÂàÜÊîØÊé®ÈÄÅÊó∂Ôºâ
    - name: ÂàõÂª∫GitHub Release
      if: |
        (github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master')) ||
        github.event_name == 'schedule'
      uses: softprops/action-gh-release@v2
      with:
        tag_name: skia-graphite-${{ github.run_number }}
        name: Skia Graphite + Dawn WebGPU v${{ github.run_number }}
        body: |
          # Skia Graphite + Dawn WebGPU ÂÖ®Âπ≥Âè∞È¢ÑÁºñËØëÂåÖ
          
          Ëøô‰∏™ÂèëÂ∏ÉÂåÖÂåÖÂê´‰∫ÜÂêØÁî®GraphiteÁöÑSkiaÂõæÂΩ¢Â∫ìÂíåDawn WebGPUÂêéÁ´ØÁöÑÂÆåÊï¥È¢ÑÁºñËØëÁâàÊú¨„ÄÇ
          
          ## üöÄ Êñ∞ÁâπÊÄß
          
          - **Skia Graphite**: ‰∏ã‰∏Ä‰ª£ÂõæÂΩ¢APIÔºåÊèê‰æõÊõ¥Â•ΩÁöÑÊÄßËÉΩÂíåÁé∞‰ª£ÂåñËÆæËÆ°
          - **Dawn WebGPU**: GoogleÁöÑË∑®Âπ≥Âè∞WebGPUÂÆûÁé∞
          - **Áªü‰∏ÄÊé•Âè£**: ÈÄöËøá`skdn`Â∫ìÂêåÊó∂ËÆøÈóÆSkiaÂíåDawnÂäüËÉΩ
          - **Ëá™Âä®Âπ≥Âè∞Ê£ÄÊµã**: CMakeËá™Âä®ËØÜÂà´Âπ≥Âè∞ÂíåÊû∂ÊûÑ
          
          ## üì¶ ÂåÖÂê´ÂÜÖÂÆπ
          
          - **Skia_Prebuilt.zip** - ÂÆåÊï¥ÁöÑË∑®Âπ≥Âè∞È¢ÑÁºñËØëÂåÖ
            - Windows x64 (DirectX 11/12 + Vulkan + OpenGL)
            - macOS x64/ARM64 (Metal + Vulkan + OpenGL)
            - Linux x64 (Vulkan + OpenGL)
            - Android x64/ARM64 (Vulkan + OpenGL ES)
          
          ## üîß ‰ΩøÁî®ÊñπÊ≥ï
          
          ```cmake
          add_subdirectory(Skia)
          target_link_libraries(your_app skdn::skdn)
          ```
          
          ## üìö ÊñáÊ°£
          
          ÂÆåÊï¥ÁöÑ‰ΩøÁî®ÊñáÊ°£ÂíåÁ§∫‰æãËØ∑ÂèÇËÄÉÂåÖÂÜÖÁöÑREADME.mdÂíåexamplesÁõÆÂΩï„ÄÇ
          
          ---
          
          **ÊûÑÂª∫‰ø°ÊÅØ**: GitHub ActionsËá™Âä®ÊûÑÂª∫ÔºåÂåÖÂê´ÊúÄÊñ∞ÁöÑSkia GraphiteÂíåDawn WebGPUÂäüËÉΩ„ÄÇ
        files: |
          Skia_Prebuilt.zip
        draft: false
        prerelease: false
        make_latest: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
